<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>lefoçš„èœé¸¡å®å½•</title>
  <icon>https://www.gravatar.com/avatar/480d7d5ef5660a0927e82173742c59a2</icon>
  <subtitle>åˆæ˜¯ä¸€ä¸ªandroidå¼€å‘</subtitle>
  <link href="https://lefo.me/atom.xml" rel="self"/>
  
  <link href="https://lefo.me/"/>
  <updated>2026-01-27T02:36:14.659Z</updated>
  <id>https://lefo.me/</id>
  
  <author>
    <name>lefo</name>
    <email>lefo#lefo.me(#æ¢æˆ@ä½ æ‡‚å¾—)</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Cocos2.xç‰ˆæœ¬ HandleScope::Initialize(v8::Isolate*) é—®é¢˜åˆ†æ</title>
    <link href="https://lefo.me/2026/01/17/cocos2d-issue/"/>
    <id>https://lefo.me/2026/01/17/cocos2d-issue/</id>
    <published>2026-01-17T04:30:26.000Z</published>
    <updated>2026-01-27T02:36:14.659Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜èƒŒæ™¯"><a href="#é—®é¢˜èƒŒæ™¯" class="headerlink" title="é—®é¢˜èƒŒæ™¯"></a>é—®é¢˜èƒŒæ™¯</h1><p>å…¬å¸ä½¿ç”¨ Cocos 2.4.15 å¼€å‘æ¸¸æˆæ—¶ï¼Œå‘ç°ä¸€ä¸ª crash åœ¨ Android 15 ä»¥ä¸Šçš„è®¾å¤‡ä¸Šéå¸¸é¢‘ç¹ã€‚èµ·åˆä»¥ä¸ºæ˜¯ 16KB çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä½†åˆ†æåå‘ç°åŒ…å…¶å®æ˜¯å…¼å®¹ 16KB çš„ã€‚  </p><p>åœ¨ Cocos ç¤¾åŒºä¸­ï¼Œä¹Ÿæœ‰ç›¸å…³è®¨è®ºï¼š<a href="https://forum.cocos.org/t/topic/167995">v8::HandleScope::Initialize(v8::Isolate*)</a>ã€‚å®˜æ–¹æ›¾æä¾›è¿‡åŸºäº Activity åœ¨ <code>onDestroy</code> æ—¶çš„ä¿®å¤æ–¹æ¡ˆï¼Œä½†æˆ‘ä»¬å‘ç°è¿˜æœ‰å…¶å®ƒè§¦å‘åœºæ™¯ã€‚</p><p>Crash æ—¥å¿—ç¤ºä¾‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(v8::HandleScope::<span class="built_in">Initialize</span>(v8::Isolate*)+<span class="number">144</span>) (BuildId: a222c0a549189d49b84a5433428e92f58cba47f0)</span><br><span class="line">(se::AutoHandleScope::<span class="built_in">AutoHandleScope</span>()+<span class="number">36</span>) (BuildId: a222c0a549189d49b84a5433428e92f58cba47f0)</span><br></pre></td></tr></table></figure><span id="more"></span><p>ç®€å•åˆ†æ crash çš„ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ScriptEngine::cleanup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">SE_LOGD</span>(<span class="string">&quot;ScriptEngine::cleanup&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!_isValid)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">SE_LOGD</span>(<span class="string">&quot;ScriptEngine::cleanup begin ...\n&quot;</span>);</span><br><span class="line">    _isInCleanup = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        AutoHandleScope hs;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜å°±å‡ºåœ¨è¿™ä¸€è¡Œï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AutoHandleScope hs;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ <code>AutoHandleScope</code> æ„é€ å‡½æ•°å¯ä»¥å‘ç°ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ª <code>_handleScope</code> å¹¶ä¼ å…¥ <code>v8::Isolate::GetCurrent()</code>ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AutoHandleScope</span>()</span><br><span class="line">      : _handleScope(v8::Isolate::<span class="built_in">GetCurrent</span>())</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">AutoHandleScope</span>()</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    v8::HandleScope _handleScope;</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>v8::Isolate::GetCurrent()</code> è¿”å› <code>nullptr</code>ï¼Œå°±ä¼šç›´æ¥å¯¼è‡´ crashã€‚</p><h1 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h1><p>ç»è¿‡åˆ†æå‘ç°ï¼Œå½“ <code>GLSurfaceView</code> è¢«å›æ”¶åï¼ŒRender çº¿ç¨‹ä¹Ÿä¼šéšä¹‹é”€æ¯ã€‚ä¸‹æ¬¡å†åˆ›å»ºæ–°çš„ GLThread æ—¶ï¼Œç”±äº V8 çš„ Isolate æ˜¯çº¿ç¨‹ç‹¬ç«‹çš„ï¼Œç¬¬äºŒæ¬¡è¿›å…¥ <code>ScriptEngine::init()</code> -&gt; <code>cleanup()</code> -&gt; <code>AutoHandleScope hs</code> æ—¶ï¼Œ<code>v8::Isolate::GetCurrent()</code> å°±ä¼šè¿”å› <code>nullptr</code>ï¼Œä»è€Œè§¦å‘ crashã€‚</p><h1 id="ä¿®å¤æ–¹æ¡ˆ"><a href="#ä¿®å¤æ–¹æ¡ˆ" class="headerlink" title="ä¿®å¤æ–¹æ¡ˆ"></a>ä¿®å¤æ–¹æ¡ˆ</h1><p>å°è¯•è¿‡çš„å‡ ç§æ–¹æ³•ï¼š</p><ol><li>**ç»•è¿‡ <code>AutoHandleScope hs</code>**ï¼šä¸å¯è¡Œï¼Œä¼šç ´å V8 èµ„æºç®¡ç†ã€‚  </li><li><strong>ä¼ å…¥ä¹‹å‰çš„ Isolate</strong>ï¼šä¹Ÿä¸å¯è¡Œï¼Œå› ä¸º Isolate ä¸çº¿ç¨‹ç»‘å®šï¼Œçº¿ç¨‹å·²é”€æ¯ã€‚</li></ol><p>æœ€ç»ˆï¼Œå®˜æ–¹æä¾›çš„æ–¹æ¡ˆæ˜¯ï¼šå½“ Activity çš„ <code>onDestroy</code> è¢«è°ƒç”¨æ—¶ï¼Œç›´æ¥ç»“æŸè¿›ç¨‹ï¼ˆè°ƒç”¨ <code>Cocos2dxHelper.terminateProcess()</code>ï¼‰ã€‚è€ƒè™‘åˆ°è¯¥ bug ä¸»è¦åœ¨ Android 15 å’Œ 16 ä¸Šï¼Œæˆ‘ä»¬åŠ äº†ç‰ˆæœ¬åˆ¤æ–­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">35</span>) Cocos2dxHelper.terminateProcess();</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç›´æ¥æ€æ‰è¿›ç¨‹ï¼Œå¯ä»¥å½»åº•é¿å… crashã€‚</p><h1 id="å…¶ä»–è§¦å‘åœºæ™¯"><a href="#å…¶ä»–è§¦å‘åœºæ™¯" class="headerlink" title="å…¶ä»–è§¦å‘åœºæ™¯"></a>å…¶ä»–è§¦å‘åœºæ™¯</h1><p>Activity <code>onDestroy</code> çš„é—®é¢˜è§£å†³åï¼Œä»ç„¶å­˜åœ¨å¦ä¸€ä¸ªè§¦å‘ç‚¹ï¼š<code>GLSurfaceView.onDetachFromWindow</code>ã€‚ä¹Ÿå°±æ˜¯å½“è°ƒç”¨ <code>parent.removeView(glView)</code> å† <code>parent.addView(glView)</code> æ—¶ï¼ŒåŒæ ·å¯èƒ½è§¦å‘ crashã€‚  </p><p>è§£å†³æ–¹æ³•åŒæ ·å¯ä»¥æ˜¯ç›´æ¥åœ¨ <code>onDetachFromWindow</code> æ—¶ç»“æŸè¿›ç¨‹ã€‚å¯¹äºå¤§éƒ¨åˆ†æ¸¸æˆæ¥è¯´ï¼ŒremoveView å¤šå‘ç”Ÿåœ¨åå°æˆ–è€…èµ„æºå·²å›æ”¶çš„æƒ…å†µä¸‹ï¼Œæ€æ‰è¿›ç¨‹å¹¶é‡æ–°å¯åŠ¨å¹¶ä¸ä¼šå½±å“ç”¨æˆ·ä½“éªŒã€‚  </p><p>ä½†åœ¨æ¥å…¥æŸäº›ç¬¬ä¸‰æ–¹ SDK æ—¶ï¼Œå¦‚æœ SDK åœ¨å¯åŠ¨æ—¶å°† root view åŠ å…¥å®ƒä»¬çš„å®¹å™¨ä¸­ï¼Œå°±å¯èƒ½åœ¨å¯åŠ¨æ—¶å°±è¢«æ€æ‰ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åæ¥æ”¾å¼ƒåœ¨ 2.x ç‰ˆæœ¬æ¥å…¥è¯¥ SDK çš„åŸå› ã€‚Cocos 3.x åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘"><a href="#å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘" class="headerlink" title="å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘"></a>å¯èƒ½çš„ä¼˜åŒ–æ–¹å‘</h1><p>å¯ä»¥å°è¯•é€šè¿‡æ§åˆ¶çº¿ç¨‹æˆ– Render çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¤ç”¨ä¹‹å‰çš„ Render æˆ–çº¿ç¨‹ï¼Œé¿å… Isolate ä¸ºç©ºçš„æƒ…å†µã€‚è¿™ä¸ªæ–¹å‘ä»éœ€è¦è¿›ä¸€æ­¥å®éªŒã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#é—®é¢˜èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;/a&gt;é—®é¢˜èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;å…¬å¸ä½¿ç”¨ Cocos 2.4.15 å¼€å‘æ¸¸æˆæ—¶ï¼Œå‘ç°ä¸€ä¸ª crash åœ¨ Android 15 ä»¥ä¸Šçš„è®¾å¤‡ä¸Šéå¸¸é¢‘ç¹ã€‚èµ·åˆä»¥ä¸ºæ˜¯ 16KB çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä½†åˆ†æåå‘ç°åŒ…å…¶å®æ˜¯å…¼å®¹ 16KB çš„ã€‚  &lt;/p&gt;
&lt;p&gt;åœ¨ Cocos ç¤¾åŒºä¸­ï¼Œä¹Ÿæœ‰ç›¸å…³è®¨è®ºï¼š&lt;a href=&quot;https://forum.cocos.org/t/topic/167995&quot;&gt;v8::HandleScope::Initialize(v8::Isolate*)&lt;/a&gt;ã€‚å®˜æ–¹æ›¾æä¾›è¿‡åŸºäº Activity åœ¨ &lt;code&gt;onDestroy&lt;/code&gt; æ—¶çš„ä¿®å¤æ–¹æ¡ˆï¼Œä½†æˆ‘ä»¬å‘ç°è¿˜æœ‰å…¶å®ƒè§¦å‘åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;Crash æ—¥å¿—ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight cpp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;(v8::HandleScope::&lt;span class=&quot;built_in&quot;&gt;Initialize&lt;/span&gt;(v8::Isolate*)+&lt;span class=&quot;number&quot;&gt;144&lt;/span&gt;) (BuildId: a222c0a549189d49b84a5433428e92f58cba47f0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;(se::AutoHandleScope::&lt;span class=&quot;built_in&quot;&gt;AutoHandleScope&lt;/span&gt;()+&lt;span class=&quot;number&quot;&gt;36&lt;/span&gt;) (BuildId: a222c0a549189d49b84a5433428e92f58cba47f0)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
    <category term="cocos" scheme="https://lefo.me/tags/cocos/"/>
    
  </entry>
  
  <entry>
    <title>nx54ä½ åˆ«å‡çº§äº†</title>
    <link href="https://lefo.me/2025/11/04/h3c-no-update/"/>
    <id>https://lefo.me/2025/11/04/h3c-no-update/</id>
    <published>2025-11-04T15:49:47.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰æ®µæ—¶é—´ï¼Œæœ‹å‹å¾®ä¿¡ä¸Šå’Œæˆ‘è¯´ï¼ŒNX54å‡çº§å›ºä»¶äº†ï¼Œå‡çº§åï¼Œdebugæ¨¡å¼è¿›ä¸äº†ï¼Œtelnetä¹Ÿæ‰“ä¸å¼€äº†ã€‚è‡³æ­¤ï¼Œæˆ‘ä¹‹å‰åˆ†äº«çš„ipv6çº¯å®šåˆ¶çš„æ–¹æ¡ˆï¼Œå¤±æ•ˆäº†ï¼Œåªå‰©ä¸‹ä¸€ç§æ–¹å¼ï¼šipv6é˜²ç«å¢™å¼€å…³ã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯å¯ä»¥æ»¡è¶³ipv6è®¿é—®çš„ï¼Œåªä¸è¿‡ä¸å¯ä»¥åªå¼€æ”¾æŒ‡å®šçš„v6ipäº†ã€‚ç®€å•åæ§½ä¸€ä¸‹è¿™æ¬¡å‡çº§ï¼š</p><ol><li>ä¸å¯é™çº§ã€‚ä¸Šäº†v13åï¼Œå°±ç®—ä½ ä¿å­˜äº†æ—§å›ºä»¶ï¼Œä¹Ÿä¸å¯ä»¥é™çº§ã€‚</li><li>ä¸å¯debugã€‚åŠ äº†å¯†ç è¢«å µæ­»äº†ã€‚</li><li>telneté»˜è®¤å…³é—­ã€‚ä¹‹å‰é…ç½®æ–‡ä»¶ä¸­å…³äºtelnetçš„è®¾ç½®ï¼Œæ–°ç‰ˆæœ¬ä¸Šæ²¡æœ‰äº†ã€‚</li></ol><p>æœ¬ç¯‡ä¸ç®—ä»€ä¹ˆé»‘ç§‘æŠ€ï¼Œå°±æ˜¯æ‰¾ä¸€æ‰¾å‡çº§çš„ç½‘ç»œï¼Œç„¶ååœæ‰ï¼Œç®—æ˜¯ä¸€ä¸ªå°æ€è·¯ï¼Œä½†å‡¡æ‡‚ç‚¹ç½‘ç»œçŸ¥è¯†çš„ï¼Œåº”è¯¥éƒ½èƒ½æ˜ç™½ã€‚è¿™æ¬¡å‡çº§åï¼Œè€ç‰ˆæœ¬ä¸”ç”¨ä¸”çæƒœå§ã€‚</p><span id="more"></span><p>å¦‚æœä½ å·²ç»å‡çº§åˆ°V13ï¼Œä¸ç”¨çœ‹äº†ã€‚</p><p>å¦‚æœä½ å·²ç»å‡çº§åˆ°V13ï¼Œä¸ç”¨çœ‹äº†ã€‚</p><p>å¦‚æœä½ å·²ç»å‡çº§åˆ°V13ï¼Œä¸ç”¨çœ‹äº†ã€‚</p><h1 id="åœæ­¢å‡çº§"><a href="#åœæ­¢å‡çº§" class="headerlink" title="åœæ­¢å‡çº§"></a>åœæ­¢å‡çº§</h1><p>æˆ‘ä¸€èˆ¬å¾ˆå°‘çœ‹ç‰ˆæœ¬ï¼Œå°±æ²¡å‡çº§ï¼Œå°±å®³æ€•èƒŒåˆºï¼Œä¸€èˆ¬å…ˆå…³æ³¨å®Œå‡çº§å†…å®¹ï¼Œå†ç‚¹å‡çº§ã€‚è¿™æ¬¡æœ‰æœ‹å‹æé†’ï¼Œæ›´ä¸æ•¢å‡äº†ã€‚ä¸€ç›´åˆ°ç°åœ¨ï¼Œæ¯æ¬¡ç™»å½•è·¯ç”±åå°éƒ½å°å¿ƒç¿¼ç¿¼ï¼Œæ­¥æ­¥ä¸ºè¥ï¼Œç”Ÿæ€•ä¸å°å¿ƒç‚¹äº†é‚£ä¸€æ­¥åœ¨çº¿å‡çº§ã€‚å®ƒçš„é¦–é¡µé»˜è®¤è¿˜æ˜¯è¿›çš„mobileé¡µï¼Œè€Œä¸€è¿›å»ï¼Œå°±æœ‰ä¸€ä¸ªå¾ˆé†’ç›®çš„å‡çº§å¼¹çª—ã€‚åªè¦ä¸€ä¸å°å¿ƒç‚¹åˆ°å‡çº§ï¼Œä»æ­¤å’Œè·¯ç”±å™¨telnetæ— ç¼˜äº†ã€‚</p><p>è¿™ä¸è¡Œå•Šï¼ï¼ï¼ä¸‡ä¸€å“ªå¤©æ‰‹æ»‘äº†å°±å…¨å®Œäº†ã€‚</p><p>æŸ¥æºç ï¼Œè·¯ç”±å™¨çš„ç®¡ç†åå°éƒ½ä¿å­˜åœ¨wwwç›®å½•ï¼Œé¦–é¡µæ˜¯mobile.aspï¼Œç”¨viæŸ¥çœ‹ï¼Œæœ‰ä¸€è¡Œvar remote_version&#x3D;<GetRemoteVersion>çš„ä»£ç ï¼Œè¿™å°±æ˜¯ä»ç¯å¢ƒä¸­å–æœåŠ¡å™¨ç‰ˆæœ¬çš„ã€‚é¦–å…ˆæƒ³åˆ°çš„æ€è·¯æ˜¯è¿™æ ·ï¼šåªè¦å‘ç°è·¯ç”±æœ‰è¿‡é‡å¯ï¼Œåˆ™æ‰‹åŠ¨åœ¨var remote_version&#x3D;xxxxçš„ä¸‹ä¸€è¡Œæ’å…¥ä¸€è¡Œremote_version &#x3D; â€˜0;NX54V100R012â€™ã€‚å‰é¢çš„0ä»£è¡¨æ˜¯å¦å‡çº§ï¼Œåé¢ä¸é‡è¦ï¼Œå°±æ˜¯ç‰ˆæœ¬æ ‡è¯†ã€‚åœ¨å…¶å®ƒå‡ ä¸ªæœ‰å‡çº§çš„aspæ–‡ä»¶é‡Œéƒ½æ”¹ä¸€ä¸‹ã€‚</p><p>è¿™ä¹ˆä¸€æ¥ï¼Œå°±ç®—æ£€æµ‹åˆ°å‡çº§ï¼Œä¹Ÿä¸ä¼šæœ‰å‰ç«¯æç¤ºäº†ã€‚</p><h1 id="ç»æ€"><a href="#ç»æ€" class="headerlink" title="ç»æ€"></a>ç»æ€</h1><p>å…¶å®è¿™ä¸ªæ–¹æ¡ˆä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºå¥½å‡ ä¸ªaspæ–‡ä»¶é‡Œéƒ½æœ‰var remote_versionï¼Œå°±å¯¼è‡´æ¯ä¸ªæœ‰å‡çº§æç¤ºçš„é¡µé¢éƒ½è¦åšå¤„ç†ï¼Œä¸åˆé€‚ï¼Œè€Œä¸”è¿˜è¦å¯¹äººå®¶çš„å†…å®¹åšä¿®æ”¹ï¼Œå°±æƒ³ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚æ—¢ç„¶è·¯ç”±å™¨åœ¨æˆ‘å®¶ï¼Œç½‘ä¹Ÿåœ¨æˆ‘å®¶çš„ï¼Œh3cä½ å°±åˆ«è”ä½ çš„ç½‘äº†ã€‚</p><p>å‰é¢å µäº†å‰ç«¯ç‰ˆæœ¬å‡çº§æç¤ºæ˜¾ç¤ºåï¼Œæ—è¾¹ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬æ£€æµ‹çš„æŒ‰é’®ï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®ï¼Œä¼šå‘èµ·ä¸€ä¸ªè½®è¯¢ajaxè¯·æ±‚ï¼Œæœ€åè¿”å›å››ä¸ªæ•°å­—ï¼Œç„¶åå°±å‡ºå‡çº§æç¤ºã€‚çŒœæµ‹å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>å‘èµ·ajax</li><li>è·¯ç”±å™¨webæœåŠ¡å‘æœåŠ¡å™¨è¯·æ±‚å‡çº§å†…å®¹</li><li>è¯·æ±‚å®Œæˆåç»“æœå†™å…¥webæœåŠ¡</li><li>åˆ·æ–°é¡µé¢</li></ol><p>å¼€tcpdumpï¼Œæ˜ç¡®æ‰¾åˆ°äº†ä¸¤æ¡dnsè¯·æ±‚ï¼Œ<a href="http://www.h3c.com/">www.h3c.com</a> å’Œ magic.h3c.comï¼Œå…·ä½“åšäº†ä»€ä¹ˆï¼Œä¸å…³å¿ƒäº†ï¼Œä¹Ÿå› ä¸ºåšäº†httpsï¼Œç›’å­ä¸Šåšä¸­é—´äººæ¯”è¾ƒå¤æ‚ï¼Œå¯èƒ½ä¸ä¸€å®šèƒ½è¡Œã€‚ç»æµ‹è¯•ï¼Œä¸»è¦è¿˜æ˜¯magic.h3c.comã€‚</p><p>&#x2F;etc&#x2F;hostsæ·»åŠ  127.0.0.1 magic.h3c.com</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;127.0.0.1 magic.h3c.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æ”¾å¿ƒ è¿˜å¯ä»¥iptableså°ip</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -I OUTPUT -d 114.x.x.x -j DROP</span><br><span class="line">iptables -I OUTPUT -d 114.x.x.x -j DROP</span><br></pre></td></tr></table></figure><p>é‡å¯ä¼šæ¢å¤ï¼Œè‡³äºä»€ä¹ˆæ—¶å€™è¿è¡Œè¿™ä¸¤æ¡ï¼Œæˆ‘å°±ä¸å†™äº†ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´ï¼Œæœ‹å‹å¾®ä¿¡ä¸Šå’Œæˆ‘è¯´ï¼ŒNX54å‡çº§å›ºä»¶äº†ï¼Œå‡çº§åï¼Œdebugæ¨¡å¼è¿›ä¸äº†ï¼Œtelnetä¹Ÿæ‰“ä¸å¼€äº†ã€‚è‡³æ­¤ï¼Œæˆ‘ä¹‹å‰åˆ†äº«çš„ipv6çº¯å®šåˆ¶çš„æ–¹æ¡ˆï¼Œå¤±æ•ˆäº†ï¼Œåªå‰©ä¸‹ä¸€ç§æ–¹å¼ï¼šipv6é˜²ç«å¢™å¼€å…³ã€‚å½“ç„¶ï¼Œä¹Ÿæ˜¯å¯ä»¥æ»¡è¶³ipv6è®¿é—®çš„ï¼Œåªä¸è¿‡ä¸å¯ä»¥åªå¼€æ”¾æŒ‡å®šçš„v6ipäº†ã€‚ç®€å•åæ§½ä¸€ä¸‹è¿™æ¬¡å‡çº§ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¸å¯é™çº§ã€‚ä¸Šäº†v13åï¼Œå°±ç®—ä½ ä¿å­˜äº†æ—§å›ºä»¶ï¼Œä¹Ÿä¸å¯ä»¥é™çº§ã€‚&lt;/li&gt;
&lt;li&gt;ä¸å¯debugã€‚åŠ äº†å¯†ç è¢«å µæ­»äº†ã€‚&lt;/li&gt;
&lt;li&gt;telneté»˜è®¤å…³é—­ã€‚ä¹‹å‰é…ç½®æ–‡ä»¶ä¸­å…³äºtelnetçš„è®¾ç½®ï¼Œæ–°ç‰ˆæœ¬ä¸Šæ²¡æœ‰äº†ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ¬ç¯‡ä¸ç®—ä»€ä¹ˆé»‘ç§‘æŠ€ï¼Œå°±æ˜¯æ‰¾ä¸€æ‰¾å‡çº§çš„ç½‘ç»œï¼Œç„¶ååœæ‰ï¼Œç®—æ˜¯ä¸€ä¸ªå°æ€è·¯ï¼Œä½†å‡¡æ‡‚ç‚¹ç½‘ç»œçŸ¥è¯†çš„ï¼Œåº”è¯¥éƒ½èƒ½æ˜ç™½ã€‚è¿™æ¬¡å‡çº§åï¼Œè€ç‰ˆæœ¬ä¸”ç”¨ä¸”çæƒœå§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="nx54" scheme="https://lefo.me/categories/nx54/"/>
    
    
    <category term="h3c" scheme="https://lefo.me/tags/h3c/"/>
    
    <category term="nx54" scheme="https://lefo.me/tags/nx54/"/>
    
  </entry>
  
  <entry>
    <title>androidæ‰“åŒ…å›ºå®šid</title>
    <link href="https://lefo.me/2025/10/24/public-ids/"/>
    <id>https://lefo.me/2025/10/24/public-ids/</id>
    <published>2025-10-24T03:11:27.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>6æœˆä»½è·³æ§½æ¥äº†ä¸€å®¶å¹¿å‘Šå…¬å¸ï¼Œæ•´ä¸ªä¸šåŠ¡é€»è¾‘å°±æ˜¯æµé‡ç©æ³•ï¼Œä¸Šæ¶å¸‚åœºï¼Œä¹°é‡ï¼Œèµšå¹¿å‘Šè´¹ã€‚å› ä¸ºgpä¸Šæ¶è¶Šæ¥è¶Šéš¾ï¼Œå°±è¡ç”Ÿå‡ºä¸€ç§ç©æ³•å«ABé¢ã€‚å…³äºABé¢ï¼Œè¿™é‡Œå…ˆä¸è®²ï¼Œä¸»è¦è¯´è¯´BåŒ…çš„èµ„æºå¤„ç†ã€‚è¿™ç¯‡æ²¡æŠ€æœ¯ï¼Œå•çº¯è‡ªå·±è®°ä¸‹æ¥å½“ç¬”è®°ç”¨ã€‚</p><h1 id="id"><a href="#id" class="headerlink" title="id"></a>id</h1><p>idå…¶å®æ˜¯ä¸ªæ•´æ•°ï¼Œåº”ç”¨å†…çš„idä¸€èˆ¬æƒ…å†µæ˜¯<code>0x7fxxxxxx</code>ï¼Œè¿™ä¸ªhexå…¶å®æ˜¯<code>package</code>,<code>type</code>,<code>value</code>çš„ç»“æ„ã€‚è€Œä»£ç ä¸­å¦‚æœæœ‰R.id.xxï¼Œä¼šåœ¨ç¼–è¯‘æ—¶ç›´æ¥æ›¿æ¢æˆè¯¥æ•´æ•°ã€‚åšABé¢çš„åŒ…ï¼ŒBåŒ…éƒ½æ˜¯é€šè¿‡åŠ¨æ€åŠ è½½çš„ï¼Œè¿™å°±å¯¼è‡´è¿™ä¸ªæ•´æ•°ï¼Œå¿…é¡»åœ¨ä½¿ç”¨æ—¶ï¼Œå’Œä½ çš„èµ„æºå¯¹åº”ã€‚10å¹´æœ‰ï¼Œæœ‰ç§ç²—æš´çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯æ„å»ºä¸€ä¸ªè‡ªå·±çš„aaptï¼Œå¯ä»¥æŒ‡å®š<code>package</code>ï¼Œä¹Ÿå°±æ˜¯å‰é¢çš„<code>7f</code>ï¼Œç„¶åå†ç”¨æ·»åŠ Resourcesçš„æ–¹å¼ï¼Œå°†èµ„æºæ·»åŠ åˆ°èµ„æºç®¡ç†å™¨ä¸­ã€‚è¿™æ ·å°±èƒ½ä¸€åŠ³æ°¸é€¸ã€‚BåŒ…æ‰“åŒ…ï¼Œä½¿ç”¨0x7eçš„èµ„æºï¼ŒAåŒ…ä¸å¤„ç†ï¼Œè¿™æ ·ABçš„èµ„æºå°±ä¸ä¼šå†²çªã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">    aaptOptions &#123;</span><br><span class="line">        additionalParameters <span class="string">&quot;--package-id&quot;</span>, <span class="string">&quot;0x7E&quot;</span>, <span class="string">&quot;--allow-reserved-package-id&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><span id="more"></span><h1 id="å›ºå®šid"><a href="#å›ºå®šid" class="headerlink" title="å›ºå®šid"></a>å›ºå®šid</h1><p>ä¸Šè¿°æ–¹æ³•æ˜¯æ‰“åŒ…äº†ä¸¤å¥—resourceï¼Œç¼ºç‚¹å°±æ˜¯éœ€è¦å°†è‡ªå·±çš„Resourcesæ·»åŠ åˆ°ç³»ç»ŸResourcesï¼Œå¦‚æœèµ„æºå°‘ï¼Œåˆæƒ³å°½é‡é¿å…åŠ¨æ€åŠ è½½èµ„æºï¼Œç›´æ¥æŒ‡å®šéœ€è¦æŒ‡å®šçš„èµ„æºidå°±è¡Œã€‚è€Œaaptæ°å¥½å°±æä¾›äº†ä¸€ä¸ªå‚æ•°<code>--stable-ids</code>ã€‚</p><ol><li>åœ¨AåŒ…ä¸­å¯¹åº”èµ„æºä½ç½®æ·»åŠ BåŒ…çš„èµ„æºï¼Œæ„å»ºBåŒ…</li><li>åœ¨build&#x2F;intermediates&#x2F;stable_resource_ids_file&#x2F;release&#x2F;processReleaseResources&#x2F;stableIds.txtï¼Œèƒ½æ‰¾åˆ°BåŒ…çš„èµ„æºï¼Œå¤åˆ¶ä½ æƒ³è¦å›ºå®šçš„idã€‚</li><li>å°†å¤åˆ¶å‡ºæ¥çš„å†…å®¹ï¼ŒåŠ åˆ°app&#x2F;public.txt</li><li>gradleæ·»åŠ å¦‚ä¸‹ï¼Œç„¶åbuildã€‚<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">    aaptOptions &#123;</span><br><span class="line">        <span class="comment">// æ³¨æ„è·¯å¾„</span></span><br><span class="line">        File publicTxtFile = project.file(<span class="string">&#x27;public.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> (publicTxtFile.exists()) &#123;</span><br><span class="line">            project.logger.error <span class="string">&quot;$&#123;publicTxtFile&#125; exists, apply it.&quot;</span></span><br><span class="line">            <span class="comment">//-stable-ids</span></span><br><span class="line">            aaptOptions.additionalParameters(<span class="string">&quot;--stable-ids&quot;</span>, <span class="string">&quot;$&#123;publicTxtFile&#125;&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            project.logger.error <span class="string">&quot;$&#123;publicTxtFile&#125; not exists&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>æ„å»ºå®Œæˆä¸æ”¾å¿ƒå¯ä»¥Analyze APKçœ‹ä¸€çœ‹</li></ol><h1 id="å…¶å®ƒæ–¹æ¡ˆ"><a href="#å…¶å®ƒæ–¹æ¡ˆ" class="headerlink" title="å…¶å®ƒæ–¹æ¡ˆ"></a>å…¶å®ƒæ–¹æ¡ˆ</h1><ol><li>è‡ªå®šä¹‰aaptã€dexå­—èŠ‚ä¿®æ”¹ï¼Œå¸‚é¢ä¸Šæœ‰ä¸€äº›å¼€æºå·¥å…·ã€‚</li><li>è½¬æ¢è°ƒç”¨ã€‚11å¹´çš„æ—¶å€™ï¼Œåšè¿‡ä¸€æ¬¾sdkï¼Œå½“æ—¶é‡‡ç”¨çš„æ˜¯æä¾›äº†ä¸€ä¸ªå·¥å…·ç±»ï¼ŒåŒ…å«ä¸€å †getxxxIDå‡½æ•°ã€‚ç„¶åï¼Œæ‰€æœ‰è°ƒç”¨èµ„æºå…¨ä½¿ç”¨getå‡½æ•°è°ƒç”¨ä¸æ‰“å…¥jaråŒ…(å¯ä»¥ç†è§£ä¸ºBåŒ…)ï¼Œå·¥å…·ç±»æä¾›ç»™å•†æˆ·(AåŒ…)ã€‚</li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;6æœˆä»½è·³æ§½æ¥äº†ä¸€å®¶å¹¿å‘Šå…¬å¸ï¼Œæ•´ä¸ªä¸šåŠ¡é€»è¾‘å°±æ˜¯æµé‡ç©æ³•ï¼Œä¸Šæ¶å¸‚åœºï¼Œä¹°é‡ï¼Œèµšå¹¿å‘Šè´¹ã€‚å› ä¸ºgpä¸Šæ¶è¶Šæ¥è¶Šéš¾ï¼Œå°±è¡ç”Ÿå‡ºä¸€ç§ç©æ³•å«ABé¢ã€‚å…³äºABé¢ï¼Œè¿™é‡Œå…ˆä¸è®²ï¼Œä¸»è¦è¯´è¯´BåŒ…çš„èµ„æºå¤„ç†ã€‚è¿™ç¯‡æ²¡æŠ€æœ¯ï¼Œå•çº¯è‡ªå·±è®°ä¸‹æ¥å½“ç¬”è®°ç”¨ã€‚&lt;/p&gt;
&lt;h1 id=&quot;id&quot;&gt;&lt;a href=&quot;#id&quot; class=&quot;headerlink&quot; title=&quot;id&quot;&gt;&lt;/a&gt;id&lt;/h1&gt;&lt;p&gt;idå…¶å®æ˜¯ä¸ªæ•´æ•°ï¼Œåº”ç”¨å†…çš„idä¸€èˆ¬æƒ…å†µæ˜¯&lt;code&gt;0x7fxxxxxx&lt;/code&gt;ï¼Œè¿™ä¸ªhexå…¶å®æ˜¯&lt;code&gt;package&lt;/code&gt;,&lt;code&gt;type&lt;/code&gt;,&lt;code&gt;value&lt;/code&gt;çš„ç»“æ„ã€‚è€Œä»£ç ä¸­å¦‚æœæœ‰R.id.xxï¼Œä¼šåœ¨ç¼–è¯‘æ—¶ç›´æ¥æ›¿æ¢æˆè¯¥æ•´æ•°ã€‚åšABé¢çš„åŒ…ï¼ŒBåŒ…éƒ½æ˜¯é€šè¿‡åŠ¨æ€åŠ è½½çš„ï¼Œè¿™å°±å¯¼è‡´è¿™ä¸ªæ•´æ•°ï¼Œå¿…é¡»åœ¨ä½¿ç”¨æ—¶ï¼Œå’Œä½ çš„èµ„æºå¯¹åº”ã€‚10å¹´æœ‰ï¼Œæœ‰ç§ç²—æš´çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯æ„å»ºä¸€ä¸ªè‡ªå·±çš„aaptï¼Œå¯ä»¥æŒ‡å®š&lt;code&gt;package&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯å‰é¢çš„&lt;code&gt;7f&lt;/code&gt;ï¼Œç„¶åå†ç”¨æ·»åŠ Resourcesçš„æ–¹å¼ï¼Œå°†èµ„æºæ·»åŠ åˆ°èµ„æºç®¡ç†å™¨ä¸­ã€‚è¿™æ ·å°±èƒ½ä¸€åŠ³æ°¸é€¸ã€‚BåŒ…æ‰“åŒ…ï¼Œä½¿ç”¨0x7eçš„èµ„æºï¼ŒAåŒ…ä¸å¤„ç†ï¼Œè¿™æ ·ABçš„èµ„æºå°±ä¸ä¼šå†²çªã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight groovy&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    aaptOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        additionalParameters &lt;span class=&quot;string&quot;&gt;&amp;quot;--package-id&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;0x7E&amp;quot;&lt;/span&gt;, &lt;span class=&quot;string&quot;&gt;&amp;quot;--allow-reserved-package-id&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>é¥é¥é¢†å…ˆçš„DNSé…ç½®</title>
    <link href="https://lefo.me/2025/08/18/fk-hw-dns/"/>
    <id>https://lefo.me/2025/08/18/fk-hw-dns/</id>
    <published>2025-08-18T15:01:19.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰åœ¨å®¶é‡Œçš„å¼€å‘æœºä¸Šé…äº†ç§‘æŠ€ï¼Œä½†æ˜¯åª³å¦‡çš„é¥é¥é¢†å…ˆæ‰‹æœºä¸€ç›´ä½¿ç”¨ä¸äº†ï¼Œå¤§æ¦‚æ’æŸ¥äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯dnsè§£æçš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘æŠŠæˆ‘è·¯ç”±fake ipçš„ä¸‹ä¸€è·³æŒ‡åˆ°äº†å†…ç½‘ä¸€å°è®¾å¤‡ä¸Šï¼Œä½†æ˜¯æˆ‘ç”¨å·¥å…·æŸ¥ä¸‹ä¸€è·³è¿˜æ˜¯ç§»åŠ¨ç½‘å…³(10.41.x.x)ã€‚ä¸èƒ½å¿ï¼Œå¼€tcpdumpæŸ¥ã€‚</p><span id="more"></span><h1 id="æµé‡"><a href="#æµé‡" class="headerlink" title="æµé‡"></a>æµé‡</h1><p>ç›´æ¥åœ¨ç½‘å…³ä¸Šå¼€tcpdump</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i &lt;interface&gt; | grep &lt;local ip&gt;</span><br></pre></td></tr></table></figure><p>ç»è¿‡ç®€å•è·Ÿè¸ªï¼Œå‘ç°è¯¥æ‰‹æœºæœ‰ä¸€ä¸ª<code>ecs-49-4-x-x.compute.hwclouds-dns.com</code>çš„è¯·æ±‚ï¼Œç«¯å£æ˜¯5223ï¼Œåé¢è¿˜æœ‰443çš„è¯·æ±‚ï¼Œç›²çŒœåº”è¯¥æ˜¯DNSå’ŒDoTçš„è¯·æ±‚ã€‚å¼€iptableså°ipæ®µã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A FORWARD -d 49.4.0.0/16 -j DROP</span><br></pre></td></tr></table></figure><p>å°äº†åæˆåŠŸäº†ï¼Œç»“æœåˆšåˆ·äº†ä¸¤ä¸ªç½‘é¡µï¼Œåˆæ— æ•ˆäº†ï¼Œå†æŸ¥å‘ç°ipæ®µæ¢äº†ã€‚åˆšå¥½ecsåé¢è·Ÿçš„å°±æ˜¯ipã€‚</p><h1 id="kill-domain"><a href="#kill-domain" class="headerlink" title="kill domain"></a>kill domain</h1><p>ä¸Šmosdnsç›´æ¥å°æ­»åŸŸå</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tag: &quot;fck_hw&quot;</span><br><span class="line">type: &quot;sequence&quot;</span><br><span class="line">args:  # []rule</span><br><span class="line">  - matches:                # []string, åŒ¹é…æ¡ä»¶ã€‚å¤šä¸ªåŒ¹é…æ¡ä»¶ä¸º AND å…³ç³»ã€‚</span><br><span class="line">    - qname domain:hwclouds-dns.com      # å°æ­»å½“å‰åŠæ‰€æœ‰å­åŸŸ</span><br><span class="line">    exec: reject 3 </span><br></pre></td></tr></table></figure><p>æå®šæ”¶æ‘Š</p><h1 id="æ€»ç»“å¦‚ä¸‹ï¼š"><a href="#æ€»ç»“å¦‚ä¸‹ï¼š" class="headerlink" title="æ€»ç»“å¦‚ä¸‹ï¼š"></a>æ€»ç»“å¦‚ä¸‹ï¼š</h1><p>é¥é¥é¢†å…ˆåº”è¯¥æ˜¯åšäº†æŸç§æœåŠ¡ï¼Œä¼˜å…ˆä½¿ç”¨å®ƒçš„dnsã€‚å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VPN &gt; HUAWEI DNS &gt; ROUTE DNS</span><br></pre></td></tr></table></figure><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆç”¨æ‰‹æœºå¼€å¯VPNæœåŠ¡å¯ä»¥ï¼Œä½†æ˜¯ç›´æ¥é…ç½‘å…³å°±ä¸è¡Œï¼Œè¿™æ¬¡å°äº†å®ƒçš„dnsåŸŸåï¼Œå°±é»˜è®¤èµ°ç½‘ç»œçš„é…ç½®äº†ã€‚å¿ä¸ä½æƒ³åæ§½ï¼Œä½ æ—¢ç„¶è‡ªå·±æäº†DNSï¼Œè¿˜è£…æ¨¡ä½œæ ·çš„åœ¨wifié‡Œç•™ä»€ä¹ˆdnsåœ°å€ï¼Œåˆéªšåˆç‹—ã€‚ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹è¯´å…³é—­å®‰å…¨dnsï¼Œä½†æˆ‘çš„æ‰‹æœºæœ¬æ²¡æœ‰å¼€ï¼Œè¿™å¥—æµç¨‹å°±æ˜¯é»˜è®¤å†…ç½®çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¹‹å‰åœ¨å®¶é‡Œçš„å¼€å‘æœºä¸Šé…äº†ç§‘æŠ€ï¼Œä½†æ˜¯åª³å¦‡çš„é¥é¥é¢†å…ˆæ‰‹æœºä¸€ç›´ä½¿ç”¨ä¸äº†ï¼Œå¤§æ¦‚æ’æŸ¥äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯dnsè§£æçš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘æŠŠæˆ‘è·¯ç”±fake ipçš„ä¸‹ä¸€è·³æŒ‡åˆ°äº†å†…ç½‘ä¸€å°è®¾å¤‡ä¸Šï¼Œä½†æ˜¯æˆ‘ç”¨å·¥å…·æŸ¥ä¸‹ä¸€è·³è¿˜æ˜¯ç§»åŠ¨ç½‘å…³(10.41.x.x)ã€‚ä¸èƒ½å¿ï¼Œå¼€tcpdumpæŸ¥ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="linux" scheme="https://lefo.me/categories/linux/"/>
    
    
    <category term="linux" scheme="https://lefo.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>android 14å®‰è£…CAè¯ä¹¦</title>
    <link href="https://lefo.me/2025/07/31/android-14-install-ca/"/>
    <id>https://lefo.me/2025/07/31/android-14-install-ca/</id>
    <published>2025-07-31T09:18:29.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰ä¸¤å¤©ç»™æ¨¡æ‹Ÿå™¨ä¸Šå®‰è£…CAè¯ä¹¦ï¼Œå‘ç°å³ä½¿æ”¾å…¥<code>/system/etc/security/cacerts/</code>ï¼Œä¾ç„¶ä¸èƒ½ç”¨CharlesæŠ“åŒ…ï¼Œè®¾ç½®é‡ŒæŸ¥çœ‹ï¼Œè¯ä¹¦ä¹Ÿæ²¡æœ‰ç”Ÿæ•ˆï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€ç¯‡è¯¦ç»†ä»‹ç»åŸå› çš„æ–‡ç« ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åæ›´å¥½æ‰¾ã€‚</p><h1 id="å‡†å¤‡è¯ä¹¦"><a href="#å‡†å¤‡è¯ä¹¦" class="headerlink" title="å‡†å¤‡è¯ä¹¦"></a>å‡†å¤‡è¯ä¹¦</h1><p>å‡†å¤‡ä½ çš„SSLè¯ä¹¦ï¼Œé‡å‘½åã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opensslÂ x509Â -informÂ PEMÂ -subject_hash_oldÂ -<span class="keyword">in</span>Â charles_ssl.pem | <span class="built_in">head</span> -1</span><br><span class="line"><span class="comment">#å°†è¯ä¹¦å‘½åä¸ºå¾—åˆ°çš„çš„ç»“æœ.0</span></span><br><span class="line">adb push xxxxxx.0 /sdcard/</span><br></pre></td></tr></table></figure><span id="more"></span><h1 id="é…ç½®avd"><a href="#é…ç½®avd" class="headerlink" title="é…ç½®avd"></a>é…ç½®avd</h1><p>é¦–å…ˆä½ å¾—æ˜¯å¯å†™å…¥çš„æ¨¡æ‹Ÿå™¨ï¼Œæ‰€ä»¥è¿è¡Œä»¥ä¸‹shellï¼Œæ³¨æ„æ›¿æ¢ä½ çš„Device</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">emulator -avd Pixel_API_34 -writable-system</span><br><span class="line">adb root</span><br><span class="line">adb remount</span><br></pre></td></tr></table></figure><p>å°†ä¸‹åˆ—è„šæœ¬ä¿å­˜æˆshæ–‡ä»¶</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a separate temp directory, to hold the current certificates</span></span><br><span class="line"><span class="comment"># Otherwise, when we add the mount we can&#x27;t read the current certs anymore.</span></span><br><span class="line"><span class="built_in">mkdir</span> -p -m 700 /data/local/tmp/tmp-ca-copy</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy out the existing certificates</span></span><br><span class="line"><span class="built_in">cp</span> /apex/com.android.conscrypt/cacerts/* /data/local/tmp/tmp-ca-copy/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the in-memory mount on top of the system certs folder</span></span><br><span class="line">mount -t tmpfs tmpfs /system/etc/security/cacerts</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy the existing certs back into the tmpfs, so we keep trusting them</span></span><br><span class="line"><span class="built_in">mv</span> /data/local/tmp/tmp-ca-copy/* /system/etc/security/cacerts/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy our new cert in, so we trust that too</span></span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$CERTIFICATE_PATH</span> /system/etc/security/cacerts/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Update the perms &amp; selinux context labels</span></span><br><span class="line"><span class="built_in">chown</span> root:root /system/etc/security/cacerts/*</span><br><span class="line"><span class="built_in">chmod</span> 644 /system/etc/security/cacerts/*</span><br><span class="line"><span class="built_in">chcon</span> u:object_r:system_file:s0 /system/etc/security/cacerts/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deal with the APEX overrides, which need injecting into each namespace:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># First we get the Zygote process(es), which launch each app</span></span><br><span class="line">ZYGOTE_PID=$(pidof zygote || <span class="literal">true</span>)</span><br><span class="line">ZYGOTE64_PID=$(pidof zygote64 || <span class="literal">true</span>)</span><br><span class="line"><span class="comment"># N.b. some devices appear to have both!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apps inherit the Zygote&#x27;s mounts at startup, so we inject here to ensure</span></span><br><span class="line"><span class="comment"># all newly started apps will see these certs straight away:</span></span><br><span class="line"><span class="keyword">for</span> Z_PID <span class="keyword">in</span> <span class="string">&quot;<span class="variable">$ZYGOTE_PID</span>&quot;</span> <span class="string">&quot;<span class="variable">$ZYGOTE64_PID</span>&quot;</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$Z_PID</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">        nsenter --mount=/proc/<span class="variable">$Z_PID</span>/ns/mnt -- \</span><br><span class="line">            /bin/mount --<span class="built_in">bind</span> /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Then we inject the mount into all already running apps, so they</span></span><br><span class="line"><span class="comment"># too see these CA certs immediately:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the PID of every process whose parent is one of the Zygotes:</span></span><br><span class="line">APP_PIDS=$(</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$ZYGOTE_PID</span> <span class="variable">$ZYGOTE64_PID</span>&quot;</span> | \</span><br><span class="line">    xargs -n1 ps -o <span class="string">&#x27;PID&#x27;</span> -P | \</span><br><span class="line">    grep -v PID</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inject into the mount namespace of each of those apps:</span></span><br><span class="line"><span class="keyword">for</span> PID <span class="keyword">in</span> <span class="variable">$APP_PIDS</span>; <span class="keyword">do</span></span><br><span class="line">    nsenter --mount=/proc/<span class="variable">$PID</span>/ns/mnt -- \</span><br><span class="line">        /bin/mount --<span class="built_in">bind</span> /system/etc/security/cacerts /apex/com.android.conscrypt/cacerts &amp;</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"><span class="built_in">wait</span> <span class="comment"># Launched in parallel - wait for completion here</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;System certificate injected&quot;</span></span><br></pre></td></tr></table></figure><p>å°†shè„šæœ¬æ¨é€åˆ°ä»»æ„ç›®å½•ï¼Œç„¶åé…ä¸€ä¸ªCERTIFICATE_PATHå˜é‡ï¼Œç„¶åæ‰§è¡Œsh</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">adb push install-ca.sh /data/local/</span><br><span class="line">adb shell</span><br><span class="line">export CERTIFICATE_PATH=/sdcard/xxxxxx.0</span><br><span class="line">chmod +x /data/local/install-ca.sh</span><br><span class="line">/data/local/install-ca.sh</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://httptoolkit.com/blog/android-14-install-system-ca-certificate/">ä»£ç æ‘˜è‡ªè¿™é‡Œ</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å‰ä¸¤å¤©ç»™æ¨¡æ‹Ÿå™¨ä¸Šå®‰è£…CAè¯ä¹¦ï¼Œå‘ç°å³ä½¿æ”¾å…¥&lt;code&gt;/system/etc/security/cacerts/&lt;/code&gt;ï¼Œä¾ç„¶ä¸èƒ½ç”¨CharlesæŠ“åŒ…ï¼Œè®¾ç½®é‡ŒæŸ¥çœ‹ï¼Œè¯ä¹¦ä¹Ÿæ²¡æœ‰ç”Ÿæ•ˆï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€ç¯‡è¯¦ç»†ä»‹ç»åŸå› çš„æ–‡ç« ï¼Œè®°å½•ä¸€ä¸‹ï¼Œä»¥åæ›´å¥½æ‰¾ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å‡†å¤‡è¯ä¹¦&quot;&gt;&lt;a href=&quot;#å‡†å¤‡è¯ä¹¦&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡è¯ä¹¦&quot;&gt;&lt;/a&gt;å‡†å¤‡è¯ä¹¦&lt;/h1&gt;&lt;p&gt;å‡†å¤‡ä½ çš„SSLè¯ä¹¦ï¼Œé‡å‘½åã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;opensslÂ x509Â -informÂ PEMÂ -subject_hash_oldÂ -&lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt;Â charles_ssl.pem | &lt;span class=&quot;built_in&quot;&gt;head&lt;/span&gt; -1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#å°†è¯ä¹¦å‘½åä¸ºå¾—åˆ°çš„çš„ç»“æœ.0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;adb push xxxxxx.0 /sdcard/&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>mac minié…åˆlinuxå½“æœåŠ¡å™¨ä½¿ç”¨</title>
    <link href="https://lefo.me/2025/04/24/macmini/"/>
    <id>https://lefo.me/2025/04/24/macmini/</id>
    <published>2025-04-24T15:39:17.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æˆ‘ä¸»ä¸šæ˜¯å®‰å“å¼€å‘ï¼Œä½†ä¸åŠ¡æ­£ä¸šçš„æˆ‘åˆåœ¨æŠ˜è…¾åˆ«çš„äº†ã€‚</p><p>ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äº NX54 å¦‚ä½•é…ç½® iptables ä»¥å¼€æ”¾æŒ‡å®š IP çš„ IPv6 é˜²ç«å¢™è§„åˆ™ã€‚æœ€è¿‘åˆæŠŠæ‰‹ä¸Šçš„ä¸€å— 14 å¹´çš„åºŸå¼ƒ ARM å¼€å‘æ¿ç¿»å‡ºæ¥ï¼ŒæŒ‚äº†å—ç¡¬ç›˜ï¼Œè®©æˆ‘åœ¨ä»»æ„è®¾å¤‡ä¸Šéƒ½èƒ½è®¿é—®å®¶é‡Œçš„ç½‘ç»œã€‚è¦è¯´è¿™å—æ¿å­ï¼Œå®˜æ–¹ç³»ç»Ÿåªåˆ°ubuntu 2014ï¼Œè¿python3éƒ½æ²¡æ³•è£…ï¼Œä¹‹å‰æŠ˜è…¾è¿‡armbianï¼Œä½†kernelæœ‰é—®é¢˜ï¼Œusbä¸å·¥ä½œã€‚æœ€è¿‘çœ‹è®ºå›å»å¹´æœ‰äººå‡çº§äº†å†…æ ¸äº†ï¼Œèµ¶ç´§æ¢ä¸€ä¸‹ç³»ç»Ÿã€‚</p><p>è¿‡å¹´æœŸé—´å®¶å±é€äº†ä¸€å° Mac miniï¼ˆç°åœ¨ç™¾äº¿è¡¥è´´å…¥æ‰‹ä»· 2899ï¼Œè¡€äº 600ï¼‰ï¼Œäºæ˜¯æˆ‘åˆæŠ˜è…¾äº†ä¸€ä¸‹ï¼ŒæŠŠæ•´ä¸ªç½‘ç»œé‡æ–°æ•´ç†äº†ä¸€éã€‚ç†¬äº†å‡ ä¸ªå¤œæ™šå’Œåˆä¼‘æ—¶é—´ï¼Œæ€»ç®—å¼„å¥½äº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p><h1 id="ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ"><a href="#ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ" class="headerlink" title="ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ"></a>ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ</h1><ol><li>æ¡¥æ¥è·¯ç”±ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥è·å–å…¬ç½‘ipv6åœ°å€ï¼Œä¾›è‡ªå·±åœ¨å¤–è¾¹è¿æ¥ã€‚</li><li>å…³é˜²ç«å¢™ã€‚å¤§å¤šæ•°è·¯ç”±å™¨éƒ½æœ‰ipv6é˜²ç«å¢™ï¼Œåƒæˆ‘çš„NX54å°±æ˜¯åŸºäºip6tablesçš„é…ç½®ï¼Œéœ€è¦å…³æ‰ã€‚æˆ‘æ˜¯åªå…³æ‰äº†æˆ‘çš„linuxçš„ipã€‚æˆ‘ä½¿ç”¨äº†è„šæœ¬è‡ªåŠ¨æ›´æ–°ï¼Œè„šæœ¬æµç¨‹å¦‚ä¸‹ï¼š <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">linuxå®šæ—¶ä»»åŠ¡ -&gt; pythonè„šæœ¬ -&gt; è·å–ipv6 -&gt; å‘ç°å˜åŒ– -&gt; æ›´æ–°nx54é˜²ç«å¢™ -&gt; æ›´æ–°cloudflare dns AAAA(æœ€æ—©åšäº†ä¸€ç‰ˆå‘emailçš„ï¼Œåæ¥æ”¹ddnsäº†)</span><br></pre></td></tr></table></figure> ä¸å¾—ä¸è¯´ï¼ŒcloudflareçœŸçš„æ˜¯äº’è”ç½‘ä¹‹å…‰ï¼ŒåŸŸåä¾¿å®œï¼Œå…è´¹åŠ é€Ÿï¼Œè¿˜æä¾›Pagesï¼ŒWorkersã€‚</li><li>linuxå…³é—­sshå¯†ç è®¿é—®ï¼ŒæŠŠå¸¸ç”¨çš„è®¾å¤‡å…¬é’¥åŠ è¿›å»ã€‚<span id="more"></span>ç»è¿‡ä¸Šé¢çš„é…ç½®ï¼Œå¤–ç½‘åªèƒ½é€šè¿‡IPV6è®¿é—®åˆ°linuxï¼Œåˆ©ç”¨SSHå»ºç«‹éš§é“ï¼Œè¿˜èƒ½è¿æ¥å®¶é‡Œçš„ç”µè„‘ï¼Œæ–¹ä¾¿åˆå®‰å…¨ã€‚</li></ol><h1 id="Mac-miniå‡†å¤‡"><a href="#Mac-miniå‡†å¤‡" class="headerlink" title="Mac miniå‡†å¤‡"></a>Mac miniå‡†å¤‡</h1><h2 id="èƒ½æº"><a href="#èƒ½æº" class="headerlink" title="èƒ½æº"></a>èƒ½æº</h2><ul><li>âœ… é˜²æ­¢è¿›å…¥ç¡çœ  </li><li>âœ… å”¤é†’ä»¥ä¾›ç½‘ç»œè®¿é—®</li><li>âŒ å¦‚æœ‰å¯èƒ½ï¼Œå°†ç¡¬ç›˜ç½®äºç¡çœ çŠ¶æ€ </li><li>âœ… æ–­ç”µè‡ªåŠ¨é‡å¯</li></ul><h2 id="è¿œç¨‹æ¡Œé¢"><a href="#è¿œç¨‹æ¡Œé¢" class="headerlink" title="è¿œç¨‹æ¡Œé¢"></a>è¿œç¨‹æ¡Œé¢</h2><p>è®¾ç½® -&gt; é€šç”¨ -&gt; å…±äº« -&gt; å±å¹•å…±äº« &amp; è¿œç¨‹ç™»å½• &amp; æ–‡ä»¶å…±äº«<br>macæ”¯æŒå±å¹•åˆ†äº«ï¼Œä½†æ˜¯æ˜¯é€šè¿‡vnc:&#x2F;&#x2F;åè®®è®¿é—®çš„ï¼Œå¦‚æœè¦é€šè¿‡ARDï¼Œé‚£è¿˜éœ€è¦èŠ±å‡ ç™¾å—ä¹°è½¯ä»¶ã€‚å¹³æ›¿æ–¹æ¡ˆï¼šèµ°sshé€šé“</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 5900:192.168.x.x:5900 username@linux_ipv6</span><br></pre></td></tr></table></figure><p>command + spcae  å±å¹•åˆ†äº«  è¾“å…¥localhostå°±èƒ½è¿äº†ï¼Œå¦‚æ­¤ä¸€æ¥å°±æ˜¯åŠ å¯†çš„ã€‚æœ¬æ¥æˆ‘æ˜¯å‡†å¤‡ç”¨wireguardå»è¿æ¥çš„ï¼Œä½†ä¸€ç›´æ²¡ä»10.0.0.0ç©¿é€åˆ°192.168.x.xï¼Œä¸å¥½ç›´æ¥ç”¨sshéš§é“æ›´æ–¹ä¾¿ã€‚</p><h2 id="æ‰“å¼€è‡ªåŠ¨ç™»å½•"><a href="#æ‰“å¼€è‡ªåŠ¨ç™»å½•" class="headerlink" title="æ‰“å¼€è‡ªåŠ¨ç™»å½•"></a>æ‰“å¼€è‡ªåŠ¨ç™»å½•</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½® -&gt; ç”¨æˆ·ä¸ç¾¤ç»„ -&gt; è‡ªåŠ¨ä»¥æ­¤èº«ä»½ç™»å½•</span><br></pre></td></tr></table></figure><p>è¿™ä¸€é¡¹éå¸¸å…³é”®ï¼Œä¸ç„¶é‡å¯åå°±å¡åœ¨ç™»å½•ç•Œé¢ï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥å¯†ç ã€‚</p><h1 id="æœåŠ¡å¼€æœºå¯åŠ¨"><a href="#æœåŠ¡å¼€æœºå¯åŠ¨" class="headerlink" title="æœåŠ¡å¼€æœºå¯åŠ¨"></a>æœåŠ¡å¼€æœºå¯åŠ¨</h1><p>é€‚ç”¨ä¸€äº›éœ€è¦å¼€æœºå¯åŠ¨çš„æœåŠ¡ï¼Œå’Œlinuxä¸ä¸€æ ·ï¼Œä½¿ç”¨launchctlç®¡ç†ã€‚æ³¨æ„è„šæœ¬ä¸è¦æ”¾åœ¨Documentsï¼Œæ²¡æƒé™è®¿é—®ï¼Œè‡ªå·±åœ¨~ä¸‹æ–°å»ºä¸€ä¸ª</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">plist</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//Apple//DTD PLIST 1.0//EN&quot;</span> <span class="string">&quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plist</span> <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dict</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å”¯ä¸€çš„æ ‡è¯†ç¬¦ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>Label<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>yourshell.startup<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è¦æ‰§è¡Œçš„å‘½ä»¤ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>ProgramArguments<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">string</span>&gt;</span>/path/to/yourshell.sh<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åœ¨åŠ è½½æ—¶è‡ªåŠ¨å¯åŠ¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>RunAtLoad<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¦‚æœè„šæœ¬åœæ­¢ï¼Œä¿æŒè„šæœ¬è¿è¡Œ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>KeepAlive<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">true</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ä¸¢å¼ƒæ ‡å‡†è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardOutPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>/Dev/null<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ä¸¢å¼ƒæ ‡å‡†é”™è¯¯è¾“å‡º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">key</span>&gt;</span>StandardErrorPath<span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>/Dev/null<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dict</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plist</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åœæ­¢</span><br><span class="line">sudo launchctl bootout gui/$(id -u) ~/Library/LaunchAgents/yourshell.startup.plist</span><br><span class="line"># åŠ è½½</span><br><span class="line">sudo launchctl bootstrap gui/$(id -u) ~/Library/LaunchAgents/yourshell.startup.plist</span><br></pre></td></tr></table></figure><h1 id="æ‰“é€šè½¬å‘-linux-Mac-miniğŸªœ"><a href="#æ‰“é€šè½¬å‘-linux-Mac-miniğŸªœ" class="headerlink" title="æ‰“é€šè½¬å‘(linux -&gt; Mac miniğŸªœ)"></a>æ‰“é€šè½¬å‘(linux -&gt; Mac miniğŸªœ)</h1><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>æˆ‘ä½¿ç”¨ Linux ç½‘å…³é…åˆ MosDNS è¿›è¡Œ DNS åˆ†æµï¼š<code>ç›´è¿æµé‡</code>ä¸å¤„ç†ï¼Œè®¿é—®<code>å†…éƒ¨ç½‘ç«™</code>è§£æè™šæ‹Ÿipï¼Œç„¶åé€šè¿‡ iptables è¿›è¡Œè·¯ç”±è½¬å‘ã€‚ç”±äº Mac ä¸æ”¯æŒ TPROXYï¼Œæ‰€ä»¥æˆ‘åœ¨ Mac ä¸Šè¿è¡Œ SOCKS ä»£ç†ï¼Œç„¶ååœ¨ Linux ä¸Šä½¿ç”¨ TPROXY è½¬å‘è¿æ¥åˆ° SOCKSã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># ä¿®æ”¹iptables</span><br><span class="line">iptables -t mangle -N MYWAY 2&gt;/dev/null</span><br><span class="line">iptables -t mangle -F MYWAY</span><br><span class="line">iptables -t mangle -A MYWAY -d 198.18.0.0/16 -p tcp -j TPROXY --on-port &lt;tproxy_port&gt; --tproxy-mark 1</span><br><span class="line">iptables -t mangle -A MYWAY -d 198.18.0.0/16 -p udp -j TPROXY --on-port &lt;tproxy_port&gt; --tproxy-mark 1</span><br><span class="line">iptables -t mangle -D PREROUTING -j MYWAY 2&gt;/dev/null</span><br><span class="line">iptables -t mangle -A PREROUTING -j MYWAY</span><br><span class="line"></span><br><span class="line"># å¼€å¯NATè½¬å‘</span><br><span class="line">echo &quot;net.ipv4.ip_forward = 1&quot; | sudo tee -a /etc/sysctl.conf</span><br><span class="line">echo &quot;net.ipv4.conf.all.route_localnet=1&quot; | sudo tee -a /etc/sysctl.conf</span><br><span class="line">sysctl -p</span><br><span class="line"></span><br><span class="line"># natè½¬æ¢ æ³¨æ„è¿™é‡ŒåŒºåˆ†ä½ çš„ç½‘ç»œæ¥å£</span><br><span class="line">iptables -t nat -A POSTROUTING -o end0 -j MASQUERADE</span><br><span class="line"></span><br><span class="line"># è·¯ç”± æ³¨æ„è¿™ä¸¤æ¡ä¹Ÿè¦ä¿å­˜åˆ°rc.localï¼Œä¸ç„¶é‡å¯åå°±å¤±æ•ˆäº†ã€‚</span><br><span class="line">ip rule add fwmark 1 lookup 100</span><br><span class="line">ip route add local 0 0.0.0/0 dev lo table 100</span><br><span class="line"></span><br><span class="line"># ä¿å­˜ iptablesé…ç½®</span><br><span class="line">sudo iptables-save | sudo tee -a /etc/iptables/rules.v4</span><br><span class="line">sudo nano /etc/rc.local</span><br><span class="line"># æ·»åŠ  iptables-restore &lt; /etc/iptables/rules.v4</span><br><span class="line"># æ·»åŠ  ip rule add fwmark 1 lookup 100</span><br><span class="line"># æ·»åŠ  ip route add local 0 0.0. 0/0 dev lo table 100</span><br><span class="line"># ä¿å­˜</span><br><span class="line"></span><br><span class="line"># ç¡®ä¿æœ‰æ‰§è¡Œæƒé™</span><br><span class="line">sudo chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆå®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“± æ‰‹æœºï¼ˆæˆ–å…¶ä»–è®¾å¤‡ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ å‘èµ·è¯·æ±‚ï¼ˆä¾‹å¦‚ï¼šè®¿é—® https://www.example.comï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ ğŸ“¡ DNS è¯·æ±‚å‘é€è‡³ âœ 192.168.x.115ï¼ˆç½‘å…³è®¾å¤‡ä¸Šçš„ MosDNSï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”‚   â””â”€ MosDNS åˆ†æµï¼š</span><br><span class="line">â”‚       â”œâ”€ ç›´è¿åŸŸå â†’ ç›´è¿ï¼ˆè¿”å›çœŸå® IPï¼‰</span><br><span class="line">â”‚       â””â”€ å†…éƒ¨åŸŸå â†’ å‘ç»™ 113 ä¸Šçš„ DNSæœåŠ¡</span><br><span class="line">â”‚</span><br><span class="line">â”‚       â””â”€ DNSæœåŠ¡ è¿”å› fake-ipï¼ˆå¦‚ 198.18.0.xï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ æ‰‹æœºæ”¶åˆ° fake-ipï¼ˆä¾‹å¦‚ 198.18.0.33ï¼‰åå‘èµ·è¿æ¥</span><br><span class="line">     â†“</span><br><span class="line">     å‘å‡º TCP è¯·æ±‚ç›®æ ‡ï¼š198.18.0.33:443</span><br><span class="line">     â†“</span><br><span class="line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class="line">ğŸ›¡ï¸ ç½‘å…³è®¾å¤‡ï¼ˆ115ï¼‰iptables æ£€æµ‹</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ mangle è¡¨åŒ¹é…åˆ° fake-ip æ®µï¼ˆ198.18.0.0/16ï¼‰</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ TPROXY é‡å®šå‘æµé‡ â†’ æœ¬åœ°è½¬æ¢æœåŠ¡</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ è·¯ç”±ç­–ç•¥ï¼š</span><br><span class="line">â”‚   â””â”€ fwmark=1 â†’ local via loï¼ˆå›é€è‡³æœ¬åœ°è½¬æ¢æœåŠ¡</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ æœ¬åœ°è½¬æ¢æœåŠ¡ æ¥æ”¶åˆ°TPROXYæµé‡</span><br><span class="line">    â†“</span><br><span class="line">    è½¬å‘è‡³ ä»£ç†æœåŠ¡ï¼ˆ113ï¼‰çš„ Socks æœåŠ¡</span><br><span class="line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class="line">ğŸ§± ä»£ç†æœåŠ¡ï¼ˆ113ï¼‰å¤„ç†æµé‡</span><br><span class="line">â”‚</span><br><span class="line">â””â”€â”€ è®¿é—®ç›®æ ‡ç½‘ç«™ï¼ˆå¦‚ example.comï¼‰ï¼Œå»ºç«‹ TLS è¿æ¥</span><br><span class="line">    â†“</span><br><span class="line">    è¿”å›å“åº”</span><br><span class="line">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span><br><span class="line">â¬†ï¸ å›ç¨‹æµé‡è¿”å›æ‰‹æœºï¼Œè®¿é—®å®Œæˆ</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼Œå…¶å®å°±æ˜¯å°†115ä¸Šå¼€å¯è½¬å‘ï¼Œfake-ipæ®µæ ‡è®°1ï¼Œè¿›TPROXYï¼Œå†èµ°sockså‘åˆ°mac mini</p><h2 id="è¸©è¿‡çš„å‘"><a href="#è¸©è¿‡çš„å‘" class="headerlink" title="è¸©è¿‡çš„å‘"></a>è¸©è¿‡çš„å‘</h2><p>æœ‰äº›ç»†èŠ‚ä¸è¯´äº†ï¼Œæˆ‘è¿˜æœ‰ä»½è¯¦ç»†çš„ç¬”è®°ï¼Œä½†ä¸æ–¹ä¾¿æš´éœ²ã€‚è¿™é‡Œèµ°äº†ç‚¹å¼¯è·¯ï¼Œè¸©å‘æ€»ç»“ï¼š</p><ol><li>tproxy to socks æœ¬æ¥å°è¯•ç”¨å·¥å…·redsocksï¼ŒAIè¯´ä¸æ”¯æŒudpï¼Œæ”¾å¼ƒäº†ã€‚æ”¹ç”¨å¦ä¸€æ¬¾ï¼Œæ€§èƒ½ç¨å¾®å·®ç‚¹ï¼Œä½†æ”¯æŒçš„åè®®å¤šï¼Œé…ç½®ä¹Ÿç®€å•ã€‚</li><li>ä¸€å®šè¦é…<code>echo &quot;net.ipv4.conf.all.route_localnet=1&quot; | sudo tee -a /etc/sysctl.conf</code> è¿™ä¸€é¡¹æ‰å…è®¸è·¯ç”±loï¼Œæˆ‘æœ¬èº«å¯¹linuxçš„ç½‘ç»œç†Ÿç»ƒåº¦ä½ï¼Œå°±å› ä¸ºè¿™ä¸ªé…ç½®ï¼Œæäº†å¥½ä¹…ï¼ŒAIä¹Ÿä¸€ç›´æ²¡è®²ï¼Œåé¢ä¸€ç‚¹ç‚¹æŸ¥åˆ°çš„ã€‚</li><li>èµ·åˆç›´æ¥ä½¿ç”¨ TUN å®ç°ï¼Œæ¯•ç«Ÿæ˜¯ä¸ªè™šæ‹Ÿç½‘å¡ï¼Œæ‹›å‘¼äº†æ‰€æœ‰æµé‡ï¼Œåæ¥è§‰å¾—ä¸å¤Ÿä¼˜é›…ï¼Œæœ€ç»ˆæ”¹æˆ DNSåˆ†æµ + TPROXY + SOCKSï¼Œæ„Ÿè°¢ä¸€ä½å“¥ä»¬è·Ÿæˆ‘äº¤æµåç¡®å®šäº†æ–¹å‘ã€‚</li><li>ä¸ºä»€ä¹ˆéè¦å»ºåœ¨macä¸Šï¼Œå› ä¸ºå¼€å‘æ¿æ€§èƒ½å¤ªå·®ï¼Œè™½ç„¶è¿˜èƒ½æ’‘ï¼Œä½†èƒ½å°‘å®‰æœåŠ¡å°±å°‘å®‰å§ï¼Œå†µä¸”åœ¨æ–°macä¸ŠåŠ ä¸€ä¸ªè¿™ä¸ªæœåŠ¡è·‘ï¼Œå®Œå…¨ä¸å—å½±å“ã€‚æˆ‘åœ¨linuxä¸Šé¢è¿˜æœ‰ä¸ªAlist(æ¿å­åŸç”Ÿæ”¯æŒSATAï¼Œå°±æ¥äº†å—ç”µè„‘ç¡¬ç›˜)ã€‚</li><li>linuxä¸Šæœ‰ä¸ªsystemd-resolvedï¼Œè®°å¾—disableï¼Œå äº†53ç«¯å£ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸åšï¼Œéœ€è¦è®¾å¤‡ä¸ŠæŒ‡å®šDNSç«¯å£ã€‚</li></ol><h1 id="å±…ç„¶æ˜¯å†°çš„"><a href="#å±…ç„¶æ˜¯å†°çš„" class="headerlink" title="å±…ç„¶æ˜¯å†°çš„"></a>å±…ç„¶æ˜¯å†°çš„</h1><p>Mac miniè·‘å¥½å‡ å¤©äº†ï¼Œæ‘¸ä¸€æ‘¸è¡¨é¢å±…ç„¶æ˜¯å†°çš„ã€‚å®¶é‡Œå…»çŒ«ï¼ŒPDD 26ä¹°äº†ä¸ª3Dæ‰“å°çš„åº•åº§ï¼Œä¸æ˜¯15å—é‚£ä¸ªï¼Œä¸æ˜¯ä¸€ä¸ªåšå·¥ã€‚</p><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><ol><li>æˆ‘æŠŠç§‘æŠ€çš„æœåŠ¡æ­åœ¨äº†æˆ‘çš„linuxæ¿å­ä¸Šï¼Œå‘ç°å¼€ç½‘é¡µå˜çš„å¾ˆæ…¢ï¼Œcurlå·®ä¸å¤šï¼ŒçŒœæµ‹æ˜¯æœºå™¨å¤ªè€ï¼Œçº¿ç¨‹ä¸å¤Ÿï¼Œæ”¾å¼ƒäº†ï¼Œåˆè½¬å›æ¥mac miniäº†ã€‚</li><li>ä¸æƒ³æ‰‹æ”¹ipç½‘å…³äº†ï¼Œå°±åœ¨nx54è·¯ç”±å™¨ä¸Šé…äº†ä¸ªé™æ€è·¯ç”±<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip route add 198.18.0.0/16 via 192.168.x.115 dev br-lan</span><br></pre></td></tr></table></figure></li><li>115å¦‚æœä¹Ÿæƒ³ä¸€æ ·ï¼Œéœ€è¦æ ‡è®°ä¸€ä¸‹OUTPUTé“¾<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t mangle -A OUTPUT -d 198.18.0.0/16 -p tcp -j MARK --set-mark 1</span><br><span class="line">iptables -t mangle -A OUTPUT -d 198.18.0.0/16 -p udp -j MARK --set-mark 1</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;æˆ‘ä¸»ä¸šæ˜¯å®‰å“å¼€å‘ï¼Œä½†ä¸åŠ¡æ­£ä¸šçš„æˆ‘åˆåœ¨æŠ˜è…¾åˆ«çš„äº†ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹å‰å†™è¿‡ä¸€ç¯‡å…³äº NX54 å¦‚ä½•é…ç½® iptables ä»¥å¼€æ”¾æŒ‡å®š IP çš„ IPv6 é˜²ç«å¢™è§„åˆ™ã€‚æœ€è¿‘åˆæŠŠæ‰‹ä¸Šçš„ä¸€å— 14 å¹´çš„åºŸå¼ƒ ARM å¼€å‘æ¿ç¿»å‡ºæ¥ï¼ŒæŒ‚äº†å—ç¡¬ç›˜ï¼Œè®©æˆ‘åœ¨ä»»æ„è®¾å¤‡ä¸Šéƒ½èƒ½è®¿é—®å®¶é‡Œçš„ç½‘ç»œã€‚è¦è¯´è¿™å—æ¿å­ï¼Œå®˜æ–¹ç³»ç»Ÿåªåˆ°ubuntu 2014ï¼Œè¿python3éƒ½æ²¡æ³•è£…ï¼Œä¹‹å‰æŠ˜è…¾è¿‡armbianï¼Œä½†kernelæœ‰é—®é¢˜ï¼Œusbä¸å·¥ä½œã€‚æœ€è¿‘çœ‹è®ºå›å»å¹´æœ‰äººå‡çº§äº†å†…æ ¸äº†ï¼Œèµ¶ç´§æ¢ä¸€ä¸‹ç³»ç»Ÿã€‚&lt;/p&gt;
&lt;p&gt;è¿‡å¹´æœŸé—´å®¶å±é€äº†ä¸€å° Mac miniï¼ˆç°åœ¨ç™¾äº¿è¡¥è´´å…¥æ‰‹ä»· 2899ï¼Œè¡€äº 600ï¼‰ï¼Œäºæ˜¯æˆ‘åˆæŠ˜è…¾äº†ä¸€ä¸‹ï¼ŒæŠŠæ•´ä¸ªç½‘ç»œé‡æ–°æ•´ç†äº†ä¸€éã€‚ç†¬äº†å‡ ä¸ªå¤œæ™šå’Œåˆä¼‘æ—¶é—´ï¼Œæ€»ç®—å¼„å¥½äº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ&quot;&gt;&lt;/a&gt;ä¹‹å‰æˆ‘åšäº†ä»€ä¹ˆ&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;æ¡¥æ¥è·¯ç”±ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥è·å–å…¬ç½‘ipv6åœ°å€ï¼Œä¾›è‡ªå·±åœ¨å¤–è¾¹è¿æ¥ã€‚&lt;/li&gt;
&lt;li&gt;å…³é˜²ç«å¢™ã€‚å¤§å¤šæ•°è·¯ç”±å™¨éƒ½æœ‰ipv6é˜²ç«å¢™ï¼Œåƒæˆ‘çš„NX54å°±æ˜¯åŸºäºip6tablesçš„é…ç½®ï¼Œéœ€è¦å…³æ‰ã€‚æˆ‘æ˜¯åªå…³æ‰äº†æˆ‘çš„linuxçš„ipã€‚æˆ‘ä½¿ç”¨äº†è„šæœ¬è‡ªåŠ¨æ›´æ–°ï¼Œè„šæœ¬æµç¨‹å¦‚ä¸‹ï¼š &lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;linuxå®šæ—¶ä»»åŠ¡ -&amp;gt; pythonè„šæœ¬ -&amp;gt; è·å–ipv6 -&amp;gt; å‘ç°å˜åŒ– -&amp;gt; æ›´æ–°nx54é˜²ç«å¢™ -&amp;gt; æ›´æ–°cloudflare dns AAAA(æœ€æ—©åšäº†ä¸€ç‰ˆå‘emailçš„ï¼Œåæ¥æ”¹ddnsäº†)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
 ä¸å¾—ä¸è¯´ï¼ŒcloudflareçœŸçš„æ˜¯äº’è”ç½‘ä¹‹å…‰ï¼ŒåŸŸåä¾¿å®œï¼Œå…è´¹åŠ é€Ÿï¼Œè¿˜æä¾›Pagesï¼ŒWorkersã€‚&lt;/li&gt;
&lt;li&gt;linuxå…³é—­sshå¯†ç è®¿é—®ï¼ŒæŠŠå¸¸ç”¨çš„è®¾å¤‡å…¬é’¥åŠ è¿›å»ã€‚</summary>
    
    
    
    <category term="linux" scheme="https://lefo.me/categories/linux/"/>
    
    
    <category term="linux" scheme="https://lefo.me/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>GmSSLä¸­çš„totp</title>
    <link href="https://lefo.me/2024/12/31/sm3-totp/"/>
    <id>https://lefo.me/2024/12/31/sm3-totp/</id>
    <published>2024-12-31T09:40:31.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™åƒGithubä¸€æ ·å¼€å¯äº†2æ¬¡éªŒè¯ï¼Œç»™ä½ ç”Ÿæˆä¸€ä¸ª6ä½çš„æ•°å­—åŠ¨æ€å£ä»¤ï¼Œè¿™ç§å°±å«TOTPï¼Œé€šä¿—è®²ï¼Œå°±æ˜¯åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§åŠ¨æ€å£ä»¤ã€‚æˆ‘åœ¨å®¶é‡Œæ­äº†ä¸ªAlistæ–‡ä»¶æœåŠ¡å™¨ï¼Œä¹Ÿé»˜è®¤æ”¯æŒTOTPï¼Œä¸è¿‡æˆ‘å¼€äº†HTTPSï¼Œç”¨çš„ä¹Ÿä¸å¤šï¼ŒTOTPéªŒè¯å°±å…³äº†ã€‚æˆ‘ä¸ºä»€ä¹ˆè¦çœ‹è¿™ä¸ªå‘¢ï¼Œä¸Šç­çš„åœ°æ–¹wifiä½¿ç”¨äº†h3c eç›¾è®¤è¯ï¼Œé‡Œé¢ä½¿ç”¨äº†SM3è®¡ç®—å£ä»¤ï¼Œæ¯æ¬¡è¿wifiè¿˜å¾—ç‚¹å¼€appï¼Œç´¢æ€§çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆè®¡ç®—çš„ã€‚</p><span id="more"></span><h1 id="TOTPä»‹ç»"><a href="#TOTPä»‹ç»" class="headerlink" title="TOTPä»‹ç»"></a>TOTPä»‹ç»</h1><p>é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹GithubäºŒæ¬¡éªŒè¯ï¼Œå®ƒä¼šç»™æˆ‘ä»¬ä¸€ä¸ªäºŒç»´ç ï¼Œè®©æˆ‘ä»¬ç”¨Authenticatorç±»ä¼¼çš„è½¯ä»¶æ‰«ä¸€æ‰«ï¼Œç„¶åå°±èƒ½æ·»åŠ ã€‚å¦‚æœæˆ‘ä»¬ç”¨åˆ«çš„è½¯ä»¶æ‰«ï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå¦‚ä¸‹çš„åœ°å€ï¼š(æ¥æºäº’è”ç½‘çš„äºŒç»´ç )</p><blockquote><p>otpauth:&#x2F;&#x2F;totp&#x2F;GitHub:user?secret&#x3D;MMJCO5MSOUN57MGT&amp;issuer&#x3D;GitHub</p></blockquote><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯secretï¼Œ128bitçš„keyï¼Œå…¶å®ƒå‚æ•°éƒ½æ˜¯ç”¨æ¥åœ¨è½¯ä»¶ä¸Šæ˜¾ç¤ºçš„ï¼Œå…¶å®ä½ å¯ä»¥éšæ„ä¿®æ”¹ã€‚è½¯ä»¶ä¼šç”¨secret + æ—¶é—´å€¼è®¡ç®—ä¸€ä¸ªhashï¼Œå¹¶æˆªå–6ä½ä½œä¸ºå£ä»¤å€¼ã€‚æœåŠ¡ç«¯æ ¡éªŒæ—¶ï¼Œé€šå¸¸ä¼šè®¡ç®—å‰ä¸€ä¸ªæˆ–è€…åä¸€ä¸ªå€¼ï¼Œç”¨æ¥å®¹é”™å¯¹æ¯”ã€‚</p><ul><li>TOTPç”Ÿæˆï¼šTOTP(K,T) &#x3D; Truncate(HMAC-HASH(K,T))ï¼Œå…¶ä¸­HASH&#x3D;SHA-1&#x2F;SHA-256&#x2F;SHA-512</li></ul><p>å¯¹ä¸Šè¿°å‚æ•°åšç®€å•è¯´æ˜ï¼š</p><ol><li>Kå°±æ˜¯ä½ çš„å¯†é’¥ï¼Œä¹Ÿå°±æ˜¯secret</li><li>Tä¸ºæ—¶é—´å› å­ï¼Œä¸€èˆ¬æ—¶é—´æˆ³(ç§’) &#x2F; æ­¥é•¿ã€‚å¦‚30sä¸€åˆ·æ–°ï¼Œé‚£å°±æ˜¯å½“å‰æ—¶é—´æˆ³(ç§’) &#x2F; 30ã€‚</li></ol><h1 id="GmSSL"><a href="#GmSSL" class="headerlink" title="GmSSL"></a>GmSSL</h1><blockquote><p>otpauth:&#x2F;&#x2F;totp&#x2F;lefo:lefo?secret&#x3D;MMJCO5MSOUN57MGT&amp;algorithm&#x3D;sm3</p></blockquote><p>GmSSLä¸­ï¼ŒSM3 SM4ç®—æ³•å¯ä»¥ç”¨æ¥ç”Ÿæˆä¸€æ¬¡æ€§å£ä»¤ï¼Œæ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé“¾æ¥ç”Ÿæˆçš„äºŒç»´ç ï¼Œä¸å¸¸è§„totpçš„äºŒç»´ç æ— å¼‚ï¼Œåªæ˜¯åé¢ä¼šè·Ÿä¸€ä¸ªå‚æ•°ç”¨æ¥æ ‡è®°ä½¿ç”¨sm3&#x2F;sm4ç®—æ³•ã€‚ä½†ç®—æ³•å¹¶ä¸æ˜¯æ›¿æ¢å°±è¡Œï¼Œè¿˜å¤šäº†ä¸¤é¡¹å‚æ•°ã€‚</p><ul><li>GMOTPç”Ÿæˆï¼šGMOTP(K,T|C|Q)&#x3D;Truncate(F(K,T|C|Q))ï¼Œå…¶ä¸­F&#x3D;SM3&#x2F;SM4</li></ul><p>å…¶ä¸­ï¼ŒCä¸ºäº‹ä»¶å› å­ï¼Œ8å­—èŠ‚æ•´æ•°ã€‚Qä¸ºæŒ‘æˆ˜å› å­ï¼Œ4å­—èŠ‚æ•´æ•°ã€‚å‡å¯çœç•¥ã€‚å°†è¿™äº›å‚æ•°æ‹¼æ¥èµ·æ¥ï¼Œå†è°ƒç”¨SM3&#x2F;SM4ç®—æ³•ã€‚</p><h1 id="å›½æ ‡GmSSL-TOTP"><a href="#å›½æ ‡GmSSL-TOTP" class="headerlink" title="å›½æ ‡GmSSL TOTP"></a>å›½æ ‡GmSSL TOTP</h1><p>å…¨å›½æ ‡å‡†ä¿¡æ¯å…¬å…±æœåŠ¡å¹³å°æœ‰ä¸€é¡¹è§„èŒƒä¸ºã€Šä¿¡æ¯å®‰å…¨æŠ€æœ¯ åŠ¨æ€å£ä»¤å¯†ç åº”ç”¨æŠ€æœ¯è§„èŒƒã€‹ï¼Œå†…éƒ¨ä»‹ç»äº†SM3 SM4è®¡ç®—totpçš„æ–¹æ³•ï¼Œå…¶ä¸­Truncateè®¡ç®—å’Œå¸¸è§„totpè®¡ç®—ä¹Ÿä¸ä¸€æ ·ã€‚åœ¨å¸¸è§„totpä¸­ï¼Œæ˜¯å–æœ€å4å­—èŠ‚ï¼Œä½†æ˜¯åœ¨è¯¥è§„èŒƒä¸­ï¼Œ32ä¸ªå­—èŠ‚åˆ†ä¸º8ç»„ï¼Œå°†æ‰€æœ‰4å­—èŠ‚æ•´æ•°æ±‚å’Œã€‚</p><table><thead><tr><th><strong>å‚æ•°</strong></th><th><strong>è§„èŒƒä¸­çš„æ‰©å±•ï¼ˆæ¨æµ‹ï¼‰</strong></th></tr></thead><tbody><tr><td>å‚æ•°ä¸º K å’Œ T</td><td>å‚æ•°ä¸º Kã€Tã€Cã€Q</td></tr><tr><td>ä½¿ç”¨æ ‡å‡†å“ˆå¸Œç®—æ³•ï¼ˆSHA-1ã€SHA-256ï¼‰</td><td>ä½¿ç”¨å›½å¯†ç®—æ³•</td></tr><tr><td>Truncate æ­¥éª¤ä½¿ç”¨åç§»é‡æˆªå– 4 å­—èŠ‚</td><td>å¯èƒ½åˆ†ç»„ä¸º 8 éƒ¨åˆ†ï¼ˆS1-S8ï¼‰ï¼Œé€šè¿‡è®¡ç®—å†³å®šæˆªå–éƒ¨åˆ†</td></tr></tbody></table><ul><li><a href="https://openstd.samr.gov.cn/bzgk/gb/newGbInfo?hcno=FBCA58A4BF07DD668D7480D5A3C8DFE4">GB&#x2F;T 38556-2020 ä¿¡æ¯å®‰å…¨æŠ€æœ¯ åŠ¨æ€å£ä»¤å¯†ç åº”ç”¨æŠ€æœ¯è§„èŒƒ</a></li><li><a href="https://github.com/lephones/GmSSL-totp">GmSSL-totp</a></li></ul>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™åƒGithubä¸€æ ·å¼€å¯äº†2æ¬¡éªŒè¯ï¼Œç»™ä½ ç”Ÿæˆä¸€ä¸ª6ä½çš„æ•°å­—åŠ¨æ€å£ä»¤ï¼Œè¿™ç§å°±å«TOTPï¼Œé€šä¿—è®²ï¼Œå°±æ˜¯åŸºäºæ—¶é—´çš„ä¸€æ¬¡æ€§åŠ¨æ€å£ä»¤ã€‚æˆ‘åœ¨å®¶é‡Œæ­äº†ä¸ªAlistæ–‡ä»¶æœåŠ¡å™¨ï¼Œä¹Ÿé»˜è®¤æ”¯æŒTOTPï¼Œä¸è¿‡æˆ‘å¼€äº†HTTPSï¼Œç”¨çš„ä¹Ÿä¸å¤šï¼ŒTOTPéªŒè¯å°±å…³äº†ã€‚æˆ‘ä¸ºä»€ä¹ˆè¦çœ‹è¿™ä¸ªå‘¢ï¼Œä¸Šç­çš„åœ°æ–¹wifiä½¿ç”¨äº†h3c eç›¾è®¤è¯ï¼Œé‡Œé¢ä½¿ç”¨äº†SM3è®¡ç®—å£ä»¤ï¼Œæ¯æ¬¡è¿wifiè¿˜å¾—ç‚¹å¼€appï¼Œç´¢æ€§çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆè®¡ç®—çš„ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="gmssl" scheme="https://lefo.me/categories/gmssl/"/>
    
    
    <category term="gmssl" scheme="https://lefo.me/tags/gmssl/"/>
    
    <category term="sm3" scheme="https://lefo.me/tags/sm3/"/>
    
    <category term="totp" scheme="https://lefo.me/tags/totp/"/>
    
  </entry>
  
  <entry>
    <title>nx54çš„ipv6é…ç½®nasï¼Œå†…ç½‘ç©¿é€è®¿é—®ï¼Œnxginxã€DDNSéƒ½åœ¨è¿™é‡Œ</title>
    <link href="https://lefo.me/2024/11/18/nas-ipv6/"/>
    <id>https://lefo.me/2024/11/18/nas-ipv6/</id>
    <published>2024-11-18T04:52:33.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡è¯´åˆ°nx54è·¯ç”±å™¨å¦‚ä½•åœ¨å®˜æ–¹é˜²ç«å¢™ä¸ŠåŠ ä¸€ä¸ªè‡ªå·±ä¸»æœºå…è®¸è®¿é—®çš„è§„åˆ™ï¼Œåœ¨ä¸å…³é—­é˜²ç«å¢™çš„æƒ…å†µä¸‹ï¼Œè¿˜èƒ½èµ°ipv6è®¿é—®åˆ°å†…ç½‘è®¾å¤‡ï¼Œé‡Œé¢æœ‰æåˆ°ipv6åœ°å€å˜åŒ–çš„é—®é¢˜ã€‚è¿™ç¯‡ä¸»è¦è¯´è¯´ipv6å˜åŒ–åå¦‚ä½•é€šçŸ¥ä½ ï¼Œé€šçŸ¥è·¯ç”±å™¨ï¼Œä»¥åŠä¸€éƒ¨åˆ†nginxé…ç½®å¿ƒå¾—ã€‚</p><h1 id="ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™"><a href="#ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™" class="headerlink" title="ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™"></a>ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™</h1><blockquote><p>æ³¨æ„ä»¥ä¸‹æ‰€è¯´çš„ipéƒ½æ˜¯æŒ‡ipv6ï¼Œå› ä¸ºipv4å†…ç½‘åœ°å€å¯ä»¥ç›´æ¥å’Œmacåœ°å€ç»‘å®šï¼Œä¸ç”¨é€šçŸ¥ä½ ã€‚</p></blockquote><span id="more"></span><p>æˆ‘å‘ç°æ–°å›ºä»¶åœ¨é‡å¯è®¾å¤‡åï¼Œipä¹Ÿä¸ä¼šå˜äº†ï¼Œè¿™ç®—æ˜¯ä¸€ä¸ªå¥½äº‹å§ï¼Œä¹Ÿä¸ç”¨ç»å¸¸æ›´æ–°ipåœ°å€ã€‚ä¸è¿‡ï¼Œä»¥é˜²æ­£éœ€ç”¨çš„æ—¶å€™ipåœ°å€å˜åŒ–ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯pythonè„šæœ¬ï¼Œå½“æ£€æµ‹åˆ°ipå˜åŒ–ï¼Œå°±å‘æˆ‘çš„é‚®ç®±å‘é€ä¸€å°emailã€‚(ä½ ä¹Ÿå¯ä»¥ç›´æ¥åšDDNSï¼Œè‡ªå·±å†™apiè°ƒç”¨è„šæœ¬æˆ–è€…ddns-go)ã€‚æœ‰å‡ ç‚¹è¦æ±‚ï¼š</p><ol><li>ä½ çš„é‚®ç®±å¼€é€šsmtpï¼Œsmtpæ˜¯ä¸€ä¸ªç”¨äºå‘é‚®ä»¶çš„ï¼Œä¸€èˆ¬åœ¨é‚®ç®±çš„è®¾ç½®é¡µã€‚</li><li>ä½ çš„è·¯ç”±å·²ç»å¸¸å¼€telnetï¼Œå‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘å› ä¸ºæ‰¾åˆ°äº†å¸¸å¼€æ–¹å¼ï¼Œç›´æ¥å¸¸å¼€äº†ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket  </span><br><span class="line"><span class="keyword">import</span> smtplib  </span><br><span class="line"><span class="keyword">import</span> subprocess </span><br><span class="line"><span class="keyword">import</span> os  </span><br><span class="line"><span class="keyword">import</span> telnetlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText  </span><br><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart  </span><br><span class="line"></span><br><span class="line"><span class="comment"># Telnet è¿æ¥ä¿¡æ¯</span></span><br><span class="line">HOST = <span class="string">&quot;192.168.124.1&quot;</span> <span class="comment"># è·¯ç”±çš„ip</span></span><br><span class="line">PORT = <span class="number">15000</span></span><br><span class="line">PASSWORD = <span class="string">&quot;password&quot;</span>  <span class="comment"># æ›¿æ¢ä¸ºå®é™…å¯†ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å‘ä»¶äººå’Œæ”¶ä»¶äººä¿¡æ¯  </span></span><br><span class="line">sender_email = <span class="string">&#x27;å‘ä»¶é‚®ç®±&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;smtp password&#x27;</span>  <span class="comment"># ä¸€èˆ¬éƒ½æœ‰SMTPåº”ç”¨ä¸“ç”¨å¯†ç  </span></span><br><span class="line"><span class="comment"># è®¾ç½®SMTPæœåŠ¡å™¨åœ°å€å’Œç«¯å£  æˆ‘ä½¿ç”¨çš„æ˜¯126ï¼Œqqå’Œç½‘æ˜“éƒ½æ”¯æŒSSLï¼Œèƒ½é¿å…å¯†ç æ˜æ–‡ä¼ è¾“</span></span><br><span class="line">smtp_server = <span class="string">&#x27;smtp.126.com&#x27;</span>  </span><br><span class="line">smtp_port = <span class="number">465</span>  <span class="comment"># é€šå¸¸æ˜¯587ç”¨äºTLSæˆ–465ç”¨äºSSL  SMTPé»˜è®¤æ˜¯25ï¼Œä½†æ˜¯25ä¸åŠ å¯†ï¼Œæˆ‘ä»¬ä½¿ç”¨SSLï¼Œç½‘æ˜“æ”¯æŒSSL</span></span><br><span class="line">receiver_email = <span class="string">&#x27;æ¥æ”¶ipçš„é‚®ç®±&#x27;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºä¸€ä¸ªsocketå¯¹è±¡  ä¸»è¦æ˜¯ä¸ºäº†è·å–ä¸»æœºåï¼Œå…¶å®æ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line">sock = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)  </span><br><span class="line"></span><br><span class="line">save_ip = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_ip_string_to_file</span>(<span class="params">ip_string, filename=<span class="string">&quot;ip_string.txt&quot;</span></span>):  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> file:  </span><br><span class="line">        file.write(ip_string)  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_ip_string_in_file</span>(<span class="params">ip_string, filename=<span class="string">&quot;ip_string.txt&quot;</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filename):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">else</span> :  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:  </span><br><span class="line">            file_content = file.read()  </span><br><span class="line">            <span class="keyword">return</span> file_content == ip_string </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_host_name</span>():</span><br><span class="line">    <span class="comment"># è·å–ä¸»æœºå  </span></span><br><span class="line">    host_name = socket.gethostname()  </span><br><span class="line">    <span class="keyword">return</span> host_name</span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_ipv6_addresses</span>():  </span><br><span class="line">    <span class="comment"># æ‰§è¡Œip -6 addrå‘½ä»¤è·å–IPv6åœ°å€ä¿¡æ¯  </span></span><br><span class="line">    result = subprocess.run([<span class="string">&#x27;ip&#x27;</span>, <span class="string">&#x27;-6&#x27;</span>, <span class="string">&#x27;addr&#x27;</span>], capture_output=<span class="literal">True</span>, text=<span class="literal">True</span>)  </span><br><span class="line">    <span class="comment">#result = subprocess.run([&#x27;ip&#x27;, &#x27;-6&#x27;, &#x27;addr&#x27;], stdout=subprocess.PIPE, stdin=subprocess.PIPE, universal_newlines=True)   #python 3.6</span></span><br><span class="line">    <span class="keyword">if</span> result.returncode != <span class="number">0</span>:  </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error executing ip command&quot;</span>)  </span><br><span class="line">        <span class="keyword">return</span> []  </span><br><span class="line">      </span><br><span class="line">    <span class="comment"># è§£æè¾“å‡ºä»¥è·å–IPv6åœ°å€  </span></span><br><span class="line">    lines = result.stdout.split(<span class="string">&#x27;\n&#x27;</span>)  </span><br><span class="line">    ipv6_addresses = []  </span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;inet6&#x27;</span> <span class="keyword">in</span> line <span class="keyword">and</span> <span class="string">&#x27;dynamic mngtmpaddr noprefixroute&#x27;</span> <span class="keyword">in</span> line <span class="keyword">and</span> <span class="string">&#x27; deprecated &#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> line:  </span><br><span class="line">            <span class="comment"># æŸ¥æ‰¾inet6è¡Œä¸­çš„IPv6åœ°å€  </span></span><br><span class="line">            address = line.split(<span class="string">&#x27;inet6 &#x27;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>].strip()  </span><br><span class="line">            <span class="keyword">if</span> address != <span class="string">&#x27;::1&#x27;</span>:  <span class="comment"># å¿½ç•¥æœ¬åœ°å›ç¯åœ°å€  </span></span><br><span class="line">                ipv6_addresses.append(address)  </span><br><span class="line">               <span class="comment"># if ipv6_addresses.count() &gt; 5 :</span></span><br><span class="line">               <span class="comment">#     break;</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> ipv6_addresses </span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_email</span>(<span class="params">title, content</span>) :</span><br><span class="line">    <span class="comment"># åˆ›å»ºé‚®ä»¶å¯¹è±¡  </span></span><br><span class="line">    msg = MIMEMultipart()  </span><br><span class="line">    msg[<span class="string">&#x27;From&#x27;</span>] = sender_email  </span><br><span class="line">    msg[<span class="string">&#x27;To&#x27;</span>] = receiver_email  </span><br><span class="line">    msg[<span class="string">&#x27;Subject&#x27;</span>] = title</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ·»åŠ é‚®ä»¶æ­£æ–‡  </span></span><br><span class="line">    body = content</span><br><span class="line">    msg.attach(MIMEText(body, <span class="string">&#x27;plain&#x27;</span>))  </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># åˆ›å»ºSMTPå¯¹è±¡å¹¶å‘é€é‚®ä»¶  </span></span><br><span class="line">    <span class="keyword">with</span> smtplib.SMTP_SSL(smtp_server, smtp_port) <span class="keyword">as</span> server:  </span><br><span class="line">        <span class="comment">#server.starttls()  # å¯åŠ¨TLSåŠ å¯†  </span></span><br><span class="line">        server.login(sender_email, password)  <span class="comment"># ç™»å½•é‚®ç®±  </span></span><br><span class="line">        text = msg.as_string()  <span class="comment"># å°†é‚®ä»¶å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²  </span></span><br><span class="line">        server.sendmail(sender_email, receiver_email, text)  <span class="comment"># å‘é€é‚®ä»¶  </span></span><br><span class="line">        server.quit()  <span class="comment"># å…³é—­è¿æ¥  </span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#    print(&quot;é‚®ä»¶å‘é€æˆåŠŸï¼&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change_ip6tables</span>(<span class="params">ip6_addr</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># è¿æ¥åˆ°ç›®æ ‡ä¸»æœº</span></span><br><span class="line">        tn = telnetlib.Telnet(HOST, <span class="number">15000</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Connected to <span class="subst">&#123;HOST&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç­‰å¾…å¹¶è¾“å…¥å¯†ç </span></span><br><span class="line">        <span class="comment">#tn.read_until(b&quot;Password: &quot;)</span></span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        tn.write(PASSWORD.encode(<span class="string">&#x27;ascii&#x27;</span>) + <span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Password entered&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰§è¡Œ debugshell å‘½ä»¤</span></span><br><span class="line">        tn.write(<span class="string">b&quot;debugshell\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Entered debugshell&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰§è¡Œ ip6tables -F forwarding_rule å‘½ä»¤</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        tn.write(<span class="string">b&quot;ip6tables -F forwarding_rule\n&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flushed forwarding_rule&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰§è¡Œ ip6tables -A forwarding_rule -d device_ipv6 -j ACCEPT å‘½ä»¤</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        add_rule_command = <span class="string">f&quot;ip6tables -A forwarding_rule -d <span class="subst">&#123;ip6_addr&#125;</span> -j ACCEPT\n&quot;</span></span><br><span class="line">        tn.write(add_rule_command.encode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Added ACCEPT rule for <span class="subst">&#123;ip6_addr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¯»å–å‘½ä»¤è¾“å‡º</span></span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        output = tn.read_very_eager().decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">        <span class="comment">#print(&quot;Command output:\n&quot;, output)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># å…³é—­è¿æ¥</span></span><br><span class="line">        tn.write(<span class="string">b&quot;exit\n&quot;</span>)</span><br><span class="line">        tn.close()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Connection closed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    host_name = get_host_name()</span><br><span class="line">    <span class="comment"># è·å–å¹¶æ‰“å°IPv6åœ°å€  </span></span><br><span class="line">    ipv6_addrs = get_ipv6_addresses()  </span><br><span class="line">    result = <span class="string">&#x27;\n&#x27;</span>.join(ipv6_addrs)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;IPv6åœ°å€: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check_ip_string_in_file(result) :</span><br><span class="line">        save_ip_string_to_file(result)</span><br><span class="line">        send_email(host_name + <span class="string">&#x27; ip &#x27;</span>,result)</span><br><span class="line">        change_ip6tables(result)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>ç®€å•è¯´ä¸€ä¸‹ä¸Šé¢çš„é€»è¾‘ï¼Œè·å–ipåœ°å€ï¼Œå½“å‰ç›®å½•ä¼šä¿å­˜ä¸€ä¸ªip_string.txtï¼Œç”¨æ¥ä¿å­˜ä¸Šä¸€æ¬¡è·å–çš„ipï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œå°±å‘é€emailï¼Œæ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™ï¼ŒåŒæ—¶ä¿å­˜æ–°ipã€‚è·å–ipå…¶å®æ˜¯æ‰§è¡Œäº†ä¸€æ¡ ip -6 addr çš„æŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤èƒ½è·å–å¤šæ¡ipï¼Œå¤§éƒ¨åˆ†æ˜¯tempçš„ï¼Œæˆ‘è¿‡æ»¤ipçš„æ¡ä»¶æœ‰ç‚¹å†—ä½™ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±è¦æ±‚é…ç½®ã€‚</li></ol><p>å¦å¤–ï¼Œæˆ‘çš„è„šæœ¬æœ‰ä¸€ç‚¹ç‚¹å¼Šç«¯ï¼Œå°±æ˜¯telnetè”è¿‡è·¯ç”±åï¼Œåé¢æ˜¯ä¸ç”¨å†è¾“å…¥å¯†ç çš„ï¼Œä½†è¿™é‡Œå¤šè¾“äº†ä¸€æ¬¡ï¼Œæ— ä¼¤å¤§é›…ï¼Œæ¯•ç«Ÿä½ çš„å¯†ç ä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤ã€‚</p><p>ä½¿ç”¨crontab -eï¼Œå°†ä½ çš„è„šæœ¬æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‰§è¡Œï¼Œå…³äºå®šæ—¶ä»»åŠ¡çš„é…ç½®ï¼Œå°±ä¸è®²äº†ã€‚</p><h1 id="nginx-alist"><a href="#nginx-alist" class="headerlink" title="nginx &amp; alist"></a>nginx &amp; alist</h1><blockquote><p>å…³äºSSHè®¿é—®åŠæ§åˆ¶ï¼Œå‚è€ƒä¹‹å‰çš„æ–‡ç« ã€‚</p></blockquote><p>å› ä¸ºæˆ‘ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å­˜å‚¨æ–‡ä»¶ï¼Œè·‘äº†ä¸ªalistï¼Œå…¶å®alistä¹Ÿæ˜¯å¤Ÿç”¨çš„ï¼Œä¸ç”¨å†è£…nginxï¼Œä½†æœ‰nginxï¼Œé…ç½®å¯ä»¥æ›´çµæ´»ã€‚alistæ”¯æŒotpåŠ¨æ€å¯†ç ï¼Œé…åˆå‰é¢çš„emailæ¥æ”¶é‚®ä»¶ï¼Œè¶³å¤Ÿä½¿ç”¨äº†ã€‚ä¸è¿‡httpæ¯•ç«Ÿæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œæˆ‘ä¸ºäº†å®‰å…¨èµ·è§ï¼Œè¿˜æ˜¯è£…äº†sslè¯ä¹¦ã€‚æˆ‘çœ‹alistçš„é…ç½®æœ‰sslè¯ä¹¦ï¼Œä½†æœ€åè¿˜æ˜¯é‡‡ç”¨äº†nginxçš„åå‘ä»£ç†ï¼Œæ ¹æ®serveræ§åˆ¶æ›´æ–¹ä¾¿,å†…ç½‘å¤–ç½‘æ§åˆ¶æ›´çµæ´»ã€‚</p><p>å¦‚æœä½ æ²¡æœ‰åŸŸåï¼Œæ­å»ºå¥½åä½¿ç”¨ipè®¿é—®ï¼Œä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯letâ€˜s encryptçš„httpså°±ä¸èƒ½æ”¯æŒäº†ï¼Œä¸ºäº†æ–¹ä¾¿è¿˜æ˜¯å»ºè®®å¤§å®¶æ³¨å†Œä¸€ä¸ªåŸŸåã€‚</p><p>è‡ªå·±å»ºæœåŠ¡å™¨ä¸»è¦æ¶‰åŠä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>ä½ çš„æœåŠ¡ä¸è¦æ­å»ºåœ¨å¸¸è§„ç«¯å£ä¸Šã€‚(80 443 445ç«¯å£å°é”ï¼Œè¿™ä¸‰ä¸ªé€šå¸¸ç”¨äºhttp https smbåè®®ã€‚)</li><li>åŸŸååœ¨å›½å¤–æœåŠ¡å•†æ³¨å†Œï¼Œä¸”ä¸è¦ä½¿ç”¨å›½å†…dnsåŠ é€ŸæœåŠ¡ (å¯èƒ½ä¼šæœ‰ä¸ŠæŠ¥ï¼Œå½“ç„¶æµé‡è¿½è¸ªä¹Ÿå¯èƒ½è¢«æŸ¥ã€‚)</li><li>æ·»åŠ ssl (httpæ˜¯æ˜æ–‡ä¼ è¾“ï¼Œå°½é‡ä½¿ç”¨https)</li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œå¤§æ¦‚é…ç½®è¦åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š</p><ol><li>alistçš„addressé…ç½®ä¸º127.0.0.1ï¼Œè¿™æ ·å…¬ç½‘ipè®¿é—®ä¸åˆ°ä½ çš„ä¸»alistæœåŠ¡ã€‚æœ¬æ¥æƒ³å†åŠ å†…ç½‘ipï¼Œæˆ‘å°è¯•äº†ä¸€ä¸‹ï¼Œalistä¸èƒ½æŒ‡å®šå¤šä¸ªaddressï¼Œæ‰€ä»¥ç”¨åå‘ä»£ç†ã€‚</li><li>nginxé…ç½®ä¸€ä¸ªssl serverï¼Œserver_nameå¯ä»¥ç»‘å®šä½ çš„åŸŸåï¼Œä¹Ÿå¯ä»¥å†™_ã€‚</li><li>nginxé…ç½®ä¸€ä¸ªhttp serverï¼Œç«¯å£å¯ä»¥æ˜¯80ï¼Œserver_nameä½¿ç”¨ä½ 192.168.124.xçš„ipv4åœ°å€ï¼Œä¾›ä½ å†…ç½‘è®¿é—®ã€‚</li><li>ä»¥ä¸Šä¸¤ä¸ªnginxï¼Œå…¨ä½¿ç”¨åå‘ä»£ç†è¿æ¥åˆ°alistï¼Œåå‘ä»£ç†åœ¨alistçš„æ–‡æ¡£é‡Œæœ‰ã€‚</li></ol><p>åšå®Œä»¥ä¸Šæ“ä½œï¼Œèƒ½è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼šå¤–ç½‘é€šè¿‡httpsèµ°åŠ å¯†é€šé“è®¿é—®(æ³¨æ„ç«¯å£)ï¼Œå†…ç½‘å¯ä»¥ç›´æ¥é€šè¿‡192.168.124.xèµ°httpç›´æ¥è®¿é—®ã€‚</p><h1 id="ssl-ddns"><a href="#ssl-ddns" class="headerlink" title="ssl &amp; ddns"></a>ssl &amp; ddns</h1><p>æ²¡å…³ç³»çš„ä¸¤ä¸ªå†…å®¹ä¸ºä»€ä¹ˆæ”¾ä¸€èµ·å†™ï¼Œå› ä¸ºsslç­¾å‘è¯ä¹¦ï¼Œåªèƒ½é€šè¿‡dnsè®¤è¯ï¼Œå…¶å®ƒçš„æ–¹å¼è¦æ±‚80ç«¯å£å¼€æ”¾ã€‚</p><h2 id="ssl"><a href="#ssl" class="headerlink" title="ssl"></a>ssl</h2><ol><li>ä½¿ç”¨certbotï¼Œæˆ–è€…acme.shç”³è¯·è¯ä¹¦ï¼Œæœ‰æ•ˆæœŸ90å¤©ã€‚</li><li>å› ä¸º80è¢«å°ï¼Œåªèƒ½æ‰‹åŠ¨æ”¹dnsè®¤è¯ã€‚å®ƒä¼šè¦æ±‚ä½ åŠ ä¸€æ¡txtè§£æï¼Œç»­æœŸå€¼ä¼šä¸ä¸€æ ·ã€‚</li><li>å¦‚æœä½ çš„åŸŸåæœåŠ¡å•†æ˜¯cloudflareï¼Œæœ‰æ’ä»¶æ”¯æŒï¼Œæ²¡æ’ä»¶çš„æœåŠ¡å•†éœ€è¦è‡ªå·±ç”³è¯·ä¸€ä¸‹keyï¼Œå‘è¯·æ±‚ã€‚é¡ºå¸¦è¯´ä¸€ä¸‹ï¼Œgodaddyçš„dns apiå¤§é™†è®¿é—®ä¸äº†ã€‚</li><li>å¦‚æœä½ èƒ½åšäº†dnsè‡ªåŠ¨è®¤è¯ï¼Œé‚£å°±åŠ åˆ°crontab -eä¸Šï¼Œå®šæ—¶è‡ªåŠ¨ç»­æœŸï¼Œè¿™é‡Œä¸è¦å¤ªé¢‘ç¹ï¼Œå› ä¸ºæœ‰æ•ˆæœŸæœ‰90å¤©ï¼Œå¯ä»¥ä¸¤ä¸ªæœˆç»­ä¸€æ¬¡ã€‚</li></ol><p>å¦‚æœä½ è„šæœ¬æä¸å®šï¼Œ90å¤©æ‰‹åŠ¨æ›´æ–°ä¸€æ¬¡ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><h2 id="ddns"><a href="#ddns" class="headerlink" title="ddns"></a>ddns</h2><p>å¦‚æœä½ ä¸Šé¢dnsçš„ä¸€æ­¥æå®šäº†ï¼Œæ¨èä½ ä½¿ç”¨ä½ çš„è„šæœ¬ï¼Œç»“åˆä¹‹å‰è·å–ipï¼Œè‡ªå·±åšddnsã€‚å°ç™½å°±ä½¿ç”¨ddns-goå§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¸Šä¸€ç¯‡è¯´åˆ°nx54è·¯ç”±å™¨å¦‚ä½•åœ¨å®˜æ–¹é˜²ç«å¢™ä¸ŠåŠ ä¸€ä¸ªè‡ªå·±ä¸»æœºå…è®¸è®¿é—®çš„è§„åˆ™ï¼Œåœ¨ä¸å…³é—­é˜²ç«å¢™çš„æƒ…å†µä¸‹ï¼Œè¿˜èƒ½èµ°ipv6è®¿é—®åˆ°å†…ç½‘è®¾å¤‡ï¼Œé‡Œé¢æœ‰æåˆ°ipv6åœ°å€å˜åŒ–çš„é—®é¢˜ã€‚è¿™ç¯‡ä¸»è¦è¯´è¯´ipv6å˜åŒ–åå¦‚ä½•é€šçŸ¥ä½ ï¼Œé€šçŸ¥è·¯ç”±å™¨ï¼Œä»¥åŠä¸€éƒ¨åˆ†nginxé…ç½®å¿ƒå¾—ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™&quot;&gt;&lt;a href=&quot;#ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™&quot; class=&quot;headerlink&quot; title=&quot;ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™&quot;&gt;&lt;/a&gt;ipå˜åŒ–é€šçŸ¥ï¼ŒåŒæ—¶æ›´æ–°è·¯ç”±é˜²ç«å¢™è§„åˆ™&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;æ³¨æ„ä»¥ä¸‹æ‰€è¯´çš„ipéƒ½æ˜¯æŒ‡ipv6ï¼Œå› ä¸ºipv4å†…ç½‘åœ°å€å¯ä»¥ç›´æ¥å’Œmacåœ°å€ç»‘å®šï¼Œä¸ç”¨é€šçŸ¥ä½ ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="nx54" scheme="https://lefo.me/categories/nx54/"/>
    
    
    <category term="nas" scheme="https://lefo.me/tags/nas/"/>
    
    <category term="ipv6" scheme="https://lefo.me/tags/ipv6/"/>
    
  </entry>
  
  <entry>
    <title>H3C NX54ä¸å…³ipv6é˜²ç«å¢™ï¼Œå…è®¸å¤–ç½‘è®¿é—®å†…ç½‘</title>
    <link href="https://lefo.me/2024/11/10/nx54-ip6tables/"/>
    <id>https://lefo.me/2024/11/10/nx54-ip6tables/</id>
    <published>2024-11-10T06:51:47.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>NX54ç»ˆäºæ›´æ–°å›ºä»¶äº†ï¼Œæ–°ç‰ˆæœ¬æ”¯æŒé…ç½®å…³é—­ipv6é˜²ç«å¢™ï¼Œä½†æ˜¯ï¼Œé˜²ç«å¢™å…³é—­ï¼Œç›¸å¯¹è€Œè¨€é£é™©ä¹Ÿå°±ä¸Šæ¥äº†ã€‚å…¶å®æœ€å¥½çš„åŠæ³•æ˜¯ï¼Œåœ¨é˜²ç«å¢™ä¸Šç¨å¾®å¼€ä¸€ä¸ªå°å£å°±è¡Œäº†ï¼Œä¹Ÿå°±æ˜¯ï¼Œåªå…è®¸ç›®æ ‡åœ°å€æ˜¯ä½ æŒ‡å®šIPçš„æ•°æ®é€šè¿‡ï¼Œä»Šå¤©å°±å¤§æ¦‚è¯´è¯´å¦‚ä½•æœ€å°é£é™©å»å¤„ç†è¿™ä»¶äº‹æƒ…ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ“ä½œï¼š</p><ol><li>ip6tablesé™åˆ¶æŒ‡å®šç›®æ ‡ipè½¬å‘</li><li>å…³é—­è¦è®¿é—®çš„æœåŠ¡å™¨çš„sshè®¿é—®ï¼Œwindowsä¸»æœºå¯å¿½ç•¥</li></ol><span id="more"></span><h1 id="é™åˆ¶åªæœ‰è®¿é—®ä½ ä¸»æœºæ‰èƒ½é€šè¿‡ipv6é˜²ç«å¢™"><a href="#é™åˆ¶åªæœ‰è®¿é—®ä½ ä¸»æœºæ‰èƒ½é€šè¿‡ipv6é˜²ç«å¢™" class="headerlink" title="é™åˆ¶åªæœ‰è®¿é—®ä½ ä¸»æœºæ‰èƒ½é€šè¿‡ipv6é˜²ç«å¢™"></a>é™åˆ¶åªæœ‰è®¿é—®ä½ ä¸»æœºæ‰èƒ½é€šè¿‡ipv6é˜²ç«å¢™</h1><p>nx54å°±æ˜¯ä¸€ä¸ªopenwrtçš„é­”æ”¹ç‰ˆæœ¬ï¼Œæ‰€ä»¥é˜²ç«å¢™æ˜¯åŸºäºip6tablesçš„ï¼Œç®€å•è¯´ä¸€ä¸‹iptablesï¼Œç»´æŠ¤ç€ä¸€ä¸ªè§„åˆ™é“¾ï¼Œæ‰€ä»¥è¦è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸï¼Œéœ€è¦æŠŠå…è®¸çš„è§„åˆ™é…ç½®åˆ°å‰é¢ã€‚</p><h2 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h2><p>è®¿é—®<a href="http://[ip]/debug.asp">http:&#x2F;&#x2F;[ip]&#x2F;debug.asp</a>ï¼Œå‘ä¸‹æ‹‰ï¼Œæ‰¾åˆ°telnetç®¡ç†ï¼Œå‹¾é€‰å¯åŠ¨telnetï¼Œç‚¹æ—è¾¹åº”ç”¨ï¼Œåœ¨å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">telnet &lt;è·¯ç”±ip&gt; 15000</span><br><span class="line"><span class="comment"># è¾“å…¥å¯†ç </span></span><br><span class="line">&lt;your password&gt;</span><br><span class="line"><span class="comment"># &lt;H3C_NX54&gt;åè¾“å…¥ debugshell</span></span><br><span class="line">debugshell</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ip6tablesçš„FORWARDé…ç½®ï¼Œæ˜¾ç¤ºåªæœ‰ä¸€é¡¹ä¸ºdelegate_forwardï¼Œå†çœ‹delegate_forwardé…ç½®ï¼ŒåŒ…å«5é¡¹ï¼Œé€šè¿‡ç»§ç»­æŸ¥çœ‹ç¬¬ä¸€é¡¹forwarding_ruleï¼Œå‘ç°è¿™æ¡é…ç½®å…¶å®æ˜¯ç©ºçš„ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ip6tables -L FORWARD -v -n --line-numbers</span><br><span class="line"><span class="comment"># delegate_forward</span></span><br><span class="line"></span><br><span class="line">ip6tables -L delegate_forward -v -n --line-numbers</span><br><span class="line"><span class="comment"># forwarding_rule</span></span><br><span class="line"><span class="comment"># ACCEPT</span></span><br><span class="line"><span class="comment"># zone_lan_forward</span></span><br><span class="line"><span class="comment"># zone_wan_forward</span></span><br><span class="line"><span class="comment"># reject</span></span><br><span class="line"></span><br><span class="line">ip6tables -L forwarding_rule -v -n --line-numbers</span><br><span class="line"><span class="comment"># null</span></span><br></pre></td></tr></table></figure><p>ç®€å•è¯´ä¸€ä¸‹ä¸Šé¢çš„æ„æ€ï¼Œæ‰€æœ‰çš„è½¬å‘æµé‡ï¼Œèµ°delegate_forwardï¼Œè€Œdelegate_forwardåˆ†ä¸ºäº†5æ­¥ï¼Œå¦‚æœå‰å››æ­¥æ²¡æœ‰å‘½ä¸­ï¼Œé‚£ä¹ˆä¼šè¿›å…¥ç¬¬5æ­¥çš„æ‹’ç»ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯all rejectã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨rejectå‰ï¼Œå°†è‡ªå·±çš„ipv6æ·»åŠ åˆ°ACCEPTçš„è§„åˆ™ã€‚çœ‹äº†ä¸€çœ¼forwarding_ruleï¼Œæ˜¯ä¸ªç©ºçš„ã€‚æ‰€ä»¥æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šdelegate_forwardä¸‹ç¬¬1ä¸ªä½ç½®æ’å…¥è‡ªå®šä¹‰Chainï¼Œæˆ–è€…ç›´æ¥åŠ åˆ°forwarding_ruleã€‚ä»¥ç›´æ¥åŠ åˆ°forwarding_ruleä¸­ä¸ºå‡†ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å…è®¸ç›®æ ‡ä¸º[ip]çš„è§„åˆ™åˆ° forwarding_rule</span></span><br><span class="line">ip6tables -A forwarding_rule -d device_ipv6 -j ACCEPT</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨forwarding_ruleï¼Œè€Œä¸ç›´æ¥åŠ åœ¨æœ€å¤–å±‚å‘¢ï¼Ÿå› ä¸ºipä¼šå˜ï¼Œæˆ‘ä»¬è¯´äº†æ˜¯æœ€å°é£é™©ï¼Œæ‰€ä»¥å½“ipå˜æ›´åï¼Œè¦åˆ é™¤æ—§çš„è§„åˆ™ï¼Œè¿™é‡Œå¦‚æœæœ‰è‡ªå®šä¹‰Chainåç§°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿æ“ä½œã€‚å› ä¸ºforwarding_ruleåªåŒ…å«ä½ é‚£ä¸€æ¡ï¼Œæ‰€ä»¥ç›´æ¥åˆ é™¤forwarding_ruleé‡Œæ‰€æœ‰çš„é…ç½®é¡¹å°±å¯ä»¥äº†ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip6tables -F forwarding_rule</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ çš„forwarding_ruleä¸ä¸ºç©º(åº”è¯¥ä¸ä¼š)ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ è§„åˆ™çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°Chainï¼ŒåŠ åœ¨delegate_forwardä¸‹ï¼Œforwarding_ruleæ—è¾¹å°±è¡Œäº†ï¼Œæ€»ä¹‹å°±æ˜¯ä¸€å¥è¯ï¼Œè®©ä½ çš„è§„åˆ™åœ¨rejectå‰å‘½ä¸­ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># æœ€å¼€å§‹æ’å…¥ä¸€æ¡forwarding_rule_ip6</span></span><br><span class="line">ip6tables -I delegate_forward -j forwarding_rule_ip6</span><br><span class="line"><span class="comment"># æˆ–è€…ä½¿ç”¨ ip6tables -A forwarding_rule -j forwarding_rule_ip6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è‡ªå·±çš„ipæ·»åŠ åˆ°è‡ªå®šä¹‰è§„åˆ™ä¸­</span></span><br><span class="line">ip6tables -A forwarding_rule_ip6 -d device_ipv6 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¸…ç©ºè‡ªå®šä¹‰è§„åˆ™</span></span><br><span class="line">ip6tables -F forwarding_rule_ip6</span><br></pre></td></tr></table></figure><h1 id="ä¸»æœºç›´æ¥å…³é—­sshå¯†ç è®¿é—®"><a href="#ä¸»æœºç›´æ¥å…³é—­sshå¯†ç è®¿é—®" class="headerlink" title="ä¸»æœºç›´æ¥å…³é—­sshå¯†ç è®¿é—®"></a>ä¸»æœºç›´æ¥å…³é—­sshå¯†ç è®¿é—®</h1><p>æˆ‘æœ¬æ¥å°±æ˜¯æƒ³åšä¸ªæ–‡ä»¶æœåŠ¡å™¨ï¼Œlinuxç³»ç»Ÿï¼Œæ—¢ç„¶è·¯ç”±ä¸Šiptablesé™åˆ¶äº†å—è®¿IPï¼Œå†åœ¨å¼€å‘æ¿ä¸ŠåŠ ä¸€é“å®‰å…¨æœºåˆ¶ï¼Œé™åˆ¶å¤–ç½‘ä½¿ç”¨ipv6é€šè¿‡å¯†ç æ¥çš„æ–¹å¼è¿›è¡Œsshè®¿é—®ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå¿…é¡»æœ‰è®¿é—®éœ€æ±‚çš„æœºå™¨çš„keyæ‰‹åŠ¨æ·»åŠ åˆ°æœåŠ¡å™¨ä¸Šæ‰è¡Œã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># /etc/ssh/sshd_config</span><br><span class="line"># é’ˆå¯¹æ‰€æœ‰ IPv6 åœ°å€çš„é…ç½® æ·»åŠ åˆ°æ–‡ä»¶æœ«å°¾</span><br><span class="line">Match Address ::/0</span><br><span class="line">    PasswordAuthentication no</span><br><span class="line"></span><br><span class="line"># sudo systemctl restart sshd</span><br></pre></td></tr></table></figure><p>è‡³äºå¦‚ä½•ç”Ÿæˆkeyæ·»åŠ åˆ°æœåŠ¡å™¨ï¼Œè¿™é‡Œå°±ä¸è¯´äº†ã€‚</p><h1 id="ipå˜æ›´å"><a href="#ipå˜æ›´å" class="headerlink" title="ipå˜æ›´å"></a>ipå˜æ›´å</h1><p>åšå®Œä»¥ä¸Šé…ç½®ï¼Œå…¶å®ä½ çš„ipv6é˜²ç«å¢™å…¶å®ä¾ç„¶æ˜¯å¼€å¯çŠ¶æ€ï¼Œåªä¸è¿‡åŠ äº†ä¸€æ¡ç›®æ ‡ipçš„æ•°æ®å…è®¸é€šè¿‡çš„è§„åˆ™ã€‚é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œå·²ç»å¯ä»¥è¾¾åˆ°ç†æƒ³çš„å®‰å…¨æ•ˆæœï¼šåªå…è®¸æ–‡ä»¶æœåŠ¡å™¨è¢«å¤–ç½‘è®¿é—®ï¼Œå¤–ç½‘ä¸èƒ½é€šè¿‡sshå¯†ç ç™»å½•ã€‚ä½†æ˜¯nx54æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œåªè¦é‡æ–°è¿æ¥ipv6åœ°å€å°±ä¼šå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦å°†ip6tableså‘½ä»¤åŠ å…¥å®šæ—¶ä»»åŠ¡ä¸­ã€‚æˆ‘å†™è¿‡ä¸€ä¸ªpythonè„šæœ¬ï¼Œé€šè¿‡å®šæ—¶è§¦å‘ï¼Œå¦‚æœå‘ç°ipå˜åŠ¨å°±ç»™æˆ‘emailå‘ä¸€å°é‚®ä»¶å‘Šè¯‰æˆ‘æœ€æ–°ipï¼Œåœ¨pythonä¸­å†æ·»åŠ å¦‚ä¸‹åŠ å…¥æ¸…ç©ºè‡ªå®šä¹‰è§„åˆ™ï¼ŒåŠ å…¥å…è®¸è®¿é—®IPè§„åˆ™ã€‚æ³¨æ„å¦‚æœä½ è‡ªå·±æ–°å»ºäº†Chainï¼Œä»¥ä½ çš„åç§°ä¸ºå‡†ã€‚æˆ‘æ˜¯ç›´æ¥ä½¿ç”¨forwarding_ruleã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ é™¤æ—§è§„åˆ™</span><br><span class="line">ip6tables -F forwarding_rule</span><br><span class="line"># æ·»åŠ æ–°çš„å…è®¸è®¿é—®ip</span><br><span class="line">ip6tables -A forwarding_rule -d device_ipv6 -j ACCEPT</span><br></pre></td></tr></table></figure><p>å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨pythonè·å–æœ€æ–°étemporaryçš„ip6åœ°å€ã€‚è¿™ä¸€æ­¥å¯¹ç³»ç»Ÿæœ‰å…¼å®¹æ€§ï¼Œå¯èƒ½å„ç§æ–¹å¼ä¸ä¸€æ ·ã€‚</li><li>å¯¹æ¯”ä¸Šæ¬¡è·å–çš„ipv6åœ°å€ï¼Œæ¯”è¾ƒæ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´è¯´æ˜æœ‰å˜åŒ–ï¼Œéœ€è¦æ›´æ–°ï¼Œä¿å­˜ä¾›ä¸‹æ¬¡æ¯”è¾ƒã€‚</li><li>å‚è€ƒæˆ‘å‰é¢çš„blogï¼Œæ°¸ä¹…å¼€å¯telnetï¼Œè¿™ä¸€æ­¥ç½‘ä¸Šæœ‰å’Œç¬¬2æ­¥ç»“åˆçš„è„šæœ¬ï¼Œä½†æ˜¯ä½¿ç”¨curlå‘é€çš„è¯·æ±‚ï¼Œé‚£urlåˆè‡­åˆé•¿ï¼Œä¸å¦‚å‚è€ƒæˆ‘çš„ä¸€æ­¥åˆ°ä½ã€‚</li><li>ä½¿ç”¨pythonå‘é€telnetï¼Œè¿æ¥è·¯ç”±ï¼Œè¾“å…¥å¯†ç ï¼Œdebugshellã€‚</li><li>ip6tables -F forwarding_rule</li><li>ip6tables -A forwarding_rule -d your_device_ipv6 -j ACCEPT</li><li>åŠ å…¥crontab -eï¼ŒåŠå°æ—¶æ‰§è¡Œä¸€æ¬¡</li></ol><p>å’Œæœ‹å‹äº¤æµåï¼Œæœ‹å‹è¯´å¯ä»¥ä¸é‡‡ç”¨emailå½¢å¼ï¼Œé’‰é’‰ã€é£ä¹¦è¿™ç±»åŠå…¬è½¯ä»¶æœ‰webhookï¼Œä¹Ÿå°±æ˜¯å½“ä½ ipå˜åŠ¨åï¼Œä½ ä½¿ç”¨curlå‘ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œé£ä¹¦å°±ä¼šç»™ä½ å‘é€æ¶ˆæ¯ã€‚å› ä¸ºæˆ‘åŸºæœ¬ä¸ç”¨é£ä¹¦é’‰é’‰ï¼Œæ‰€ä»¥å°±ç®—äº†å§ã€‚å½“ç„¶äº†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç»‘å®šåŸŸåï¼Œæˆ‘å…¶å®å·²ç»åšäº†AAAAè§£æäº†ï¼Œä½†æ˜¯æ‡’å¾—å¼„DDNSäº†(æœ‰ä¸ªå¼€æºçš„ç¨‹åºå«DDNS-GO)ï¼Œå› ä¸ºæˆ‘å¤–ç½‘è¿æ¥æœºå™¨è¿™ä¸ªå¹¶ä¸æ˜¯ä¸€ä¸ªåˆšéœ€ä¸”å¯†é›†çš„äº‹ä»¶ï¼Œæ‰€ä»¥ï¼Œéœ€è¦çš„æ—¶å€™æ”¹ipåœ°å€å°±è¡Œäº†ã€‚</p><p>æœ€åï¼Œéå¸¸æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;NX54ç»ˆäºæ›´æ–°å›ºä»¶äº†ï¼Œæ–°ç‰ˆæœ¬æ”¯æŒé…ç½®å…³é—­ipv6é˜²ç«å¢™ï¼Œä½†æ˜¯ï¼Œé˜²ç«å¢™å…³é—­ï¼Œç›¸å¯¹è€Œè¨€é£é™©ä¹Ÿå°±ä¸Šæ¥äº†ã€‚å…¶å®æœ€å¥½çš„åŠæ³•æ˜¯ï¼Œåœ¨é˜²ç«å¢™ä¸Šç¨å¾®å¼€ä¸€ä¸ªå°å£å°±è¡Œäº†ï¼Œä¹Ÿå°±æ˜¯ï¼Œåªå…è®¸ç›®æ ‡åœ°å€æ˜¯ä½ æŒ‡å®šIPçš„æ•°æ®é€šè¿‡ï¼Œä»Šå¤©å°±å¤§æ¦‚è¯´è¯´å¦‚ä½•æœ€å°é£é™©å»å¤„ç†è¿™ä»¶äº‹æƒ…ã€‚ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªæ“ä½œï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ip6tablesé™åˆ¶æŒ‡å®šç›®æ ‡ipè½¬å‘&lt;/li&gt;
&lt;li&gt;å…³é—­è¦è®¿é—®çš„æœåŠ¡å™¨çš„sshè®¿é—®ï¼Œwindowsä¸»æœºå¯å¿½ç•¥&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="nx54" scheme="https://lefo.me/categories/nx54/"/>
    
    
    <category term="h3c" scheme="https://lefo.me/tags/h3c/"/>
    
    <category term="nx54" scheme="https://lefo.me/tags/nx54/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•æ„å»ºä¸€ä¸ªpdfium.so</title>
    <link href="https://lefo.me/2024/05/12/build-pdfium/"/>
    <id>https://lefo.me/2024/05/12/build-pdfium/</id>
    <published>2024-05-12T06:50:01.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é¡¹ç›®ä¸­æ¥å…¥äº†æ‰“å¼€pdfæ–‡ä»¶çš„åŠŸèƒ½ï¼Œä½¿ç”¨çš„æ˜¯<a href="https://github.com/barteksc/PdfiumAndroid/">https://github.com/barteksc/PdfiumAndroid/</a>ã€‚ç°åœ¨æƒ³å‡çº§ä¸€ä¸‹pdfiumåº“ï¼Œæ—§åº“å…·ä½“åŸå› å°±ä¸è§£é‡Šäº†ï¼Œæ¯•ç«Ÿè¿™ä¸ªé¡¹ç›®æœ€åä¸€ä¸ªcommitåœ¨6å¹´å‰ï¼Œå½“ç„¶ï¼Œå¹³å¸¸ç”¨æ¥æ¥å…¥æ‰“å¼€pdfä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚</p><h1 id="å¼€æºåº“"><a href="#å¼€æºåº“" class="headerlink" title="å¼€æºåº“"></a>å¼€æºåº“</h1><p>åœ¨googleä¸€é€šæœç´¢ï¼Œå‘ç°pdfiumåº“åŒ…å«ä¸¤å¥—ï¼Œä¸€å¥—åœ¨aospä¸­ï¼Œå¦ä¸€å¥—åœ¨chromiumä¸­ã€‚</p><ul><li><a href="https://android.googlesource.com/platform/external/pdfium/">https://android.googlesource.com/platform/external/pdfium/</a></li><li><a href="https://pdfium.googlesource.com/pdfium/">https://pdfium.googlesource.com/pdfium/</a><br>ä¸¤æ¬¾ä»£ç åº”è¯¥å·®ä¸å¤šï¼Œaospçš„æ„å»ºä½¿ç”¨Android.bpï¼Œç‰ˆæœ¬è¦æ¯”pdfiumç‰ˆæœ¬çš„è½åä¸€äº›ã€‚å†çœ‹PdfiumAndroidé¡¹ç›®READMEï¼Œç¬¬ä¸€å¥å°±è¯´Uses pdfium library from AOSPï¼Œä½¿ç”¨çš„åº“åº”è¯¥ä¹Ÿæ˜¯aospçš„åº“ã€‚</li></ul><h1 id="æ„å»ºaospç‰ˆ"><a href="#æ„å»ºaospç‰ˆ" class="headerlink" title="æ„å»ºaospç‰ˆ"></a>æ„å»ºaospç‰ˆ</h1><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ol><li>ubuntu å¯ä»¥ä½¿ç”¨virtual boxå»è£…ä¸ªè™šæ‹Ÿæœº</li><li>200GBä»¥ä¸Šç¡¬ç›˜ç©ºé—´ï¼Œæ¸…åä¼šæ¨èä½ ä¸‹è½½aosp-latest.tarå†è§£å‹ï¼Œå…‰å‹ç¼©åŒ…80Gäº†ï¼Œè§£å‹å®Œæˆ‘å°±æŠŠtaråŒ…åˆ äº†</li></ol><h2 id="è·å–aospæºç "><a href="#è·å–aospæºç " class="headerlink" title="è·å–aospæºç "></a>è·å–aospæºç </h2><p>æ¨èä½¿ç”¨æ¸…åé•œåƒ<a href="https://mirrors-i.tuna.tsinghua.edu.cn/help/AOSP/">https://mirrors-i.tuna.tsinghua.edu.cn/help/AOSP/</a>ï¼Œå¯ç»“åˆgoogleçš„å®˜æ–¹è¯´æ˜<a href="https://source.android.com/docs/setup?hl=zh-cn">https://source.android.com/docs/setup?hl=zh-cn</a>ã€‚å…·ä½“æŒ‡ä»¤å°±ä¸ä»‹ç»äº†ï¼Œä¸»è¦æ˜¯repo syncè´¹æ—¶ï¼Œæ³¨æ„é€‰å¥½ä½ æƒ³æ„å»ºçš„build tagã€‚</p><span id="more"></span><h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><p>ä½¿ç”¨aospçš„ç¼–è¯‘æ¯”è¾ƒç®€å•ï¼Œç›´æ¥èµ°aospé‚£ä¸€å¥—å°±è¡Œï¼Œä¸»è¦å°±æ˜¯ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ç»“åˆå®˜æ–¹æ–‡æ¡£ä»‹ç»ï¼Œè‡ªè¡Œä¿®æ”¹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> aosp  <span class="comment"># è¿›åˆ°aospæ ¹ç›®å½•</span></span><br><span class="line">. build/envsetup.sh     <span class="comment"># é…ç½®æ„å»ºç¯å¢ƒï¼Œè¿™æ¡å‘½ä»¤ä¼šæŠŠä¸€ç³»åˆ—å‘½ä»¤åŠ åˆ°å¯æ‰§è¡Œç¯å¢ƒä¸­</span></span><br><span class="line">lunch armv8_eng         <span class="comment"># é…ç½®è¦&lt;product_name&gt;-&lt;build_variant&gt;ï¼Œæˆ‘è¿™é‡Œè¦çš„æ˜¯arm64çš„</span></span><br><span class="line"><span class="built_in">cd</span> external/pdfium      <span class="comment"># go to pdfium directory</span></span><br><span class="line">mma                     <span class="comment"># build module and deps</span></span><br><span class="line"><span class="comment"># out/target/product/armv8/obj/SHARED_LIBRARIES/libpdfium_intermediates/libpdfium.so</span></span><br></pre></td></tr></table></figure><h1 id="æ„å»ºchromiumç‰ˆæœ¬"><a href="#æ„å»ºchromiumç‰ˆæœ¬" class="headerlink" title="æ„å»ºchromiumç‰ˆæœ¬"></a>æ„å»ºchromiumç‰ˆæœ¬</h1><h2 id="ç¼–å¥½çš„åº“ï¼Œç›´æ¥æ‹¿æ¥ç”¨"><a href="#ç¼–å¥½çš„åº“ï¼Œç›´æ¥æ‹¿æ¥ç”¨" class="headerlink" title="ç¼–å¥½çš„åº“ï¼Œç›´æ¥æ‹¿æ¥ç”¨"></a>ç¼–å¥½çš„åº“ï¼Œç›´æ¥æ‹¿æ¥ç”¨</h2><p><a href="https://github.com/bblanchon/pdfium-binaries">pdfium-binaries</a><br>è¿™ä¸ªé¡¹ç›®æ˜¯åˆ©ç”¨github actionè‡ªåŠ¨æ„å»ºpdfiumï¼Œå…¶æä¾›äº†æ‰€æœ‰ç‰ˆæœ¬çš„soï¼Œç›¸å½“æ–¹ä¾¿ã€‚å¦å¤–æƒ³æ‰‹åŠ¨æ„å»ºï¼Œæœ‰äº›è¦ä¿®æ”¹çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥å‚è€ƒè¿™ä¸ªé¡¹ç›®ä¸­çš„patchã€‚è¿™ä¸ªé¡¹ç›®æ˜¯æˆ‘æ„å»ºå®Œä»¥åæ‰æ‰¾åˆ°çš„ï¼Œç®—æ˜¯ç™½å¿™æ´»ï¼Œä¸è¿‡ä¹Ÿç®—æ˜¯ä¸€ç‚¹çŸ¥è¯†ã€‚</p><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>ä¸€å¼€å§‹æˆ‘åœ¨ç½‘ä¸Šæœäº†å¾ˆå¤šèµ„æ–™ï¼Œéƒ½æ˜¯è®²å¦‚ä½•æ„å»ºè¿™ä¸ªç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨aospä»£ç åŒæ­¥çš„æ—¶å€™ï¼Œå¥½é¡ºå¸¦æäº†æè¿™ä¸ªï¼Œå’Œaospçš„mmå°±å¯ä»¥æ„å»ºï¼Œè¿™ä¸ªæ˜¯ç›¸å½“å¤´ç–¼å•Šã€‚</p><ol><li>å®˜æ–¹æ–‡æ¡£ç®€å•ã€‚å®˜æ–¹åªä»‹ç»äº†å¦‚ä½•Buildï¼Œä½†æ˜¯æ²¡å‘Šè¯‰ä½ å¦‚ä½•buildå®‰å“ç”¨çš„åº“ã€‚</li><li>ç½‘ä¸Šå†…å®¹å¤æ‚ã€è€æ—§ï¼Œå¯¹ä¼¸æ‰‹å…šä¸å‹å¥½ã€‚æ¯”å¦‚ <code>install-build-deps-android.sh</code>ï¼Œæˆ‘æœçš„æ‰€æœ‰èµ„æ–™ï¼Œé‡Œé¢éƒ½æœ‰è¿™æ¡å‘½ä»¤ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªæ–‡ä»¶å…¶å®å·²ç»åˆ é™¤äº†ã€‚</li><li>æ²¡æœ‰é•œåƒã€‚å¯èƒ½æ˜¯æˆ‘æ²¡æ‰¾åˆ°ï¼Œåæ­£ä»£ç æ˜¯æˆ‘å…¨ç¨‹å¼€ç§‘æŠ€åŒæ­¥çš„ã€‚</li></ol><h2 id="å‡†å¤‡-1"><a href="#å‡†å¤‡-1" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ol><li>ubuntuã€‚ä¸ç¡®å®šmacè¡Œä¸è¡Œï¼Œæˆ‘macä¸Šè¯•äº†ä¸€ä¸‹ï¼Œinstall-build-deps.shæç¤ºæˆ‘æ²¡æœ‰lsb-releaseï¼Œæˆ‘å°±ç›´æ¥æ¢ubuntuäº†</li><li>80GBç¡¬ç›˜ã€‚å…¶å®ç”¨ä¸äº†ï¼Œæˆ‘è™šæ‹Ÿæœºå¼€äº†è¿™ä¹ˆå¤šã€‚</li><li>ä¸Šç½‘è¦æœ‰ç§‘æŠ€ï¼Œæ‰€æœ‰ä»£ç éƒ½åœ¨googlesourceï¼Œå»ºè®®æœ‰è¾ƒå¥½çš„ç½‘ç»œã€‚</li></ol><h2 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://chromium.googlesource.com/chromium/tools/depot_tools.git</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;<span class="variable">$PATH</span>:/path/to/depot_tools&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get code</span></span><br><span class="line"><span class="built_in">mkdir</span> repo</span><br><span class="line"><span class="built_in">cd</span> repo</span><br><span class="line">gclient config --unmanaged https://pdfium.googlesource.com/pdfium.git</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;target_os = [ &#x27;android&#x27; ]&quot;</span> &gt;&gt; .gclient</span><br><span class="line">gclient <span class="built_in">sync</span></span><br><span class="line">gclient runhooks</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># setup build</span></span><br><span class="line"><span class="built_in">cd</span> pdfium</span><br><span class="line">./build/install-build-deps.sh --android</span><br><span class="line"></span><br><span class="line">gn args out</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="args"><a href="#args" class="headerlink" title="args"></a>args</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">target_os=&quot;android&quot;</span><br><span class="line">target_cpu=&quot;arm64&quot;</span><br><span class="line"></span><br><span class="line">use_goma = false</span><br><span class="line">pdf_bundle_freetype=true</span><br><span class="line">pdf_is_standalone=true</span><br><span class="line">is_component_build=false</span><br><span class="line">pdf_enable_xfa=false</span><br><span class="line">pdf_enable_v8=false</span><br><span class="line">pdf_use_skia = false</span><br><span class="line">use_cxx11_on_android=false</span><br><span class="line"></span><br><span class="line">is_debug=false</span><br><span class="line">is_official_build=true</span><br><span class="line">chrome_pgo_phase = 0</span><br></pre></td></tr></table></figure><h2 id="proxy"><a href="#proxy" class="headerlink" title="proxy"></a>proxy</h2><p>[Boto]<br>proxy &#x3D; example-host<br>proxy_port &#x3D; port number</p><p>save as your_file.boto<br>export NO_AUTH_BOTO_CONFIG&#x3D;&#x2F;path&#x2F;your_file.boto</p><h2 id="config"><a href="#config" class="headerlink" title="config"></a>config</h2><p>æ­¤èŠ‚å†…å®¹æ”¶é›†è‡ªäº’è”ç½‘ï¼Œæœ‰äº›å†…å®¹å¹¶ä¸é€‚ç”¨ï¼Œä½†ç¬¬ä¸€æ¡çš„FPDFSDK_EXPORTSæ˜¯å¿…é¡»çš„ã€‚</p><ol><li>æ‰“å¼€pdfium&#x2F;BUILD.gn æ–‡ä»¶ï¼Œæ‰¾åˆ° config(â€œpdfium_common_configâ€)ï¼Œå°†ä»¥ä¸‹é…ç½®ï¼š  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">config(&quot;pdfium_common_config&quot;) &#123;</span><br><span class="line">  cflags = [ ]</span><br><span class="line">  ldflags = []</span><br><span class="line">  include_dirs = [ &quot;.&quot; ]</span><br><span class="line">  defines = [</span><br><span class="line">    &quot;PNG_PREFIX&quot;,</span><br><span class="line">    &quot;PNG_USE_READ_MACROS&quot;,</span><br><span class="line">    **&quot;FPDFSDK_EXPORTS&quot;**</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></li></ol><ul><li>å¢åŠ â€-fvisibility&#x3D;defaultâ€åˆ° cflags ï¼Œå°†ç¬¦å·çš„å¯è§æ€§è®¾ç½®ä¸ºé»˜è®¤å€¼ã€‚è¿™æ„å‘³ç€å…¶ä»–ç»„ä»¶å¯ä»¥å¼•ç”¨è¯¥ç¬¦å·ï¼Œå¹¶ä¸”ç¬¦å·å®šä¹‰å¯ä»¥è¢«å¦ä¸€ä¸ªç»„ä»¶ä¸­çš„åŒåå®šä¹‰è¦†ç›–ã€‚</li><li>å¢åŠ â€-DNOCJKâ€åˆ° cflags ï¼Œè¿™å°†åœæ­¢å°†å­—ä½“åµŒå…¥åˆ°.soæ–‡ä»¶ä¸­å¹¶å‡å°å…¶å¤§å°ã€‚</li><li>å¢åŠ â€œFPDFSDK_EXPORTSâ€ åˆ° defines â€” æŠŠç¬¦å·è¡¨åµŒå…¥åˆ°å…±äº«åº“ä¸­ã€‚</li></ul><ol start="2"><li>åœ¨component(â€œpdfiumâ€)å‰è¿½åŠ ä»¥ä¸‹é…ç½® -L&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libatomicè²Œä¼¼å¯ä»¥ä¸åŠ ï¼Œå› ä¸ºä¹‹å‰æ˜¯ -latomicï¼Œç»“æœç³»ç»Ÿæ­»æ´»æ‰¾ä¸åˆ°  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">shared_library(&quot;pdfsdk&quot;) &#123;</span><br><span class="line">  deps = [&quot;:pdfium&quot;]</span><br><span class="line">  ldflags = [ &quot;-L/lib/x86_64-linux-gnu/libatomic&quot; ]</span><br><span class="line">  if (target_os == &quot;android&quot;) &#123;</span><br><span class="line">    configs -= [ &quot;//build/config/android:hide_all_but_jni_onload&quot; ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">component(&quot;pdfium&quot;) &#123;</span><br><span class="line">//â€¦</span><br></pre></td></tr></table></figure></li></ol><h2 id="build"><a href="#build" class="headerlink" title="build"></a>build</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ninja -C out pdfsdk</span><br></pre></td></tr></table></figure><h2 id="å¤‡æ³¨"><a href="#å¤‡æ³¨" class="headerlink" title="å¤‡æ³¨"></a>å¤‡æ³¨</h2><ol><li>æŒ‡å®šcommitåŒæ­¥ä»£ç ï¼šgclient sync â€“revision 837fe726e639f823a62ed4aa4abda45d40f3c803 </li><li>åŒæ­¥ä»£ç æ—¶è¦åŠ çš„å‚æ•°ï¼Œå› ä¸ºæˆ‘ä»¬åªæƒ³è¦ä»£ç  å¹¶ä¸æƒ³è¦history<br>  repo init â€“depth&#x3D;1 -u <a href="https://github.com/zawzaww/aosp-android.git-bandroid-8.1.0">https://github.com/zawzaww/aosp-android.git-bandroid-8.1.0</a><br>  repo sync  -f â€“force-sync â€“no-clone-bundle â€“no-tags -j$(nproc â€“all)</li><li>gclientä¹Ÿå¯ä»¥åŠ ä¸Š-no-historyèŠ‚çœåŒæ­¥æ—¶é—´</li></ol><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://github.com/bblanchon/pdfium-binaries">pdfium-binaries</a><br><a href="https://i.lckiss.com/?p=5897">https://i.lckiss.com/?p=5897</a><br><a href="https://github.com/bblanchon/pdfium-binaries/blob/master/patches/shared_library.patch">https://github.com/bblanchon/pdfium-binaries/blob/master/patches/shared_library.patch</a><br><a href="https://groups.google.com/g/pdfium/c/-WdW5n0KZ-8">https://groups.google.com/g/pdfium/c/-WdW5n0KZ-8</a></p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;é¡¹ç›®ä¸­æ¥å…¥äº†æ‰“å¼€pdfæ–‡ä»¶çš„åŠŸèƒ½ï¼Œä½¿ç”¨çš„æ˜¯&lt;a href=&quot;https://github.com/barteksc/PdfiumAndroid/&quot;&gt;https://github.com/barteksc/PdfiumAndroid/&lt;/a&gt;ã€‚ç°åœ¨æƒ³å‡çº§ä¸€ä¸‹pdfiumåº“ï¼Œæ—§åº“å…·ä½“åŸå› å°±ä¸è§£é‡Šäº†ï¼Œæ¯•ç«Ÿè¿™ä¸ªé¡¹ç›®æœ€åä¸€ä¸ªcommitåœ¨6å¹´å‰ï¼Œå½“ç„¶ï¼Œå¹³å¸¸ç”¨æ¥æ¥å…¥æ‰“å¼€pdfä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å¼€æºåº“&quot;&gt;&lt;a href=&quot;#å¼€æºåº“&quot; class=&quot;headerlink&quot; title=&quot;å¼€æºåº“&quot;&gt;&lt;/a&gt;å¼€æºåº“&lt;/h1&gt;&lt;p&gt;åœ¨googleä¸€é€šæœç´¢ï¼Œå‘ç°pdfiumåº“åŒ…å«ä¸¤å¥—ï¼Œä¸€å¥—åœ¨aospä¸­ï¼Œå¦ä¸€å¥—åœ¨chromiumä¸­ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://android.googlesource.com/platform/external/pdfium/&quot;&gt;https://android.googlesource.com/platform/external/pdfium/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://pdfium.googlesource.com/pdfium/&quot;&gt;https://pdfium.googlesource.com/pdfium/&lt;/a&gt;&lt;br&gt;ä¸¤æ¬¾ä»£ç åº”è¯¥å·®ä¸å¤šï¼Œaospçš„æ„å»ºä½¿ç”¨Android.bpï¼Œç‰ˆæœ¬è¦æ¯”pdfiumç‰ˆæœ¬çš„è½åä¸€äº›ã€‚å†çœ‹PdfiumAndroidé¡¹ç›®READMEï¼Œç¬¬ä¸€å¥å°±è¯´Uses pdfium library from AOSPï¼Œä½¿ç”¨çš„åº“åº”è¯¥ä¹Ÿæ˜¯aospçš„åº“ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;æ„å»ºaospç‰ˆ&quot;&gt;&lt;a href=&quot;#æ„å»ºaospç‰ˆ&quot; class=&quot;headerlink&quot; title=&quot;æ„å»ºaospç‰ˆ&quot;&gt;&lt;/a&gt;æ„å»ºaospç‰ˆ&lt;/h1&gt;&lt;h2 id=&quot;å‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡&quot;&gt;&lt;/a&gt;å‡†å¤‡&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;ubuntu å¯ä»¥ä½¿ç”¨virtual boxå»è£…ä¸ªè™šæ‹Ÿæœº&lt;/li&gt;
&lt;li&gt;200GBä»¥ä¸Šç¡¬ç›˜ç©ºé—´ï¼Œæ¸…åä¼šæ¨èä½ ä¸‹è½½aosp-latest.tarå†è§£å‹ï¼Œå…‰å‹ç¼©åŒ…80Gäº†ï¼Œè§£å‹å®Œæˆ‘å°±æŠŠtaråŒ…åˆ äº†&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;è·å–aospæºç &quot;&gt;&lt;a href=&quot;#è·å–aospæºç &quot; class=&quot;headerlink&quot; title=&quot;è·å–aospæºç &quot;&gt;&lt;/a&gt;è·å–aospæºç &lt;/h2&gt;&lt;p&gt;æ¨èä½¿ç”¨æ¸…åé•œåƒ&lt;a href=&quot;https://mirrors-i.tuna.tsinghua.edu.cn/help/AOSP/&quot;&gt;https://mirrors-i.tuna.tsinghua.edu.cn/help/AOSP/&lt;/a&gt;ï¼Œå¯ç»“åˆgoogleçš„å®˜æ–¹è¯´æ˜&lt;a href=&quot;https://source.android.com/docs/setup?hl=zh-cn&quot;&gt;https://source.android.com/docs/setup?hl=zh-cn&lt;/a&gt;ã€‚å…·ä½“æŒ‡ä»¤å°±ä¸ä»‹ç»äº†ï¼Œä¸»è¦æ˜¯repo syncè´¹æ—¶ï¼Œæ³¨æ„é€‰å¥½ä½ æƒ³æ„å»ºçš„build tagã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="androidå¼€å‘" scheme="https://lefo.me/categories/android%E5%BC%80%E5%8F%91/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
    <category term="pdfium" scheme="https://lefo.me/tags/pdfium/"/>
    
  </entry>
  
  <entry>
    <title>H3C NX54è·¯ç”±å™¨å¦‚ä½•æ°¸ä¹…å¼€telnetï¼Œæ°¸ä¹…å…³é—­ipv6é˜²ç«å¢™</title>
    <link href="https://lefo.me/2024/02/20/nx54-telnet/"/>
    <id>https://lefo.me/2024/02/20/nx54-telnet/</id>
    <published>2024-02-20T03:17:40.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰ä¹°äº†ä¸€å°NX54è·¯ç”±å™¨ï¼Œç»“æœè¿™è·¯ç”±å›ºä»¶å®Œå…¨ä¸ç»™ç”¨æˆ·å®šåˆ¶åŒ–çš„æœºä¼šï¼Œç ”ç©¶å¦‚ä½•ä¿å­˜ip6tableçš„é…ç½®æ²¡æœ‰æˆåŠŸï¼Œä½†æ˜¯æˆåŠŸä¿å­˜äº†telnetå¼€å¯é…ç½®ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚è¿™å¥—å›ºä»¶çš„æƒ…å†µå¦‚ä¸‹:</p><ol><li>é»˜è®¤å¼€å¯ipv6é˜²ç«å¢™ï¼Œä¸”å…³é—­åï¼Œé‡å¯ä¼šå¤±æ•ˆï¼Œå†æ¬¡æ‰“å¼€ã€‚</li><li>å¯ä»¥é€šè¿‡telnetè¿æ¥è·¯ç”±ï¼Œtelneté…ç½®ä¹Ÿä¸ä¿å­˜ï¼Œåœç”µæˆ–è€…é‡å¯åå¤±æ•ˆã€‚</li><li>æ ¹ç›®å½•ä½¿ç”¨overlayfsåšåˆ°äº†tmpä¸‹ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿä¼šæ¢å¤çš„ä¸»è¦åŸå› ã€‚</li><li>æä¾›äº†&#x2F;mntç›®å½•ä¿å­˜æ•°æ®ï¼Œ&#x2F;mnt&#x2F;bak&#x2F;startup.bakå°±æ˜¯æ‰€æœ‰é…ç½®é¡¹ã€‚<span id="more"></span></li></ol><h1 id="å…³é—­ipv6é˜²ç«å¢™"><a href="#å…³é—­ipv6é˜²ç«å¢™" class="headerlink" title="å…³é—­ipv6é˜²ç«å¢™"></a>å…³é—­ipv6é˜²ç«å¢™</h1><ol><li>è®¿é—®http:&#x2F;&#x2F;[ip]&#x2F;debug.asp</li><li>å‘ä¸‹æ‹‰ï¼Œæ‰¾åˆ°telnetç®¡ç†ï¼Œå‹¾é€‰å¯åŠ¨telnetï¼Œç‚¹æ—è¾¹åº”ç”¨</li><li>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå…³é—­ipv6é˜²ç«å¢™<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">telnet &lt;è·¯ç”±ip&gt; 15000</span><br><span class="line"><span class="comment"># è¾“å…¥å¯†ç </span></span><br><span class="line">&lt;your password&gt;</span><br><span class="line"><span class="comment"># &lt;H3C_NX54&gt;åè¾“å…¥ debugshell</span></span><br><span class="line">debugshell</span><br><span class="line">ip6tables -D FORWARD -j ACCEPT</span><br><span class="line">ip6tables -I FORWARD -j ACCEPT</span><br></pre></td></tr></table></figure></li></ol><h1 id="æ°¸ä¹…å¼€telnet"><a href="#æ°¸ä¹…å¼€telnet" class="headerlink" title="æ°¸ä¹…å¼€telnet"></a>æ°¸ä¹…å¼€telnet</h1><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><ol><li>ç³»ç»Ÿä¿å­˜æœ‰ä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œé‡å¯åä¼šæ ¹æ®è¿™ä»½é…ç½®æ–‡ä»¶æ¢å¤é…ç½®ã€‚</li><li>é…ç½®æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;md5&gt; /var/run/.tmpcfg</span><br><span class="line">&lt;ç‰ˆæœ¬&gt;</span><br><span class="line">&lt;å…·ä½“é…ç½®...&gt;</span><br></pre></td></tr></table></figure></li><li>å…¶ä¸­md5ç”¨äºæ ¡éªŒæ•´ä¸ªæ–‡ä»¶ï¼Œå°±æ˜¯ä»ç‰ˆæœ¬å·å¼€å§‹ï¼Œåç»­æ‰€æœ‰é…ç½®è®¡ç®—å¾—åˆ°çš„ã€‚</li><li>åç»­æœ‰ä¸ªtelnetenable&#x3D;çš„é…ç½®ï¼Œä½†ç³»ç»Ÿåšäº†ç‰¹æ®Šè®¾å®šï¼Œåå°ä¿®æ”¹telnetå¹¶ä¸ä¼šä¿å­˜åˆ°é…ç½®ä¸­ï¼Œå¯¼è‡´telnetä¸èƒ½è‡ªåŠ¨å¼€ï¼Œè¿™é‡Œæˆ‘ä»¬å°±éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚</li><li>ä¿®æ”¹åï¼Œæ›¿æ¢md5æ‘˜è¦ï¼Œæ•´ä¸ªé…ç½®å°±æ˜¯ä¸€ä¸ªæœ‰æ•ˆé…ç½®ã€‚</li></ol><p>æµç¨‹ç®€å•å¦‚ä¸‹ï¼Œç§»é™¤ç¬¬ä¸€è¡Œ -&gt; è®¡ç®—md5 -&gt; md5é‡æ–°åŠ åˆ°ç¬¬ä¸€è¡Œã€‚</p><h1 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h1><h2 id="å¿«é€Ÿæ–¹æ³•"><a href="#å¿«é€Ÿæ–¹æ³•" class="headerlink" title="å¿«é€Ÿæ–¹æ³•"></a><del>å¿«é€Ÿæ–¹æ³•</del></h2><p>æœ¬æ–¹æ³•åªé€‚åˆé…ç½®çº¯è‹±æ–‡ï¼Œä¸æ”¯æŒé…ç½®æ–‡ä»¶ä¸­æœ‰ä¸­æ–‡ï¼Œå¦‚æœå¤±è´¥ï¼Œå¯ä»¥å°è¯•ä¸‹ä¸€èŠ‚çš„æ‰‹åŠ¨å¤„ç†æ–¹æ³•ã€‚</p><ul><li><a href="/html/nx54config.html"><strong>NX54å¼€å¯telneté…ç½®ç”Ÿæˆå™¨</strong></a>(è¾“å…¥æ‰€æœ‰é…ç½®æ–‡ä»¶å†…å®¹ï¼Œç½‘é¡µä¼šå¸®ä½ ä¿®æ”¹)</li><li><a href="/html/md5.html">md5åœ¨çº¿è®¡ç®—</a>(æ³¨æ„æœ¬ç«™ä¼šè®¡ç®—æ‰€æœ‰å†…å®¹çš„md5ï¼Œè¿™é‡Œç”¨ä¸ä¸Šï¼Œåªåšå‚è€ƒ)<br>æˆ‘æ­å»ºäº†ä¸€ä¸ªç½‘é¡µï¼Œåªè¦æŠŠè·¯ç”±çš„é…ç½®å¤åˆ¶è¿‡æ¥ï¼Œå°±ä¼šç”Ÿæˆå¼€telnetçš„æ–°é…ç½®ã€‚ç½‘é¡µçº¯é™æ€ï¼Œä¸ä¼šå‘å¤–å‘é€ä½ çš„ä»»ä½•é…ç½®ä¿¡æ¯ï¼Œçº¯javascriptæœ¬åœ°è¿è¡Œçš„ï¼Œè¿™é‡Œæ•™å¦‚ä½•ç”¨ç½‘é¡µè½¬åŒ–é…ç½®ã€‚é…ç½®ä¿¡æ¯é‡Œæœ‰å®½å¸¦å¯†ç è´¦å·ï¼Œå¦‚æœå®åœ¨ä¸æ”¾å¿ƒæˆ‘ï¼Œä¸‹ä¸€ä¸ªå¤§æ ‡é¢˜çš„ç¯èŠ‚æ˜¯çº¯æ‰‹åŠ¨æ”¹ã€‚</li></ul><ol><li>ç™»å½•è·¯ç”±åå°ï¼Œè®¾å¤‡ç®¡ç† -&gt; åŸºæœ¬ç®¡ç†ï¼Œå¤‡ä»½ï¼Œä¸‹è½½å®Œæˆåï¼Œå¤åˆ¶ä¸€ä»½(é˜²æ­¢ä¸‡ä¸€éœ€è¦åˆå§‹åŒ–åæ¢å¤å¾—å†é…ç½®)ã€‚</li><li>ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ä¸‹è½½çš„æ–‡ä»¶</li><li>å¤åˆ¶æ‰€æœ‰å†…å®¹åˆ° <a href="/html/nx54config.html">NX54å¼€å¯telneté…ç½®ç”Ÿæˆå™¨</a> å·¦ä¾§ï¼Œåœ¨å³ä¾§ä¼šç”Ÿæˆä¸€ä»½æ–°é…ç½®ã€‚</li><li>ç‚¹<code>COPY</code>ï¼Œæ›¿æ¢æ‰åŸé…ç½®æ–‡ä»¶å†…å®¹ï¼Œä¿å­˜ã€‚</li><li>è·¯ç”±åå°ï¼Œé€‰æ‹©æ–‡ä»¶ï¼Œæ¢å¤ã€‚</li><li>ç­‰é‡å¯åï¼Œtelnetå°±æ°¸ä¹…å¼€äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å†™ä¸€ä¸ªshellï¼Œè‡ªåŠ¨æ‰§è¡Œtelnetå¹¶å¼€ipv6ï¼Œè¿™äº›å†…å®¹å°±è‡ªå·±æ‰¾æ–‡å¿ƒä¸€è¨€æˆ–è€…chatgptç”Ÿæˆå§ã€‚</li></ol><h2 id="é…ç½®æ–‡ä»¶å¸¦ä¸­æ–‡æˆ–è€…æ ¼å¼é”™è¯¯çš„æ‰‹åŠ¨å¤„ç†æ–¹æ³•"><a href="#é…ç½®æ–‡ä»¶å¸¦ä¸­æ–‡æˆ–è€…æ ¼å¼é”™è¯¯çš„æ‰‹åŠ¨å¤„ç†æ–¹æ³•" class="headerlink" title="é…ç½®æ–‡ä»¶å¸¦ä¸­æ–‡æˆ–è€…æ ¼å¼é”™è¯¯çš„æ‰‹åŠ¨å¤„ç†æ–¹æ³•"></a>é…ç½®æ–‡ä»¶å¸¦ä¸­æ–‡æˆ–è€…æ ¼å¼é”™è¯¯çš„æ‰‹åŠ¨å¤„ç†æ–¹æ³•</h2><p><strong>æ¨èï¼Œç”¨ä¸Šé¢çš„ç½‘é¡µæ›´å¿«ï¼Œä½†æ˜¯é…ç½®ä¸­ä¸å¾—å«æœ‰ä¸­æ–‡ï¼Œå¦åˆ™ç”Ÿæˆçš„æ–‡ä»¶éªŒè¯ä¸é€šè¿‡ã€‚è¿™é‡Œåªæ˜¯æŠŠæµç¨‹çº¯æ‰‹åŠ¨ï¼ŒåŸç†ä¸€æ ·ï¼Œä½†æ”¯æŒç‰¹æ®Šç¬¦å·ã€ä¸­æ–‡ã€‚</strong><br><strong><a href="/html/filemd5.html">æ–‡ä»¶md5è®¡ç®—</a></strong></p><ol><li>ç™»å½•è·¯ç”±åå°ï¼Œè®¾å¤‡ç®¡ç† -&gt; åŸºæœ¬ç®¡ç†ï¼Œå¤‡ä»½ï¼Œä¸‹è½½å®Œæˆåï¼Œå¤åˆ¶ä¸€ä»½å¤‡ä»½(é˜²æ­¢ä¸‡ä¸€éœ€è¦åˆå§‹åŒ–åæ¢å¤å¾—å†é…ç½®)ã€‚</li><li>æ‰“å¼€å¦‚ä¸‹ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5f0521762cfa7553351d4173706b4c99  /var/run/.tmpcfg</span><br><span class="line">NX54/NX54V100D011</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li><li>æ‰¾åˆ°<code>telnetenable=</code>ï¼Œå°†&#x3D;åé¢çš„å†…å®¹æ”¹ä¸ºenableï¼Œä¿å­˜ã€‚ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@telnet</span><br><span class="line">#</span><br><span class="line">    telnetenable=enable</span><br></pre></td></tr></table></figure></li><li>åˆ é™¤ç¬¬ä¸€è¡Œï¼Œåªä¿ç•™ç¬¬äºŒè¡Œ<code>NX54/NX54V100D011</code>å¼€å§‹åŠåé¢å†…å®¹ï¼Œä¿å­˜æ–‡ä»¶ã€‚</li><li>æ‰“å¼€<a href="/html/filemd5.html">æ–‡ä»¶md5è®¡ç®—</a>è®¡ç®—ï¼Œä½ ä¹Ÿå¯ä»¥éªŒè¯ä¸€ä¸‹ä¿®æ”¹å‰çš„md5ã€‚</li><li>å°†ç”Ÿæˆçš„md5å†æ¬¡ç²˜è´´åˆ°ç¬¬ä¸€è¡Œæ›¿æ¢åŸmd5(æ³¨æ„ä¸€å®šæ˜¯å°å†™) <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ–°md5 /var/run/.tmpcfg</span><br><span class="line">NX54/NX54V100D011</span><br><span class="line">...</span><br><span class="line">@telnet</span><br><span class="line">#</span><br><span class="line">    telnetenable=enable</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li>å»è·¯ç”±åå°ï¼Œå¤‡ä»½é‚£é‡Œæ‰¾ä»æ–‡ä»¶ä¸­æ¢å¤è®¾ç½®ä¿¡æ¯ï¼Œé€‰æ‹©æ–‡ä»¶ï¼Œç‚¹æ¢å¤ã€‚</li></ol><h1 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h1><ol><li>æœ€å¥½ä¸è¦ç›´æ¥å…¨å…³ipv6é˜²ç«å¢™ï¼Œå¯ä»¥æŒ‡å®šipå…è®¸è½¬å‘ã€‚</li><li>nx54åˆ†é…çš„ip6åœ°å€ä¸å›ºå®šï¼Œæ‰€ä»¥å¦‚æœæŒ‡å®šipåï¼Œæ¯æ¬¡éœ€è¦ç§»é™¤æ—§çš„è§„åˆ™</li><li>é€šå¸¸æˆ‘ä»¬éƒ½æ˜¯è®©æ–‡ä»¶æœåŠ¡å™¨æˆ–è€…NASåœ¨å¤–ç½‘è®¿é—®ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŠŠå‘½ä»¤å†™åˆ°nasä¸Šï¼Œä¸€æ—¦ipå˜åŠ¨ï¼Œåˆ™æ‰§è¡Œå‘½ä»¤</li><li>å…·ä½“iptableæŒ‡ä»¤æ€ä¹ˆè°ƒæ•´ï¼Œè¿˜æ˜¯è¾¹å­¦æŒ‡ä»¤è¾¹é—®chatgptå§ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¼„äº†ï¼Œæˆ‘ä¹Ÿæ²¡NASï¼Œæœ‰ä¸ªæ—§çš„armæ¿å­ï¼Œæ²¡æ€ä¹ˆæ­ï¼Œå»å¹´çœ‹äº†ä¸€ä¸‹å¿«ä¹°ä¸èµ·ç¡¬ç›˜äº†ï¼Œç¡¬ç›˜ç°åœ¨ä»·æ ¼é€†å¤©äº†ã€‚</li><li>å…¨ç½‘é¦–å‘ï¼Œæ²¡æ‰¾åˆ°æ€ä¹ˆé…ç½®çš„æ–¹æ³•ï¼Œè¦è½¬è½½è¯·é™„ä¸Šæˆ‘çš„ç½‘å€ï¼Œç»™ç‚¹æµé‡ã€‚</li></ol><h1 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h1><p>ä¸èƒ½ç”¨ä¸­æ–‡æ˜¯åæ¥å‘ç°çš„ï¼Œæ„Ÿè°¢æ–°ç–†çš„å¤§å“¥ï¼Œæä¾›äº†ä»–çš„é…ç½®æ–‡ä»¶è®©æˆ‘å‘ç°äº†é—®é¢˜ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¹‹å‰ä¹°äº†ä¸€å°NX54è·¯ç”±å™¨ï¼Œç»“æœè¿™è·¯ç”±å›ºä»¶å®Œå…¨ä¸ç»™ç”¨æˆ·å®šåˆ¶åŒ–çš„æœºä¼šï¼Œç ”ç©¶å¦‚ä½•ä¿å­˜ip6tableçš„é…ç½®æ²¡æœ‰æˆåŠŸï¼Œä½†æ˜¯æˆåŠŸä¿å­˜äº†telnetå¼€å¯é…ç½®ï¼Œåˆ†äº«ä¸€ä¸‹ã€‚è¿™å¥—å›ºä»¶çš„æƒ…å†µå¦‚ä¸‹:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;é»˜è®¤å¼€å¯ipv6é˜²ç«å¢™ï¼Œä¸”å…³é—­åï¼Œé‡å¯ä¼šå¤±æ•ˆï¼Œå†æ¬¡æ‰“å¼€ã€‚&lt;/li&gt;
&lt;li&gt;å¯ä»¥é€šè¿‡telnetè¿æ¥è·¯ç”±ï¼Œtelneté…ç½®ä¹Ÿä¸ä¿å­˜ï¼Œåœç”µæˆ–è€…é‡å¯åå¤±æ•ˆã€‚&lt;/li&gt;
&lt;li&gt;æ ¹ç›®å½•ä½¿ç”¨overlayfsåšåˆ°äº†tmpä¸‹ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿä¼šæ¢å¤çš„ä¸»è¦åŸå› ã€‚&lt;/li&gt;
&lt;li&gt;æä¾›äº†&amp;#x2F;mntç›®å½•ä¿å­˜æ•°æ®ï¼Œ&amp;#x2F;mnt&amp;#x2F;bak&amp;#x2F;startup.bakå°±æ˜¯æ‰€æœ‰é…ç½®é¡¹ã€‚</summary>
    
    
    
    <category term="nx54" scheme="https://lefo.me/categories/nx54/"/>
    
    
    <category term="h3c" scheme="https://lefo.me/tags/h3c/"/>
    
    <category term="nx54" scheme="https://lefo.me/tags/nx54/"/>
    
  </entry>
  
  <entry>
    <title>é‡å­¦å®‰å“ä¹‹Jetpack</title>
    <link href="https://lefo.me/2024/01/30/jetpack/"/>
    <id>https://lefo.me/2024/01/30/jetpack/</id>
    <published>2024-01-30T14:07:12.000Z</published>
    <updated>2026-01-27T02:36:14.658Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¯¼è¯»"><a href="#å¯¼è¯»" class="headerlink" title="å¯¼è¯»"></a>å¯¼è¯»</h1><p>jetpackå½“æ—¶è¿˜æ²¡æ¥å¾—åŠç”¨ï¼Œæ•´ä¸ªé¡¹ç›®å°±è¢«ç æ‰äº†ï¼Œè¿™ä¸¤å¹´ä¸€ç›´æ²¡æœ‰æ¥è§¦ï¼Œæœ€è¿‘å¥½å¤šå²—ä½éƒ½è¦æ±‚ä¼šjetpackï¼Œè¿™ä¸¤å¹´é€æ¸ç”¨çš„äººè¶Šæ¥è¶Šå¤šï¼Œé‡å­¦Androidèµ¶ç´§ç®€å•äº†è§£ä¸€ä¸‹ï¼Œåšäº†ä¸€ç‚¹æ•´ç†ï¼Œéƒ½æ˜¯çš®æ¯›ï¼Œä¾›è‡ªå·±æŸ¥ç¬”è®°ç”¨å§ï¼Œå¦‚æœæœ‰ä¸€äº›çŸ¥è¯†ç‚¹éœ€è¦å¢åŠ å¤‡æ³¨ï¼Œéšæ—¶ä¿®æ”¹ã€‚</p><h1 id="Navigation-ç”¨äºfragmentåˆ‡æ¢"><a href="#Navigation-ç”¨äºfragmentåˆ‡æ¢" class="headerlink" title="Navigation ç”¨äºfragmentåˆ‡æ¢"></a>Navigation ç”¨äºfragmentåˆ‡æ¢</h1><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ul><li>å¯è§†åŒ–ï¼Œå¯ä»¥asä¸­å¯è§†åŒ–ç¼–è¾‘</li><li>é€šè¿‡destinationå’Œactionå®Œæˆé¡µé¢çš„å¯¼èˆª</li><li>å‚æ•°ä¼ é€’å®‰å…¨ï¼Œ safe args</li><li>æ”¯æŒdeeplinkï¼Œæ”¯æŒåˆ›å»ºPendingIntent<span id="more"></span><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è¿”å›ä¸€ä¸ª PendingIntent</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> PendingIntent <span class="title function_">getPendingIntent</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Navigation.findNavController(requireActivity(), R.id.button)</span><br><span class="line">            .createDeepLink()</span><br><span class="line">            .setGraph(R.navigation.my_nav_graph)</span><br><span class="line">            .setDestination(R.id.detailFragment)</span><br><span class="line">            .createTaskStackBuilder()</span><br><span class="line">            .getPendingIntent(<span class="number">0</span>, PendingIntent.FLAG_IMMUTABLE);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¸»è¦ç»„ä»¶"><a href="#ä¸»è¦ç»„ä»¶" class="headerlink" title="ä¸»è¦ç»„ä»¶"></a>ä¸»è¦ç»„ä»¶</h2><ol><li>Graph xmlèµ„æºæ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰é¡µé¢å’Œé¡µé¢é—´çš„å…³ç³»</li><li>Controller ç”¨äºå®ŒæˆGraphä¸­çš„é¡µé¢åˆ‡æ¢</li><li>NavHostFragment ç‰¹æ®Šfragmentå®¹å™¨</li><li>æä¾›äº†NavigationUiæ§åˆ¶å„ç§barçš„æ”¹å˜</li></ol><h2 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤:"></a>æ“ä½œæ­¥éª¤:</h2><ol><li>æ–°å»ºAndroid Resource Fileä¸­çš„Graphæ–‡ä»¶ï¼ŒResource typeä¸ºNavigationï¼Œä¼šåœ¨navigationç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªxml</li><li>å°†NavHostFragmentæ·»åŠ åˆ°activityã€‚&#96;&#96;ï¼Œä½œä¸ºå…¶å®ƒfragmentçš„å®¹å™¨ï¼ŒdefaultNaveHost&#x3D;trueä¼šè‡ªåŠ¨å¤„ç†è¿”å›é”®<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fragment</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;android.navigation. fragment .NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:defaultNaveHost</span>=<span class="string">&quot;true&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/my_graph&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºæ–°çš„destinationï¼Œå…¶å®å°±æ˜¯å°†fragmentæ·»åŠ åˆ°navigationï¼Œnavigationä¼šæœ‰ä¸€ä¸ªstartDesination</li><li>å»ºç«‹actionï¼Œåœ¨å¯è§†ç¼–è¾‘é‡Œæ˜¯å°†ä¸€ä¸ªå’Œå¦ä¸€ä¸ªè¿èµ·æ¥ï¼Œxmlä¸­ä¸ºfragmentå«æœ‰ä¸€ä¸ªactionæ ‡ç­¾ï¼ŒæŒ‡å‘å¦ä¸€ä¸ªfragmentã€‚</li><li>Navigation.findNavController(view).navigate(id)æ¥å®Œæˆå¯¼èˆª</li></ol><h2 id="safe-argsä¼ é€’å‚æ•°"><a href="#safe-argsä¼ é€’å‚æ•°" class="headerlink" title="safe argsä¼ é€’å‚æ•°"></a>safe argsä¼ é€’å‚æ•°</h2><p>åœ¨fragmentä¸­æ·»åŠ å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// æ·»åŠ æ’ä»¶</span><br><span class="line">apply plugin: &#x27;androidx.navigation.safeargs&#x27;</span><br><span class="line"></span><br><span class="line">&lt;fragment&gt;</span><br><span class="line">    &lt;action/&gt;</span><br><span class="line">    &lt;argument </span><br><span class="line">        android:name=&quot;name&quot;</span><br><span class="line">        app:argType=&quot;string&quot;</span><br><span class="line">        android:defaultValue=&#x27;&quot;lefo&quot;&#x27;/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ·»åŠ åï¼Œä¼šç”Ÿæˆå¯¹åº”çš„ä»£ç æ–‡ä»¶ï¼Œå°±å¯ä»¥ç”¨Buildåˆ›å»ºå¯¹åº”çš„bundleäº†</p><h2 id="NavigationUi"><a href="#NavigationUi" class="headerlink" title="NavigationUi"></a>NavigationUi</h2><p>NavigationUI æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•æ¥å¤„ç† é¡¶éƒ¨åº”ç”¨æ  &#x2F; æŠ½å±‰å¼å¯¼èˆªæ  &#x2F; åº•éƒ¨å¯¼èˆªæ ä¸­ çš„ç•Œé¢å¯¼èˆª, ç»Ÿä¸€ç®¡ç† Fragment é¡µé¢åˆ‡æ¢ç›¸å…³çš„UIæ”¹å˜<br>CollapsingToolbarlayoutã€Toolbarã€ActionBar</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è·å– NavController</span></span><br><span class="line">navController = Navigation.findNavController(<span class="built_in">this</span>, R.id.fragment)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. åˆ›å»º AppBarConfiguration</span></span><br><span class="line">appBarConfiguration = AppBarConfiguration.Builder(navController.graph).build();</span><br><span class="line">NavigationUI.setupActionBarWithNavController(<span class="built_in">this</span>,navController,appBarConfiguration);</span><br></pre></td></tr></table></figure><h1 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h1><h2 id="LifecycleOwnerå’ŒLifecycleObserver"><a href="#LifecycleOwnerå’ŒLifecycleObserver" class="headerlink" title="LifecycleOwnerå’ŒLifecycleObserver"></a>LifecycleOwnerå’ŒLifecycleObserver</h2><p>å®ç°LifecyclerObserveræ¥å£ï¼Œå°†è¦åœ¨å…·ä½“ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œçš„æ–¹æ³•ä½¿ç”¨@OnLifecycleEventæ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnLifecycleEvent</span> (Lifecycle.Event.ONRESUME) </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">onResumeEvent</span> <span class="params">()</span> &#123;</span><br><span class="line">    Log.d (TAG, <span class="string">&quot;onResumeEvent() &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">//åœ¨Activityä¸­æ³¨å†Œè§‚å¯Ÿè€…</span></span><br><span class="line">getLifecycle().addObserver(myObserver);</span><br></pre></td></tr></table></figure><ul><li>LifecycleServiceï¼Œä½¿ç”¨æ–¹å¼ç­‰äºService</li><li>ProcessLifecycleOwner æ•´ä¸ªåº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ ä½¿ç”¨æ–¹æ³•ProcessLifecycleOwner.get().getLifecycle()</li><li>LifecycleRegistryç±»ï¼Œç®¡ç†mObserverMapç»´æŠ¤stateå’Œevent</li></ul><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>é€šè¿‡åœ¨Activityä¸­ç»‘å®šä¸€ä¸ªç©ºçš„fragmentæ¥å®ç°ç›‘å¬Activityç”Ÿå‘½å‘¨æœŸã€‚</p><h1 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h1><p>ä½¿ç”¨ViewModelProvideråˆ›å»ºä¸€ä¸ªViewModel</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">constructor</span>(</span><br><span class="line">    owner: ViewModelStoreOwner</span><br><span class="line">) : <span class="keyword">this</span>(owner.viewModelStore, defaultFactory(owner), defaultCreationExtras(owner))</span><br></pre></td></tr></table></figure><p>é€šå¸¸ä½¿ç”¨ViewModelProvider</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NoteViewModelFactory</span>(<span class="keyword">private</span> <span class="keyword">val</span> repository: NoteRepository) : ViewModelProvider.Factory &#123;  </span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T : ViewModel&gt;</span> <span class="title">create</span><span class="params">(modelClass: <span class="type">Class</span>&lt;<span class="type">T</span>&gt;)</span></span>: T &#123;  </span><br><span class="line"><span class="keyword">if</span> (modelClass.isAssignableFrom(NoteViewModel::<span class="keyword">class</span>.java)) &#123;  </span><br><span class="line"><span class="meta">@Suppress(<span class="string">&quot;UNCHECKED_CAST&quot;</span>)</span>  </span><br><span class="line"><span class="keyword">return</span> NoteViewModel(repository) <span class="keyword">as</span> T  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">throw</span> IllegalArgumentException(<span class="string">&quot;Unknown ViewModel class&quot;</span>)  </span><br><span class="line">&#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> viewModel = ViewModelProvider(<span class="keyword">this</span>, NoteViewModelFactory(repository))[NoteViewModel::<span class="keyword">class</span>.java]</span><br></pre></td></tr></table></figure><p>åŸºæœ¬åŸç†å¦‚ä¸‹</p><ol><li>ViewModelProvideræ¥æ”¶å‚æ•°ViewModelStoreOwnerï¼Œå‚æ•°çš„å¯¹è±¡å®ç°æ–¹æ³•getViewModelStore</li><li>ViewModelStoreæä¾›ä¸€ä¸ªHashMap&lt;String,ViewModel&gt;</li></ol><p>ä¸ºä»€ä¹ˆViewModelåœ¨æ¨ªç«–å±åˆ‡æ¢æ—¶ï¼Œä¸ä¼šè¢«é”€æ¯ï¼Œå…¶å®æ˜¯å› ä¸ºViewModelæ˜¯ä¿å­˜åœ¨ViewModelStoreä¸­çš„ï¼Œè€Œåœ¨æ„ŸçŸ¥åˆ°Destoryçš„ç”Ÿå‘½å‘¨æœŸæ—¶ï¼Œä¼šåˆ¤æ–­isChangingConfigurationsï¼Œå¦‚æœä¸ºå¦ï¼Œæ‰ä¼šè¿›å…¥getViewModelStore().clear();</p><h1 id="LiveData"><a href="#LiveData" class="headerlink" title="LiveData"></a>LiveData</h1><p>LiveDataçš„ä½œç”¨æ˜¯ViewModelåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥é¡µé¢</p><ul><li>å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè§‚å¯Ÿè€…æ¨¡å¼çš„æ•°æ®å®¹å™¨ï¼Œå½“æ•°æ®æ”¹å˜æ—¶ï¼Œé€šçŸ¥UIåˆ·æ–°ï¼›</li><li>èƒ½æ„ŸçŸ¥activity fragmentç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œ</li><li>é€šå¸¸å’ŒviewModelä¸€èµ·ä½¿ç”¨ï¼Œ<code>LiveData&lt;T&gt;</code>ä½œä¸ºViewModelçš„ä¸€ä¸ªæˆå‘˜å˜é‡</li><li>liveData.observe()æ³¨å†Œä¸€ä¸ªå¯¹æ•°æ®çš„è§‚å¯Ÿ</li><li>observeForeverä½¿ç”¨åä¸€å®šè¦ç”¨removeObserveræ–¹æ³•åœæ­¢è§‚å¯Ÿ</li></ul><h1 id="DataBinding"><a href="#DataBinding" class="headerlink" title="DataBinding"></a>DataBinding</h1><h2 id="åŸºç¡€ç”¨æ³•"><a href="#åŸºç¡€ç”¨æ³•" class="headerlink" title="åŸºç¡€ç”¨æ³•"></a>åŸºç¡€ç”¨æ³•</h2><ul><li>DataBindingç»“åˆViewModelæ˜¯å¸¸ç”¨çš„åšæ³•</li><li>å‘includeçš„äºŒçº§é¡µé¢ä¼ é€’æ•°æ®</li><li>BaseObservableå’ŒObservableFieldæ”¯æŒå¤šä¸ªæ§ä»¶äº’ç›¸ç»‘å®šæ•°æ®<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- activity_main.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">&quot;com.example.User&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:context</span>=<span class="string">&quot;.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;@&#123;user.name&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">&quot;Click&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:onClick</span>=<span class="string">&quot;@&#123;() -&gt; user.onButtonClick()&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : AppCompatActivity() &#123;</span><br><span class="line"></span><br><span class="line">    override fun <span class="title function_">onCreate</span><span class="params">(savedInstanceState: Bundle?)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ DataBindingUtil è®¾ç½®å¸ƒå±€æ–‡ä»¶å’Œæ•°æ®ç»‘å®š</span></span><br><span class="line">        val binding: ActivityMainBinding = DataBindingUtil.setContentView(<span class="built_in">this</span>, R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»º User å¯¹è±¡</span></span><br><span class="line">        <span class="type">val</span> <span class="variable">user</span> <span class="operator">=</span> User(<span class="string">&quot;John Doe&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°† User å¯¹è±¡ç»‘å®šåˆ°å¸ƒå±€ä¸­çš„ user å˜é‡</span></span><br><span class="line">        binding.user = user</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®ç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">        binding.button.setOnClickListener &#123;</span><br><span class="line">            user.onButtonClick()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">layout</span>=<span class="string">&quot;@layout/layout2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:user</span>=<span class="string">&quot;@&#123;user&#125;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--åœ¨2çº§é¡µé¢è¿™ä¹ˆå†™--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">&quot;user&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;com.example.User&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="è‡ªå®šä¹‰BindAdapter"><a href="#è‡ªå®šä¹‰BindAdapter" class="headerlink" title="è‡ªå®šä¹‰BindAdapter"></a>è‡ªå®šä¹‰BindAdapter</h2><p>è¿˜å¯ä»¥å¢åŠ ä¸€ä¸ªå‚æ•°ä½œä¸ºæ—§å€¼ï¼Œä½†æ­¤æ—¶å¿…é¡»å…ˆå†™æ—§å€¼</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> CustomBindingAdapters &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindingAdapter(<span class="string">&quot;imageUrl&quot;</span>)</span></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">loadImage</span><span class="params">(imageView: <span class="type">ImageView</span>, url: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨ Glide åŠ è½½å›¾ç‰‡</span></span><br><span class="line">        Glide.with(imageView.context)</span><br><span class="line">            .load(url)</span><br><span class="line">            .into(imageView)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BindingAdapter(<span class="string">&quot;visibility&quot;</span>)</span></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setVisibility</span><span class="params">(view: <span class="type">View</span>, isVisible: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½® View çš„å¯è§æ€§</span></span><br><span class="line">        view.visibility = <span class="keyword">if</span> (isVisible) View.VISIBLE <span class="keyword">else</span> View.GONE</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/imageView&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:imageUrl</span>=<span class="string">&quot;@&#123;viewModel.imageUrl&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">View</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/customView&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:visibility</span>=<span class="string">&quot;@&#123;viewModel.isVisible&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ViewBinding"><a href="#ViewBinding" class="headerlink" title="ViewBinding"></a>ViewBinding</h1><p>å‡å°‘findviewbyidï¼Œç®€å•ä¸¾ä¾‹ä¸€ä¸‹</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨ View Binding</span></span><br><span class="line"><span class="keyword">val</span> binding = ActivityMainBinding.inflate(layoutInflater)</span><br><span class="line">setContentView(binding.root)</span><br></pre></td></tr></table></figure><h1 id="Room"><a href="#Room" class="headerlink" title="Room"></a>Room</h1><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity(tableName = <span class="string">&quot;user_table&quot;</span>)</span></span><br><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">User</span>(</span><br><span class="line">    <span class="meta">@PrimaryKey(autoGenerate = true)</span></span><br><span class="line">    <span class="keyword">val</span> id: <span class="built_in">Long</span> = <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">val</span> name: String,</span><br><span class="line">    <span class="keyword">val</span> email: String</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dao</span></span><br><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="meta">@Query(<span class="string">&quot;SELECT * FROM user_table&quot;</span>)</span></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAllUsers</span><span class="params">()</span></span>: List&lt;User&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(onConflict = OnConflictStrategy.REPLACE)</span></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">insertUser</span><span class="params">(user: <span class="type">User</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// @Database(entities = [User::class], version = 1, exportSchema = false)</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AppDatabase</span> : <span class="type">RoomDatabase</span>() &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">userDao</span><span class="params">()</span></span>: UserDao</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ•°æ®åº“ï¼Œä½¿ç”¨èµ·æ¥å’Œä¹‹å‰çš„æ³¨è§£æ¡†æ¶å·®ä¸å¤šï¼Œå¯ä»¥é…åˆLiveDataå’ŒViewModelå®ç°æ•°æ®çš„åˆ·æ–°ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserRepository</span>(<span class="keyword">private</span> <span class="keyword">val</span> userDao: UserDao) &#123;</span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getUsersFromNetwork</span><span class="params">()</span></span>: List&lt;User&gt; &#123;</span><br><span class="line">        <span class="comment">// ä»ç½‘ç»œè·å–æ•°æ®çš„é€»è¾‘</span></span><br><span class="line">        <span class="keyword">val</span> networkData = <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ•°æ®å­˜å‚¨åˆ°æ•°æ®åº“</span></span><br><span class="line">        userDao.insertUser(networkData)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> networkData</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">getAllUsers</span><span class="params">()</span></span>: List&lt;User&gt; &#123;</span><br><span class="line">        <span class="comment">// ä»æ•°æ®åº“è·å–æ•°æ®çš„é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> userDao.getAllUsers()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ViewModelä¸­ä½¿ç”¨Repository</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyViewModel</span>(<span class="keyword">private</span> <span class="keyword">val</span> userRepository: UserRepository) : ViewModel() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> _users = MutableLiveData&lt;List&lt;User&gt;&gt;()</span><br><span class="line">    <span class="keyword">val</span> users: LiveData&lt;List&lt;User&gt;&gt; <span class="keyword">get</span>() = _users</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetchData</span><span class="params">()</span></span> &#123;</span><br><span class="line">        viewModelScope.launch &#123;</span><br><span class="line">            <span class="comment">// ä»ç½‘ç»œè·å–æ•°æ®å¹¶æ›´æ–°æ•°æ®åº“</span></span><br><span class="line">            userRepository.getUsersFromNetwork()</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ä»æ•°æ®åº“è·å–æ•°æ®å¹¶æ›´æ–° LiveData</span></span><br><span class="line">            _users.value = userRepository.getAllUsers()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Paging"><a href="#Paging" class="headerlink" title="Paging"></a>Paging</h1><p>Pagingè¿˜æ˜¯çœ‹å®˜æ–¹æ–‡æ¡£æ›´åˆé€‚ï¼Œç½‘ä¸Šæœçš„ä¿¡æ¯Paging2å’ŒPaging3å†…å®¹æ··ä¹±ï¼Œè¿™é‡Œæˆ‘ä¹Ÿä¸æ•´ç†äº†ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨RemoteMediatorå»åŒæ—¶æ¥å…¥ db + network çš„æ–¹æ¡ˆã€‚<br><strong>pagingåº“3.0å˜åŒ–è¾ƒå¤§ï¼Œæ”¾ä¸ª<a href="%5Bhttps://developer.android.google.cn/topic/libraries/architecture/paging/v3-overview?hl=zh-cn%5D">å®˜æ–¹é“¾æ¥</a></strong><br><strong><a href="https://github.com/android/architecture-components-samples/blob/main/PagingWithNetworkSample/">å®˜æ–¹DEMO</a></strong></p><ol><li>PagingDataAdapterï¼Œé¦–å…ˆRecyclerViewçš„Adapteréœ€è¦ç»§æ‰¿è¿™ä¸ªç±»ï¼Œæ­¤å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨éšé™„çš„ AsyncPagingDataDiffer ç»„ä»¶æ„å»ºè‡ªå·±çš„è‡ªå®šä¹‰é€‚é…å™¨</li><li>Pager åŸºäº PagingSource å¯¹è±¡å’Œ PagingConfig é…ç½®å¯¹è±¡æ¥æ„é€ åœ¨å“åº”å¼æµä¸­å…¬å¼€çš„ PagingData å®ä¾‹ã€‚</li><li>PagingSourceï¼Œæ•°æ®è½½å…¥ï¼Œæœ‰ä¸€ä¸ªloadæ–¹æ³•éœ€è¦å®ç°</li><li>PagingData ç”¨äºå­˜æ”¾åˆ†é¡µæ•°æ®å¿«ç…§çš„å®¹å™¨ã€‚å®ƒä¼šæŸ¥è¯¢ PagingSource å¯¹è±¡å¹¶å­˜å‚¨ç»“æœã€‚</li><li>RemoteMediator å¤„ç†åˆ†å±‚æ•°æ®æºã€‚</li></ol><blockquote><p>Paging 2 ä¸­çš„ PageKeyedDataSourceã€PositionalDataSource å’Œ ItemKeyedDataSource éƒ½åˆå¹¶åˆ°äº† Paging 3 ä¸­çš„ PagingSource API ä¸­ã€‚æ‰€æœ‰æ—§ç‰ˆ API ç±»ä¸­çš„åŠ è½½æ–¹æ³•éƒ½åˆå¹¶åˆ°äº† PagingSource ä¸­çš„å•ä¸ª load() æ–¹æ³•ä¸­ã€‚è¿™æ ·å¯ä»¥å‡å°‘ä»£ç é‡å¤ï¼Œå› ä¸ºåœ¨æ—§ç‰ˆ API ç±»çš„å®ç°ä¸­ï¼Œå„ç§åŠ è½½æ–¹æ³•ä¹‹é—´çš„å¾ˆå¤šé€»è¾‘é€šå¸¸æ˜¯ç›¸åŒçš„ã€‚<br>åœ¨ Paging 3 ä¸­ï¼Œæ‰€æœ‰åŠ è½½æ–¹æ³•å‚æ•°è¢«ä¸€ä¸ª LoadParams å¯†å°ç±»æ›¿ä»£ï¼Œè¯¥ç±»ä¸­åŒ…å«äº†æ¯ä¸ªåŠ è½½ç±»å‹æ‰€å¯¹åº”çš„å­ç±»ã€‚å¦‚æœéœ€è¦åŒºåˆ† load() æ–¹æ³•ä¸­çš„åŠ è½½ç±»å‹ï¼Œè¯·æ£€æŸ¥ä¼ å…¥äº† LoadParams çš„å“ªä¸ªå­ç±»ï¼šLoadParams.Refreshã€LoadParams.Prepend è¿˜æ˜¯ LoadParams.Appendã€‚</p></blockquote><ol><li><del>BoundaryCallback</del>å¼ƒç”¨äº†ï¼Œä½¿ç”¨RemoteMediatorã€‚åœ¨åˆ†é¡µæ•°æ®è€—å°½æ—¶ï¼ŒPaging åº“ä¼šè§¦å‘ RemoteMediator ä»¥ä»ç½‘ç»œæºåŠ è½½æ–°æ•°æ®ã€‚RemoteMediator ä¼šå°†æ–°æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æ•°æ®åº“ä¸­ï¼Œå› æ­¤æ— éœ€åœ¨ ViewModel ä¸­ä½¿ç”¨å†…å­˜ç¼“å­˜ã€‚æœ€åï¼ŒPagingSource ä¼šä½¿è‡ªèº«å¤±æ•ˆï¼Œè€Œ Pager ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ä»¥ä»æ•°æ®åº“ä¸­åŠ è½½æ–°æ•°æ®ã€‚</li></ol><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OptIn(ExperimentalPagingApi::class)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleRemoteMediator</span>(</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> query: String,</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> database: RoomDb,</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">val</span> networkService: ExampleBackendService</span><br><span class="line">) : RemoteMediator&lt;<span class="built_in">Int</span>, User&gt;() &#123;</span><br><span class="line">  <span class="keyword">val</span> userDao = database.userDao()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    loadType: <span class="type">LoadType</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">    state: <span class="type">PagingState</span>&lt;<span class="type">Int</span>, User&gt;</span></span></span><br><span class="line"><span class="params"><span class="function">  )</span></span>: MediatorResult &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="WorkManager"><a href="#WorkManager" class="headerlink" title="WorkManager"></a>WorkManager</h1><p>æœ€ä½å…¼å®¹api 14ï¼Œåœ¨api 23ä»¥ä¸Šä½¿ç”¨JobSchedulerï¼Œåœ¨api 23ä»¥ä¸‹ä½¿ç”¨AlarmManager</p><ol><li>åˆ›å»ºWorker<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWorker</span>(context: Context, workerParams: WorkerParameters) : Worker(context, workerParams) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doWork</span><span class="params">()</span></span>: Result &#123;</span><br><span class="line">        <span class="comment">// åå°ä»»åŠ¡é€»è¾‘</span></span><br><span class="line">        Timber.d(<span class="string">&quot;Performing long running task in MyWorker&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›ä»»åŠ¡æ‰§è¡Œç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> Result.success()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>è®¾ç½®çº¦æŸæ¡ä»¶<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import androidx.work.Constraints</span><br><span class="line">import androidx.work.NetworkType</span><br><span class="line"></span><br><span class="line">val constraints = Constraints.Builder()</span><br><span class="line">    .setRequiredNetworkType(NetworkType.CONNECTED)</span><br><span class="line">    .setRequiresCharging(true)</span><br><span class="line">    .build()</span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºè¯·æ±‚<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸€æ¬¡æ€§å·¥ä½œè¯·æ±‚</span></span><br><span class="line"><span class="keyword">val</span> oneTimeRequest = OneTimeWorkRequest.Builder(MyWorker::<span class="keyword">class</span>.java)</span><br><span class="line">    .setConstraints(constraints)</span><br><span class="line">    .build()</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘¨æœŸæ€§å·¥ä½œè¯·æ±‚</span></span><br><span class="line"><span class="keyword">val</span> periodicRequest = PeriodicWorkRequest.Builder(MyWorker::<span class="keyword">class</span>.java, <span class="number">24</span>, TimeUnit.HOURS)</span><br><span class="line">    .setConstraints(constraints)</span><br><span class="line">    .build()</span><br></pre></td></tr></table></figure></li><li>åŠ å…¥é˜Ÿåˆ—<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// å°†ä¸€æ¬¡æ€§å·¥ä½œè¯·æ±‚åŠ å…¥é˜Ÿåˆ—</span><br><span class="line">WorkManager.getInstance(context).enqueue(oneTimeRequest)</span><br><span class="line"></span><br><span class="line">// å°†å‘¨æœŸæ€§å·¥ä½œè¯·æ±‚åŠ å…¥é˜Ÿåˆ—</span><br><span class="line">WorkManager.getInstance(context).enqueue(periodicRequest)</span><br></pre></td></tr></table></figure>WorkManagerè¿˜æ”¯æŒé“¾å¼ä»»åŠ¡ï¼Œè§‚å¯Ÿä»»åŠ¡çŠ¶æ€ï¼Œä¼ é€’å‚æ•°ã€‚</li></ol><ul><li>é“¾å¼: åœ¨åŠ å…¥é˜Ÿåˆ—æ—¶ä½¿ç”¨beginWith(oneTimeRequest).then(periodicRequest)ï¼Œè¿˜å¯ä»¥combineâ€¦thenâ€¦</li><li>è§‚å¯Ÿä»»åŠ¡çŠ¶æ€: WorkManager.getWorkInfosXXXï¼Œå¯ä»¥é€šè¿‡tag,id,workerå¯¹è±¡æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€ï¼Œè¿˜èƒ½è·å–å¯¹åº”çš„LiveDataï¼Œé€šè¿‡LiveDataå°±èƒ½åœ¨ä»»åŠ¡çŠ¶æ€å˜åŒ–æ—¶æ”¶åˆ°é€šçŸ¥</li><li>ä¼ å‚: Dataç±»</li></ul><h1 id="Hilt"><a href="#Hilt" class="headerlink" title="Hilt"></a>Hilt</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨åº”ç”¨æ¨¡å—çš„ build.gradle æ–‡ä»¶ä¸­</span><br><span class="line">implementation &quot;com.google.dagger:hilt-android:2.38.1&quot;</span><br><span class="line">kapt &quot;com.google.dagger:hilt-android-compiler:2.38.1&quot;</span><br><span class="line"></span><br><span class="line">// å¦‚æœä½¿ç”¨äº†ViewModelï¼Œè¿˜éœ€è¦æ·»åŠ ä»¥ä¸‹ä¾èµ–</span><br><span class="line">implementation &quot;androidx.hilt:hilt-lifecycle-viewmodel:1.0.0-alpha03&quot;</span><br><span class="line">kapt &quot;androidx.hilt:hilt-compiler:1.0.0-alpha03&quot;</span><br></pre></td></tr></table></figure><ol><li>åœ¨ Application ç±»ä¸­å¯ç”¨ Hiltï¼š åœ¨ä½ çš„ Application ç±»ä¸­ä½¿ç”¨ @HiltAndroidApp æ³¨è§£å¯ç”¨ Hiltã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@HiltAndroidApp</span><br><span class="line">class MyApplication : Application()</span><br></pre></td></tr></table></figure></li><li>é…ç½®ä¾èµ–æ³¨å…¥ï¼š ä½¿ç”¨ @Inject æ³¨è§£æ ‡è®°éœ€è¦æ³¨å…¥çš„ä¾èµ–ï¼ŒåŒæ—¶ä½¿ç”¨ @HiltViewModel æ³¨è§£æ ‡è®°éœ€è¦æ³¨å…¥çš„ ViewModelã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class MyRepository @Inject constructor() &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@HiltViewModel</span><br><span class="line">class MyViewModel @Inject constructor(private val repository: MyRepository) : ViewModel() &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>åœ¨ Activity æˆ– Fragment ä¸­ä½¿ç”¨ Hilt æ³¨å…¥ï¼š åœ¨éœ€è¦æ³¨å…¥ä¾èµ–çš„ Activity æˆ– Fragment ä¸­ï¼Œä½¿ç”¨ @AndroidEntryPoint æ³¨è§£å¯ç”¨ Hiltï¼Œå¹¶ä½¿ç”¨ @Inject æ³¨è§£æ ‡è®°éœ€è¦æ³¨å…¥çš„å­—æ®µã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@AndroidEntryPoint</span><br><span class="line">class MyActivity : AppCompatActivity() &#123;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    lateinit var viewModel: MyViewModel</span><br><span class="line"></span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>åœ¨ Module ä¸­é…ç½®ä¾èµ–ï¼š å¦‚æœéœ€è¦è‡ªå®šä¹‰ä¾èµ–æ³¨å…¥çš„é…ç½®ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Dagger Moduleï¼Œå¹¶åœ¨å…¶ä¸Šä½¿ç”¨ @InstallIn æ³¨è§£æŒ‡å®šä½œç”¨èŒƒå›´ã€‚</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Module</span><br><span class="line">@InstallIn(ApplicationComponent::class)</span><br><span class="line">object MyModule &#123;</span><br><span class="line"></span><br><span class="line">    @Provides</span><br><span class="line">    fun provideMyRepository(): MyRepository &#123;</span><br><span class="line">        return MyRepository()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="DataStore"><a href="#DataStore" class="headerlink" title="DataStore"></a>DataStore</h1><ul><li>ç”¨äºå­˜å‚¨è¾ƒå°çš„æ•°æ®é›†ï¼Œåˆ†ä¸ºPreferences DataStoreå’ŒProto DataStoreï¼Œå¯ä»¥ä»£æ›¿SPï¼Œå¯ä»¥è½»æ¾è¿ç§»æ•°æ®ã€‚</li><li><a href="https://developer.android.com/topic/libraries/architecture/datastore?hl=zh-cn">å®˜æ–¹ä»‹ç»</a></li></ul><h2 id="Preferences-DataStore"><a href="#Preferences-DataStore" class="headerlink" title="Preferences DataStore"></a>Preferences DataStore</h2><ul><li>è¯»å–ç”¨flow</li><li>å†™å…¥ç”¨edit<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºdataStore context.createDataStore</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨å§”æ‰˜åˆ›å»ºdataStore</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> USER_PREFERENCES_NAME = <span class="string">&quot;user_preferences&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> Context.dataStore <span class="keyword">by</span> preferencesDataStore(</span><br><span class="line">    name = USER_PREFERENCES_NAME,</span><br><span class="line">    produceMigrations = &#123; context -&gt;</span><br><span class="line">        <span class="comment">// Since we&#x27;re migrating from SharedPreferences, add a migration based on the</span></span><br><span class="line">        <span class="comment">// SharedPreferences name</span></span><br><span class="line">        listOf(SharedPreferencesMigration(context, USER_PREFERENCES_NAME))</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li></ul><p>å½“ DataStore ä»æ–‡ä»¶è¯»å–æ•°æ®æ—¶ï¼Œå¦‚æœè¯»å–æ•°æ®æœŸé—´å‡ºç°é”™è¯¯ï¼Œç³»ç»Ÿä¼šæŠ›å‡º IOExceptionsã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†è¿™äº›äº‹åŠ¡ï¼šåœ¨ map() ä¹‹å‰ä½¿ç”¨ catch() Flow è¿ç®—ç¬¦ï¼Œå¹¶ä¸”åœ¨æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ IOException æ—¶å‘å‡º emptyPreferences()ã€‚å¦‚æœå‡ºç°å…¶ä»–ç±»å‹çš„å¼‚å¸¸ï¼Œæœ€å¥½é‡æ–°æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> userPreferencesFlow: Flow&lt;UserPreferences&gt; = dataStore.<span class="keyword">data</span></span><br><span class="line">    .<span class="keyword">catch</span> &#123; exception -&gt;</span><br><span class="line">        <span class="comment">// dataStore.data throws an IOException when an error is encountered when reading data</span></span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">is</span> IOException) &#123;</span><br><span class="line">            emit(emptyPreferences())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> exception</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.map &#123; preferences -&gt;</span><br><span class="line">        <span class="comment">// Get our show completed value, defaulting to false if not set:</span></span><br><span class="line">        <span class="keyword">val</span> showCompleted = preferences[PreferencesKeys.SHOW_COMPLETED]?: <span class="literal">false</span></span><br><span class="line">        UserPreferences(showCompleted)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateShowCompleted</span><span class="params">(showCompleted: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    dataStore.edit &#123; preferences -&gt;</span><br><span class="line">        preferences[PreferencesKeys.SHOW_COMPLETED] = showCompleted</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ä»¥ä½¿ç”¨æ‰©å±•å‡½æ•°asLiveDataè½¬æ¢flowä¸ºLiveData</span></span><br><span class="line">userPreferencesFlow.asLiveData().observe(viewLifecycleOwner,&#123; &#125;)</span><br></pre></td></tr></table></figure><h2 id="Proto-DataStore"><a href="#Proto-DataStore" class="headerlink" title="Proto DataStore"></a>Proto DataStore</h2><ol><li>åŒºåˆ«äºä¹‹å‰çš„Preferences DataStoreçš„è¯»å–æ–¹å¼.map{ preferences-&gt; { } }</li><li>å†™å…¥æ–¹å¼ä½¿ç”¨updateData(){ preferences-&gt; {â€¦}}<br>ç”Ÿæˆpbå¯¹è±¡å’Œç±»<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line">option java_package = <span class="string">&quot;com.codelab.android.datastore&quot;</span>;</span><br><span class="line">option java_multiple_files = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">message UserPreferences &#123;</span><br><span class="line">  <span class="comment">// filter for showing / hiding completed tasks</span></span><br><span class="line">  bool show_completed = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>åˆ›å»ºUserPreferencesSerializer<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> UserPreferencesSerializer : Serializer&lt;UserPreferences&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> defaultValue: UserPreferences = UserPreferences.getDefaultInstance()</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">readFrom</span><span class="params">(input: <span class="type">InputStream</span>)</span></span>: UserPreferences &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> UserPreferences.parseFrom(input)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (exception: InvalidProtocolBufferException) &#123;</span><br><span class="line">            <span class="keyword">throw</span> CorruptionException(<span class="string">&quot;Cannot read proto.&quot;</span>, exception)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">writeTo</span><span class="params">(t: <span class="type">UserPreferences</span>, output: <span class="type">OutputStream</span>)</span></span> = t.writeTo(output)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>åˆ›å»ºDataStore<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> USER_PREFERENCES_NAME = <span class="string">&quot;user_preferences&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> DATA_STORE_FILE_NAME = <span class="string">&quot;user_prefs.pb&quot;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> SORT_ORDER_KEY = <span class="string">&quot;sort_order&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> Context.userPreferencesStore: DataStore&lt;UserPreferences&gt; <span class="keyword">by</span> dataStore(</span><br><span class="line">    fileName = DATA_STORE_FILE_NAME,</span><br><span class="line">    serializer = UserPreferencesSerializer</span><br><span class="line">)</span><br></pre></td></tr></table></figure>è¯»å–æ•°æ®<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> TAG: String = <span class="string">&quot;UserPreferencesRepo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> userPreferencesFlow: Flow&lt;UserPreferences&gt; = dataStore.<span class="keyword">data</span></span><br><span class="line">    .<span class="keyword">catch</span> &#123; exception -&gt;</span><br><span class="line">        <span class="comment">// dataStore.data throws an IOException when an error is encountered when reading data</span></span><br><span class="line">        <span class="keyword">if</span> (exception <span class="keyword">is</span> IOException) &#123;</span><br><span class="line">            Log.e(TAG, <span class="string">&quot;Error reading sort order preferences.&quot;</span>, exception)</span><br><span class="line">            emit(UserPreferences.getDefaultInstance())</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> exception</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>å†™å…¥æ•°æ®<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateShowCompleted</span><span class="params">(completed: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    dataStore.updateData &#123; preferences -&gt;</span><br><span class="line">        preferences.toBuilder().setShowCompleted(completed).build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å¯¼è¯»&quot;&gt;&lt;a href=&quot;#å¯¼è¯»&quot; class=&quot;headerlink&quot; title=&quot;å¯¼è¯»&quot;&gt;&lt;/a&gt;å¯¼è¯»&lt;/h1&gt;&lt;p&gt;jetpackå½“æ—¶è¿˜æ²¡æ¥å¾—åŠç”¨ï¼Œæ•´ä¸ªé¡¹ç›®å°±è¢«ç æ‰äº†ï¼Œè¿™ä¸¤å¹´ä¸€ç›´æ²¡æœ‰æ¥è§¦ï¼Œæœ€è¿‘å¥½å¤šå²—ä½éƒ½è¦æ±‚ä¼šjetpackï¼Œè¿™ä¸¤å¹´é€æ¸ç”¨çš„äººè¶Šæ¥è¶Šå¤šï¼Œé‡å­¦Androidèµ¶ç´§ç®€å•äº†è§£ä¸€ä¸‹ï¼Œåšäº†ä¸€ç‚¹æ•´ç†ï¼Œéƒ½æ˜¯çš®æ¯›ï¼Œä¾›è‡ªå·±æŸ¥ç¬”è®°ç”¨å§ï¼Œå¦‚æœæœ‰ä¸€äº›çŸ¥è¯†ç‚¹éœ€è¦å¢åŠ å¤‡æ³¨ï¼Œéšæ—¶ä¿®æ”¹ã€‚&lt;/p&gt;
&lt;h1 id=&quot;Navigation-ç”¨äºfragmentåˆ‡æ¢&quot;&gt;&lt;a href=&quot;#Navigation-ç”¨äºfragmentåˆ‡æ¢&quot; class=&quot;headerlink&quot; title=&quot;Navigation ç”¨äºfragmentåˆ‡æ¢&quot;&gt;&lt;/a&gt;Navigation ç”¨äºfragmentåˆ‡æ¢&lt;/h1&gt;&lt;h2 id=&quot;ä¼˜ç‚¹&quot;&gt;&lt;a href=&quot;#ä¼˜ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;ä¼˜ç‚¹&quot;&gt;&lt;/a&gt;ä¼˜ç‚¹&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å¯è§†åŒ–ï¼Œå¯ä»¥asä¸­å¯è§†åŒ–ç¼–è¾‘&lt;/li&gt;
&lt;li&gt;é€šè¿‡destinationå’Œactionå®Œæˆé¡µé¢çš„å¯¼èˆª&lt;/li&gt;
&lt;li&gt;å‚æ•°ä¼ é€’å®‰å…¨ï¼Œ safe args&lt;/li&gt;
&lt;li&gt;æ”¯æŒdeeplinkï¼Œæ”¯æŒåˆ›å»ºPendingIntent</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
    <category term="é‡å­¦android" scheme="https://lefo.me/tags/%E9%87%8D%E5%AD%A6android/"/>
    
    <category term="Jetpack" scheme="https://lefo.me/tags/Jetpack/"/>
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¸€æ¬¡å°è¯•frida</title>
    <link href="https://lefo.me/2023/10/06/frida/"/>
    <id>https://lefo.me/2023/10/06/frida/</id>
    <published>2023-10-06T15:31:26.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¤§æ¦‚åŠä¸ªæœˆå‰ï¼Œç¾¤é‡Œçš„ä¸€ä¸ªå°ä¼™ä¼´é—®ï¼Œè°èƒ½æŠŠæŸç”µå•†APPçš„è®¢å•åˆ—è¡¨å¯¼å‡ºåˆ°ç”µè„‘ï¼Œæœ‰ä¸ªç§æ´»ï¼ŒæŠ¥ä¸ªä»·ã€‚å…¶å®æˆ‘å¯¹è¿™ç§ç¨å¾®æœ‰ç‚¹äº†è§£ï¼Œæ— éæ˜¯æŠ“åŒ…ï¼Œç ´è§£ã€‚ä½†é€šå¸¸Appçš„ç½‘ç»œè¯·æ±‚ä¼šæœ‰ä¸€å¥—ç­¾åéªŒè¯æœºåˆ¶ï¼Œæ‰€ä»¥è¦æƒ³æ¨¡æ‹Ÿå‡ºæ•´å¥—è¯·æ±‚æµç¨‹ï¼Œä¹Ÿç®—æ¯”è¾ƒå¤æ‚ã€‚å’Œç¾¤é‡Œçš„è®¨è®ºåï¼Œè§‰å¾—ç”¨hookåšåˆé€‚ï¼Œä½†ç¾¤é‡Œå’Œæˆ‘ä¸€æ ·ï¼Œéƒ½æ˜¯å®‰å“å¼€å‘ï¼Œæ²¡æœ‰é€†å‘å·¥ç¨‹å¸ˆï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯xposedã€‚</p><h1 id="xposedå¤ªé‡"><a href="#xposedå¤ªé‡" class="headerlink" title="xposedå¤ªé‡"></a>xposedå¤ªé‡</h1><p>æˆ‘ä¹‹å‰å€’æ˜¯å†™è¿‡xposedï¼Œxposedç¼ºç‚¹æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€å°±æ˜¯ç¯å¢ƒå¤æ‚ï¼Œä½ å¾—å®‰è£…xposedç¯å¢ƒæ‰å¯ä»¥ï¼Œç›®å‰éƒ½æ˜¯é€šè¿‡virtual xposedæ¥ä½¿ç”¨ã€‚å†å°±æ˜¯æ’ä»¶ä¸€ä½†æœ‰ä¿®æ”¹ï¼Œå°±å¾—é‡å¯æ‰‹æœºã€‚ä¸è¿‡è¿™ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªæœ‰ç‚¹å°±æ˜¯æŒä¹…åŒ–ï¼Œåªè¦è£…è¿›å»ï¼Œå°±ä¸€ç›´å­˜åœ¨ã€‚é‚£æœ‰æ²¡æœ‰æ›´è½»é‡çº§çš„å·¥å…·å¯ä»¥è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œåæ¥åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†fridaã€‚(è¿™ä¹Ÿå¥½å‡ å¹´äº†ï¼Œæˆ‘å±…ç„¶ä¸çŸ¥é“)</p><span id="more"></span><h1 id="Frida"><a href="#Frida" class="headerlink" title="Frida"></a>Frida</h1><p>å®˜ç½‘<br><a href="https://github.com/frida/frida/releases">https://github.com/frida/frida/releases</a><br><a href="https://frida.re/">https://frida.re</a></p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>Fridaåˆ†ä¸ºå®¢æˆ·ç«¯(ç”µè„‘) + æœåŠ¡ç«¯(æ‰‹æœºç«¯)ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip3 install frida</span><br><span class="line">pip3 install frida-tools</span><br><span class="line"><span class="comment"># å®‰è£…å®Œæˆåè¿è¡Œï¼ŒæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œæœ‰è¿›ç¨‹è¾“å‡ºè¯´æ˜æˆåŠŸ</span></span><br><span class="line">frida-ps -U</span><br></pre></td></tr></table></figure><p>ä¸‹è½½æœåŠ¡ç«¯ç¨‹åºåˆ°æ‰‹æœº(æ¨¡æ‹Ÿå™¨)ï¼Œå¿…é¡»æœ‰rootæƒé™ã€‚ä¸‹è½½æ—¶æ³¨æ„é€‰æ‹©ä½ å¯¹åº”å¹³å°çš„frida-server</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server /data/local/tmp/</span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line"><span class="built_in">chmod</span> 777 /data/local/tmp/frida-server</span><br><span class="line">/data/local/tmp/frida-server</span><br></pre></td></tr></table></figure><h2 id="æ³¨å…¥jsï¼Œhook"><a href="#æ³¨å…¥jsï¼Œhook" class="headerlink" title="æ³¨å…¥jsï¼Œhook"></a>æ³¨å…¥jsï¼Œhook</h2><p>ä¸¾ä¸€ä¸ªhook okhttpçš„ä¾‹å­ï¼Œokhttpçš„å“åº”ä¿¡æ¯éƒ½æ‰“å°å‡ºæ¥ã€‚åœ¨ç”µè„‘ä¸Šæ–°å»ºä¸€ä¸ªtest.js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js  hook okhttp å› ä¸ºokhttpçš„responseåªèƒ½æ¶ˆè´¹ä¸€æ¬¡ï¼Œä¸ºäº†ä¸å½±å“é»˜è®¤çš„ç¨‹åºï¼Œå°†bufferå¤åˆ¶ä¸€ä»½</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get_http</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">RealCall</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.RealCall&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Buffer</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okio.Buffer&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ResponseBody</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.ResponseBody&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="title class_">RealCall</span>.<span class="property">getResponseWithInterceptorChain</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> response =  <span class="variable language_">this</span>.<span class="title function_">getResponseWithInterceptorChain</span>();</span><br><span class="line">            <span class="keyword">var</span> responseBody = response.<span class="title function_">body</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> buffer = <span class="title class_">Buffer</span>.$new();</span><br><span class="line">            responseBody.<span class="title function_">source</span>().<span class="title function_">readAll</span>(buffer);</span><br><span class="line">            <span class="keyword">var</span> responseBodyString = buffer.<span class="title function_">readUtf8</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP Request -&gt; &quot;</span> + <span class="variable language_">this</span>.<span class="title function_">request</span>().<span class="title function_">url</span>().<span class="title function_">toString</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP Response -&gt; &quot;</span> + responseBodyString);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> builder = response.<span class="title function_">newBuilder</span>();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> newResponse = builder.<span class="title function_">body</span>(<span class="title class_">ResponseBody</span>.<span class="title function_">create</span>(responseBody.<span class="title function_">contentType</span>(), responseBodyString)).<span class="title function_">build</span>();</span><br><span class="line">            <span class="keyword">return</span> newResponse;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœåŠ¡ç«¯åï¼Œåœ¨å®¢æˆ·ç«¯(ç”µè„‘)ä¸Šè¿è¡Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Uæ˜¯USB Fæ˜¯å½“å‰appï¼Œè¿™é‡Œç”¨-nä¹Ÿä¸ä¼šé‡å¯(frida-psæŸ¥åˆ°çš„åå­—)ï¼Œç”¨-f åŒ…å ä¼šé‡å¯app</span><br><span class="line">frida -UF test.js</span><br><span class="line"># è¿è¡Œåï¼Œä¼šè¿›å…¥fridaï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¾“å…¥å…·ä½“jså‡½æ•°ï¼Œæ¯”å¦‚get_http()</span><br><span class="line">get_http()</span><br></pre></td></tr></table></figure><h2 id="å…³äºfridaçš„è¯­æ³•ï¼Œç®€å•ä»‹ç»ä¸€ä¸ªå¸¸ç”¨çš„ï¼Œå‰©ä¸‹çš„ä¸Šå®˜ç½‘æŸ¥ã€‚"><a href="#å…³äºfridaçš„è¯­æ³•ï¼Œç®€å•ä»‹ç»ä¸€ä¸ªå¸¸ç”¨çš„ï¼Œå‰©ä¸‹çš„ä¸Šå®˜ç½‘æŸ¥ã€‚" class="headerlink" title="å…³äºfridaçš„è¯­æ³•ï¼Œç®€å•ä»‹ç»ä¸€ä¸ªå¸¸ç”¨çš„ï¼Œå‰©ä¸‹çš„ä¸Šå®˜ç½‘æŸ¥ã€‚"></a>å…³äºfridaçš„è¯­æ³•ï¼Œç®€å•ä»‹ç»ä¸€ä¸ªå¸¸ç”¨çš„ï¼Œå‰©ä¸‹çš„ä¸Šå®˜ç½‘æŸ¥ã€‚</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var Class = Java.use(&quot;class name&quot;);</span><br><span class="line">Class.method.overload(&quot;param class name&quot;).implementation = function( param) &#123;</span><br><span class="line">    # param.xxxx</span><br><span class="line">    # console.log(&quot;&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å¤§æ¦‚åŠä¸ªæœˆå‰ï¼Œç¾¤é‡Œçš„ä¸€ä¸ªå°ä¼™ä¼´é—®ï¼Œè°èƒ½æŠŠæŸç”µå•†APPçš„è®¢å•åˆ—è¡¨å¯¼å‡ºåˆ°ç”µè„‘ï¼Œæœ‰ä¸ªç§æ´»ï¼ŒæŠ¥ä¸ªä»·ã€‚å…¶å®æˆ‘å¯¹è¿™ç§ç¨å¾®æœ‰ç‚¹äº†è§£ï¼Œæ— éæ˜¯æŠ“åŒ…ï¼Œç ´è§£ã€‚ä½†é€šå¸¸Appçš„ç½‘ç»œè¯·æ±‚ä¼šæœ‰ä¸€å¥—ç­¾åéªŒè¯æœºåˆ¶ï¼Œæ‰€ä»¥è¦æƒ³æ¨¡æ‹Ÿå‡ºæ•´å¥—è¯·æ±‚æµç¨‹ï¼Œä¹Ÿç®—æ¯”è¾ƒå¤æ‚ã€‚å’Œç¾¤é‡Œçš„è®¨è®ºåï¼Œè§‰å¾—ç”¨hookåšåˆé€‚ï¼Œä½†ç¾¤é‡Œå’Œæˆ‘ä¸€æ ·ï¼Œéƒ½æ˜¯å®‰å“å¼€å‘ï¼Œæ²¡æœ‰é€†å‘å·¥ç¨‹å¸ˆï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯xposedã€‚&lt;/p&gt;
&lt;h1 id=&quot;xposedå¤ªé‡&quot;&gt;&lt;a href=&quot;#xposedå¤ªé‡&quot; class=&quot;headerlink&quot; title=&quot;xposedå¤ªé‡&quot;&gt;&lt;/a&gt;xposedå¤ªé‡&lt;/h1&gt;&lt;p&gt;æˆ‘ä¹‹å‰å€’æ˜¯å†™è¿‡xposedï¼Œxposedç¼ºç‚¹æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€å°±æ˜¯ç¯å¢ƒå¤æ‚ï¼Œä½ å¾—å®‰è£…xposedç¯å¢ƒæ‰å¯ä»¥ï¼Œç›®å‰éƒ½æ˜¯é€šè¿‡virtual xposedæ¥ä½¿ç”¨ã€‚å†å°±æ˜¯æ’ä»¶ä¸€ä½†æœ‰ä¿®æ”¹ï¼Œå°±å¾—é‡å¯æ‰‹æœºã€‚ä¸è¿‡è¿™ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªæœ‰ç‚¹å°±æ˜¯æŒä¹…åŒ–ï¼Œåªè¦è£…è¿›å»ï¼Œå°±ä¸€ç›´å­˜åœ¨ã€‚é‚£æœ‰æ²¡æœ‰æ›´è½»é‡çº§çš„å·¥å…·å¯ä»¥è¾¾åˆ°è¿™ç§æ•ˆæœï¼Œåæ¥åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†fridaã€‚(è¿™ä¹Ÿå¥½å‡ å¹´äº†ï¼Œæˆ‘å±…ç„¶ä¸çŸ¥é“)&lt;/p&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
    <category term="frida" scheme="https://lefo.me/tags/frida/"/>
    
  </entry>
  
  <entry>
    <title>é‡å­¦å®‰å“ä¹‹kotlinåç¨‹</title>
    <link href="https://lefo.me/2023/08/08/kotlin-coroutine/"/>
    <id>https://lefo.me/2023/08/08/kotlin-coroutine/</id>
    <published>2023-08-07T18:03:24.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¯¼è¯»"><a href="#å¯¼è¯»" class="headerlink" title="å¯¼è¯»"></a>å¯¼è¯»</h1><p>å› ä¸º2021å¹´å¼€å§‹åšC++ï¼Œä¹‹å‰çš„é¡¹ç›®è¿˜æ²¡æ¥å¾—åŠæ€ä¹ˆç”¨kotlinï¼Œå°±ç›´æ¥è¢«çˆ¸çˆ¸å®£å¸ƒæ­»åˆ‘äº†ã€‚æ‰€ä»¥ç›®å‰æ‰¾å·¥ä½œç­‰äºéœ€è¦å†å­¦ä¸€æ¬¡kotlinï¼Œç‰¹åˆ«æ˜¯åç¨‹ï¼Œä¹‹å‰å‡ ä¹æ²¡æœ‰äº†è§£ã€‚ä¹°äº†æœ¬ä¹¦ï¼Œå†åŠ ä¸Šç½‘ä¸Šçš„å„ç§æ–‡ç« ï¼Œæ•´ç†ä¸€ç‚¹ç¬”è®°å‡ºæ¥ã€‚å¦‚æœæœ‰å’Œæˆ‘å·®ä¸å¤šçš„ï¼Œå¯ä»¥çœ‹ä¸€çœ‹</p><p>åç¨‹ï¼Œåç¨‹å¯ä»¥ç†è§£ä¸ºæŸç§è‡ªç”±è°ƒåº¦çš„ä»»åŠ¡ï¼Œä¸»è¦æ˜¯å¯¹å‡½æ•°æŒ‚èµ·ï¼Œæ¢å¤ã€‚å¬èµ·æ¥åƒçº¿ç¨‹çš„å”¤é†’ï¼Œæœ¬è´¨ä¸Šå’Œçº¿ç¨‹æ²¡ä»€ä¹ˆå…³ç³»ã€‚ä½¿ç”¨åç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥å•çº¿ç¨‹çš„æ–¹å¼å†™å¤šçº¿ç¨‹çš„ä»£ç ï¼ŒåŒæ—¶è¿˜èƒ½èŠ‚çœçº¿ç¨‹èµ„æºï¼Œå¹¶ä¸”èƒ½æ–¹ä¾¿å¤„ç†å¼‚å¸¸ä¿¡æ¯ï¼Œè¿”å›ç»“æœç­‰ã€‚æˆ‘ä»¬ç»™å‡½æ•°å‰é¢åŠ ä¸€ä¸ª<code>suspend</code>å…³é”®å­—ï¼Œå°±å˜æˆä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…æ“ä½œåç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ã€‚å…¶ä¸­éƒ¨åˆ†å†…å®¹æœ‰é‡å¤ï¼Œä¸å¿…ç†ä¼šã€‚ä¸»è¦å‚è€ƒèµ„æ–™&lt;æ·±å…¥ç†è§£Kotlinåç¨‹&gt;ï¼Œç®—æ˜¯ä¸€ä¸ªç®€å•çš„ç¬”è®°æ•´ç†ã€‚</p><h1 id="åç¨‹çš„API"><a href="#åç¨‹çš„API" class="headerlink" title="åç¨‹çš„API"></a>åç¨‹çš„API</h1><h2 id="ä»€ä¹ˆæ˜¯æŒ‚èµ·"><a href="#ä»€ä¹ˆæ˜¯æŒ‚èµ·" class="headerlink" title="ä»€ä¹ˆæ˜¯æŒ‚èµ·"></a>ä»€ä¹ˆæ˜¯æŒ‚èµ·</h2><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fun download(url: String) &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br><span class="line">suspend fun bitmapSuspendable(url: String): Bitmap = </span><br><span class="line">    // æŒ‚èµ·åç¨‹ ä¸‹è½½å®Œæˆåï¼Œè°ƒç”¨resume</span><br><span class="line">    suspendCoroutine&lt;Bitmap&gt; &#123; continuation -&gt; </span><br><span class="line">        thread &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                continuation.resume(download(url))</span><br><span class="line">            &#125; catch (e: Exception) &#123;</span><br><span class="line">                continuation.resumeWithException(e)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">suspend fun main() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        var bitmap = bitmapSuspendable(&quot;url1&quot;)</span><br><span class="line">    &#125; catch ( e: Exception) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨suspendCoroutineå‡½æ•°åŒ…è£…downloadï¼Œåç¨‹ç»“æŸåï¼Œä½¿ç”¨resumeè¿”å›bitmapç»“æœã€‚å½“ç„¶ï¼ŒKotlin åç¨‹æä¾›äº†æ›´æ–¹ä¾¿çš„åº“å‡½æ•°æ¥å¤„ç†æŒ‚èµ·æ“ä½œï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥å®ç°ã€‚</p><ul><li><strong>suspend</strong>å…³é”®å­—ï¼Œè¢«suspendå…³é”®å­—ä¿®é¥°çš„å‡½æ•°å«æŒ‚èµ·å‡½æ•°ã€‚suspendå‡½æ•°åªèƒ½è¢«åç¨‹æˆ–è€…suspendå‡½æ•°è°ƒç”¨ã€‚</li><li><strong>suspendCoroutine<T></strong> ç”¨äºæŒ‚èµ·åç¨‹çš„å‡½æ•°ï¼Œè¿”å›å€¼ç±»å‹ä½œä¸ºæŒ‚èµ·å‡½æ•°çš„è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯æ³›å‹å‚æ•°Tçš„å®å‚Bitmapï¼Œè¿™ä¸ªå‡½æ•°é™¤äº†ç¡®å®è¿”å›å€¼ç±»å‹å¤–ï¼Œè¿˜èƒ½å¸®æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªContinuationå®ä¾‹ï¼Œè´Ÿè´£ä¿å­˜å’Œæ¢å¤æŒ‚èµ·çŠ¶æ€ã€‚</li><li><strong>resume</strong>: æ¢å¤åç¨‹ resumeWithException:å°†exceptionæºå¸¦æ¢å¤åç¨‹</li><li><strong>resumeWith</strong>: ç”¨äºæ¢å¤åç¨‹æ‰§è¡Œï¼Œå¹¶æä¾›ä¸€ä¸ª Result å¯¹è±¡ä½œä¸ºåç¨‹çš„ç»“æœï¼Œè¯¥å¯¹è±¡å¯ä»¥åŒ…å«æˆåŠŸçš„è¿”å›å€¼æˆ–å¼‚å¸¸ã€‚</li><li><strong>resumeWithException</strong>: æ¢å¤ä¸€ä¸ªåç¨‹ï¼Œå¹¶ä¼ é€’ä¸€ä¸ªå¼‚å¸¸ã€‚ä¸€èˆ¬æ— éœ€æ˜¾å¼è°ƒç”¨ï¼Œå› ä¸ºåç¨‹åº“ä¼šè‡ªåŠ¨å¤„ç†åç¨‹çš„å–æ¶ˆå’Œå¼‚å¸¸ä¼ æ’­ã€‚</li></ul><h2 id="ç³»ç»Ÿæä¾›çš„å‡½æ•°"><a href="#ç³»ç»Ÿæä¾›çš„å‡½æ•°" class="headerlink" title="ç³»ç»Ÿæä¾›çš„å‡½æ•°"></a>ç³»ç»Ÿæä¾›çš„å‡½æ•°</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">suspend fun load(time: Int): String &#123;</span><br><span class="line">    delay(1000)</span><br><span class="line">    return &quot;result $time&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun main = runBlocking &#123;</span><br><span class="line">    val load1 = async &#123; load(1) &#125;</span><br><span class="line">    val load2 = async &#123; load(2) &#125;</span><br><span class="line">    // ç­‰å¾…è·å–ç»“æœ</span><br><span class="line">    load1.await()</span><br><span class="line">    load2.await()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒrunBlockingç”¨æ¥åˆ›å»ºä¸€ä¸ªé˜»å¡çš„ä¸»åç¨‹ï¼ŒrunBlockingä¸­çš„ä»£ç ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰åç¨‹éƒ½æ‰§è¡Œå®Œæˆï¼Œè¿™æ ·å¯ä»¥ä¸æ”¹å˜ä»£ç ç»“æ„çš„æƒ…å†µä¸‹ä½¿ç”¨æŒ‚èµ·å‡½æ•°ã€‚è¿˜æœ‰ä¸‹é¢è¿™äº›å¸¸ç”¨çš„å‡½æ•°ã€‚é€šå¸¸æˆ‘ä»¬ä½¿ç”¨<code>launch</code>å’Œ<code>withContext</code>å¤šä¸€äº›ï¼Œå…·ä½“ä½¿ç”¨åœ¨åé¢æœ‰ï¼Œè¿™é‡Œå°±ä¸æ”¾ä»£ç äº†ã€‚</p><ul><li>async å¯åŠ¨å¼‚æ­¥åç¨‹ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨awaitæ¥ç­‰å¾…è·å–å¼‚æ­¥ç»“æœ</li><li>launch: å¯åŠ¨ä¸€ä¸ªæ–°åç¨‹ï¼Œæ–°åç¨‹å’Œå½“å‰åç¨‹å¹¶è¡Œè¿è¡Œã€‚ä½†æ˜¯å®ƒä¸ä¼šç­‰å¾…æ–°åç¨‹çš„å®Œæˆï¼Œç»§ç»­æ‰§è¡Œåç»­ä»£ç ã€‚è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªJobå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡æ¥æ§åˆ¶ã€å–æ¶ˆã€ç­‰å¾…è¯¥ååç¨‹çš„æ‰§è¡Œã€‚</li><li>withContext: ç”¨äºåœ¨æŒ‡å®šçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œåç¨‹ä»£ç å—ï¼Œå¹¶ç­‰å¾…ä»£ç å—æ‰§è¡Œå®Œæˆã€‚ä¸ launch ä¸åŒï¼ŒwithContext æŒ‚èµ·å½“å‰åç¨‹ã€‚å¸¸ç”¨äºåœ¨åç¨‹ä¸­åˆ‡æ¢åˆ°æŒ‡å®šçš„è°ƒåº¦å™¨ä¸Šæ‰§è¡Œä»£ç ã€‚</li><li>produce: åˆ›å»ºä¸€ä¸ªç”Ÿäº§è€…åç¨‹ï¼Œç”¨äºç”Ÿæˆåºåˆ—åŒ–çš„å€¼ã€‚ç”Ÿäº§è€…åç¨‹å¯ä»¥ä½¿ç”¨ send å‡½æ•°å°†å€¼å‘é€åˆ°ç®¡é“ä¸­ï¼Œå¹¶ä½¿ç”¨ receive å‡½æ•°ä»ç®¡é“ä¸­æ¥æ”¶å€¼ã€‚</li><li>actor: åˆ›å»ºä¸€ä¸ªå¸¦æœ‰çŠ¶æ€çš„åç¨‹ï¼Œç”¨äºæ‰§è¡Œå¹¶å‘æ“ä½œå¹¶ä¿æŒçŠ¶æ€ã€‚actor åç¨‹å¯ä»¥æ¥æ”¶å¹¶å¤„ç†å‘é€åˆ°å®ƒçš„æ¶ˆæ¯ï¼Œå…è®¸åœ¨åç¨‹ä¹‹é—´å…±äº«å’Œäº¤æ¢æ•°æ®ã€‚</li><li>supervisorScope: åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼Œå…¶ä¸­çš„å­åç¨‹çš„å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–å­åç¨‹ã€‚å½“ä¸€ä¸ªå­åç¨‹å¤±è´¥æ—¶ï¼ŒsupervisorScope ä¸­çš„å…¶ä»–å­åç¨‹ä»ç„¶å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</li><li>repeat: åˆ›å»ºä¸€ä¸ªåç¨‹ï¼Œé‡å¤æ‰§è¡ŒæŒ‡å®šçš„ä»£ç å—ï¼Œç±»ä¼¼äºå¾ªç¯ã€‚å¯ä»¥ä½¿ç”¨ delay å‡½æ•°æ¥æ§åˆ¶é‡å¤æ‰§è¡Œçš„é—´éš”ã€‚</li><li>select: ç”¨äºåœ¨å¤šä¸ªæŒ‚èµ·æ“ä½œä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼Œç±»ä¼¼äº select è¯­å¥ã€‚å¯ä»¥åœ¨ä¸€ä¸ª select ä»£ç å—ä¸­ç­‰å¾…å¤šä¸ªæŒ‚èµ·å‡½æ•°çš„ç»“æœï¼Œå½“å…¶ä¸­ä¸€ä¸ªæ“ä½œå‡†å¤‡å°±ç»ªæ—¶ï¼Œselect å°†æ‰§è¡Œç›¸åº”çš„ä»£ç å—ã€‚</li></ul><h2 id="åç¨‹æ€ä¹ˆåˆ›å»ºçš„"><a href="#åç¨‹æ€ä¹ˆåˆ›å»ºçš„" class="headerlink" title="åç¨‹æ€ä¹ˆåˆ›å»ºçš„"></a>åç¨‹æ€ä¹ˆåˆ›å»ºçš„</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val continuation = suspend &#123;</span><br><span class="line">    println(&quot;In Coroutine&quot;)</span><br><span class="line">    5</span><br><span class="line">&#125;.createCoroutine(object: Continuation&lt;Int&gt;) &#123;</span><br><span class="line">    override fun resumeWith(result: Result&lt;Int&gt;) &#123;</span><br><span class="line">        println(&quot;Coroutine End: $result&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹createCoroutineå£°æ˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun &lt;T&gt; (suspend () -&gt; T).createCoroutine(</span><br><span class="line">    completion:Continuation&lt;T&gt;</span><br><span class="line">): Continuation&lt;Unit&gt;</span><br></pre></td></tr></table></figure><ul><li>suspend () -&gt; Tæ˜¯è¢«suspendä¿®é¥°çš„æŒ‚èµ·å‡½æ•°ï¼Œå¯ä»¥ç§°ä½œæ˜¯åç¨‹ä½“ã€‚</li><li>completionæ˜¯åç¨‹å®Œæˆåçš„å›è°ƒ</li><li>è¿”å›å€¼æ˜¯ä¸€ä¸ªContinuationï¼Œç”¨äºè§¦å‘åç¨‹çš„å¯åŠ¨ï¼Œ<strong>å…¶å®å°±æ˜¯åŒ…äº†å‡ å±‚é©¬ç”²çš„åç¨‹ä½“</strong></li></ul><p>ä½œç”¨åŸŸ scopeï¼Œå¯ä»¥åœ¨åç¨‹ä½“ä¸­ç›´æ¥è°ƒç”¨ä½œç”¨åŸŸå¯¹è±¡çš„å‡½æ•°ã€‚æŒ‚èµ·å‡½æ•°åŠ äº†RestrictsSuspensionæ³¨è§£å°±ä¸èƒ½è°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">fun &lt;R, T&gt; (suspend R.() -&gt; T).createCoroutine(</span><br><span class="line">    receiver R,</span><br><span class="line">    completion: Continuation&lt;T&gt;</span><br><span class="line">): Continuation&lt;Unit&gt;</span><br><span class="line"></span><br><span class="line">// å°è£…ä¸€ä¸ªå¯åŠ¨åç¨‹çš„å‡½æ•°</span><br><span class="line">fun &lt;R, T&gt; launchCoroutine(receiver: R, block: suspend R.() -&gt; T) &#123;</span><br><span class="line">    block.startCoroutine(receiver, object : Continuation&lt;T&gt;) &#123;</span><br><span class="line">        override fun resumeWith(result: Result&lt;Int&gt;) &#123;</span><br><span class="line">        println(&quot;Coroutine End: $result&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯åŠ¨å¸¦æœ‰Receiverçš„åç¨‹</span><br><span class="line">class ProducerScope&lt;T&gt; &#123;</span><br><span class="line">    suspend fun produce(value: T) &#123; ... &#125;</span><br><span class="line">&#125;</span><br><span class="line">fun callLaunchCoroutine() &#123;</span><br><span class="line">    launchCoroutine(ProducerScope&lt;Init&gt;()) &#123;</span><br><span class="line">        produce(1024)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æŒ‚èµ·å‡½æ•°å°±æ˜¯æ™®é€šå‡½æ•°çš„å‚æ•°ä¸­å¤šäº†ä¸€ä¸ªContinuationå®ä¾‹ã€‚ä»»ä½•ä¸€ä¸ªæŒ‚èµ·å‡½æ•°æˆ–è€…åç¨‹ä½“éƒ½æœ‰ä¸€ä¸ªContinuationå®ä¾‹ï¼Œæ‰€ä»¥æŒ‚èµ·å‡½æ•°ä¸€å®šè¦è¿è¡Œåœ¨æŒ‚èµ·å‡½æ•°æˆ–è€…å…¶å®ƒåç¨‹ä½“ä¸­ã€‚</strong> </p><h2 id="åç¨‹scopeçš„æ¦‚å¿µ"><a href="#åç¨‹scopeçš„æ¦‚å¿µ" class="headerlink" title="åç¨‹scopeçš„æ¦‚å¿µ"></a>åç¨‹scopeçš„æ¦‚å¿µ</h2><p>CoroutineScopeï¼ŒCoroutineScopeå¯ä»¥ç†è§£ä¸ºåç¨‹çš„ä½œç”¨åŸŸï¼Œä¼šè·Ÿè¸ªå®ƒä½¿ç”¨ launch æˆ– async åˆ›å»ºçš„æ‰€æœ‰åç¨‹ã€‚æ‚¨å¯ä»¥éšæ—¶è°ƒç”¨ scope.cancel() ä»¥å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„å·¥ä½œï¼ˆå³æ­£åœ¨è¿è¡Œçš„åç¨‹ï¼‰ã€‚åœ¨ Android ä¸­ï¼ŒæŸäº› KTX åº“ä¸ºæŸäº›ç”Ÿå‘½å‘¨æœŸç±»æä¾›è‡ªå·±çš„ CoroutineScopeã€‚ä¾‹å¦‚ï¼ŒViewModel æœ‰ viewModelScopeï¼ŒLifecycle æœ‰ lifecycleScopeã€‚ä¸è¿‡ï¼Œä¸è°ƒåº¦ç¨‹åºä¸åŒï¼ŒCoroutineScope ä¸è¿è¡Œåç¨‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class ExampleClass &#123;</span><br><span class="line"></span><br><span class="line">    // Job and Dispatcher are combined into a CoroutineContext which</span><br><span class="line">    // will be discussed shortly</span><br><span class="line">    val scope = CoroutineScope(Job() + Dispatchers.Main)</span><br><span class="line"></span><br><span class="line">    fun exampleMethod() &#123;</span><br><span class="line">        // Starts a new coroutine within the scope</span><br><span class="line">        scope.launch &#123;</span><br><span class="line">            // New coroutine that can call suspend functions</span><br><span class="line">            fetchDocs()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun cleanUp() &#123;</span><br><span class="line">        // Cancel the scope to cancel ongoing coroutines work</span><br><span class="line">        scope.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨launch æˆ– async åˆ›å»ºçš„åç¨‹ä¼šè¿”å›ä¸€ä¸ªJobã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class ExampleClass &#123;</span><br><span class="line">    ...</span><br><span class="line">    fun exampleMethod() &#123;</span><br><span class="line">        // Handle to the coroutine, you can control its lifecycle</span><br><span class="line">        val job = scope.launch &#123;</span><br><span class="line">            // New coroutine</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (...) &#123;</span><br><span class="line">            // Cancel the coroutine started above, this doesn&#x27;t affect the scope</span><br><span class="line">            // this coroutine was launched in</span><br><span class="line">            job.cancel()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Jobæœ‰ä¸€ä¸ªå‡½æ•°å«<code>join()</code>ï¼Œå®ƒä¼šé˜»å¡å½“å‰åç¨‹ï¼Œç›´åˆ°ç›®æ ‡åç¨‹æ‰§è¡Œå®Œæˆä¸ºæ­¢ã€‚</p><h1 id="Androidä¸­çš„åç¨‹"><a href="#Androidä¸­çš„åç¨‹" class="headerlink" title="Androidä¸­çš„åç¨‹"></a>Androidä¸­çš„åç¨‹</h1><h2 id="å¸¸ç”¨å¯åŠ¨åç¨‹çš„æ–¹å¼"><a href="#å¸¸ç”¨å¯åŠ¨åç¨‹çš„æ–¹å¼" class="headerlink" title="å¸¸ç”¨å¯åŠ¨åç¨‹çš„æ–¹å¼"></a>å¸¸ç”¨å¯åŠ¨åç¨‹çš„æ–¹å¼</h2><ul><li>launch å¯åŠ¨æ–°åå’Œè€Œä¸å°†ç»“æœè¿”å›è°ƒç”¨æ–¹ã€‚</li><li>async å¯åŠ¨æ–°åç¨‹ï¼Œå¹¶å…è®¸ä½¿ç”¨ä¸€ä¸ªåä¸ºawaitçš„æŒ‚èµ·å‡½æ•°è¿”å›ç»“æœã€‚</li><li>withContext æŒ‚èµ·å½“å‰åç¨‹ï¼Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œä½œç”¨ç­‰ä»·äºasync{}.await()</li></ul><p>é€šå¸¸åº”è¯¥ç”¨launchï¼Œåªæœ‰å¦ä¸€ä¸ªåç¨‹å†…æ—¶ï¼Œæˆ–åœ¨æŒ‚èµ·å‡½æ•°å†…ä¸”æ­£åœ¨æ‰§è¡Œå¹¶è¡Œåˆ†è§£æ—¶ï¼Œæ‰ä½¿ç”¨ asyncã€‚åœ¨suspendå‡½æ•°å¯åŠ¨çš„æ‰€æœ‰åç¨‹ï¼Œéƒ½å¿…é¡»åœ¨å‡½æ•°è¿”å›ç»“æœå‰åœæ­¢ã€‚å¯ä»¥ä½¿ç”¨await()&#x2F;awaitAll()ä¿è¯åç¨‹åœ¨å‡½æ•°è¿”å›ç»“æœå‰å®Œæˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">suspend fun fetchTwoDocs() =</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        val deferredOne = async &#123; fetchDoc(1) &#125;</span><br><span class="line">        val deferredTwo = async &#123; fetchDoc(2) &#125;</span><br><span class="line">        deferredOne.await()</span><br><span class="line">        deferredTwo.await()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">suspend fun fetchTwoDocs() =        // called on any Dispatcher (any thread, possibly Main)</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        val deferreds = listOf(     // fetch two docs at the same time</span><br><span class="line">            async &#123; fetchDoc(1) &#125;,  // async returns a result for the first doc</span><br><span class="line">            async &#123; fetchDoc(2) &#125;   // async returns a result for the second doc</span><br><span class="line">        )</span><br><span class="line">        deferreds.awaitAll()        // use awaitAll to wait for both network requests</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="è°ƒåº¦å™¨"><a href="#è°ƒåº¦å™¨" class="headerlink" title="è°ƒåº¦å™¨"></a>è°ƒåº¦å™¨</h2><ol><li>Dispatchers.Default: ç”¨äºæ‰§è¡Œ CPU å¯†é›†å‹çš„è®¡ç®—ä»»åŠ¡ï¼Œæ¯”å¦‚å¯¹æ•°æ®è¿›è¡Œå¤„ç†ã€è½¬æ¢ç­‰ã€‚å®ƒä½¿ç”¨å…±äº«çš„çº¿ç¨‹æ± ï¼Œå¹¶ä¸”é€‚ç”¨äºä¸ä¼šé˜»å¡çº¿ç¨‹çš„æ“ä½œã€‚</li><li>Dispatchers.Main: ç”¨äºåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œæ¯”å¦‚æ›´æ–° UIã€å¤„ç†ç”¨æˆ·äº¤äº’ç­‰ã€‚åœ¨ Android ä¸­ï¼Œå®ƒä¸ä¸»çº¿ç¨‹å…³è”ï¼Œå› æ­¤é€‚ç”¨äº UI æ“ä½œã€‚</li><li>Dispatchers.Unconfined: ä¸å—é™åˆ¶çš„è°ƒåº¦å™¨ï¼Œå®ƒä¼šåœ¨åç¨‹æ¢å¤æ‰§è¡Œæ—¶ï¼Œç»§ç»­ä½¿ç”¨è°ƒç”¨è€…çº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æ¢å¤æ‰§è¡Œçš„ä»£ç å¼€å§‹æ‰§è¡ŒæŒ‚èµ·æ“ä½œï¼Œè°ƒåº¦å™¨ä¼šåˆ‡æ¢åˆ°å…¶ä»–çº¿ç¨‹ã€‚<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">button.setOnclickListener &#123;</span><br><span class="line">    GlobalScope.launch(Dispatchers.Main) &#123;</span><br><span class="line">        // ..</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å¦å¤–è¿˜æœ‰ä¸€ä¸ª<code>MainScop()</code>å‡½æ•°ï¼Œæ³¨æ„è¦åœ¨å…³é—­çš„æ—¶å€™è°ƒç”¨cancel<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//activity</span><br><span class="line">private val mainScope by lazy &#123; MainScop() &#125;</span><br><span class="line"></span><br><span class="line">button.setOnClickListener &#123;</span><br><span class="line">    mainScope.launch &#123;</span><br><span class="line">        // uiçº¿ç¨‹</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// onDestory æ³¨æ„è¦è°ƒç”¨cancel</span><br><span class="line">mainScope.cancel()</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol><ul><li>lifecycleScope.launch {}</li><li>viewModelScope.launch {}</li></ul><h2 id="å¸¸è§å‡½æ•°"><a href="#å¸¸è§å‡½æ•°" class="headerlink" title="å¸¸è§å‡½æ•°"></a>å¸¸è§å‡½æ•°</h2><ul><li>withTimeout(1000) : è¶…æ—¶å–æ¶ˆ</li></ul><h2 id="å®ç”¨æŠ€å·§"><a href="#å®ç”¨æŠ€å·§" class="headerlink" title="å®ç”¨æŠ€å·§"></a>å®ç”¨æŠ€å·§</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// </span><br><span class="line">suspend fun a() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">scope.launch(Dispatchers.IO) &#123; </span><br><span class="line">    //...</span><br><span class="line">    a()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šæ–¹çš„ä»£ç å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå› ä¸ºè¦æƒ³è°ƒç”¨a()ï¼Œæ¯æ¬¡å¿…é¡»æ˜¾å¼åœ¨å­çº¿ç¨‹ä¸­è°ƒç”¨ã€‚å¯ä»¥å°†aæ”¹è¿›ï¼Œä½¿ç”¨withContextå°è£…</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// è¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿açš„è°ƒç”¨è€…ä¸ç”¨å…³æ³¨åœ¨å“ªä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ</span><br><span class="line">supsend fun a() : Result &#123;</span><br><span class="line">    return withContext(Dispatchers.IO) &#123;</span><br><span class="line">        //...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹è¿›åï¼Œè¦æƒ³è°ƒç”¨aï¼Œå¿…é¡»ä½¿ç”¨åç¨‹ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿açš„è°ƒç”¨è€…ä¸ç”¨å…³æ³¨åœ¨å“ªä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p><h1 id="Channel-Flow"><a href="#Channel-Flow" class="headerlink" title="Channel &amp; Flow"></a>Channel &amp; Flow</h1><h2 id="Channel-ï¼ˆçƒ­æµï¼‰"><a href="#Channel-ï¼ˆçƒ­æµï¼‰" class="headerlink" title="Channel ï¼ˆçƒ­æµï¼‰"></a>Channel ï¼ˆçƒ­æµï¼‰</h2><p>Channelç›¸å½“äºç”Ÿäº§è€…æ¶ˆè´¹è€…ï¼Œ<strong>å…ˆç”Ÿäº§å†æ¶ˆè´¹</strong>ï¼Œåœ¨åç¨‹ä¸­é—´å»ºç«‹ä¸€ä¸ªç¼“å­˜åŒºã€‚produceå‡½æ•°å¯ä»¥æ„å»ºä¸€ä¸ªç”Ÿäº§è€…åç¨‹ï¼Œä¹Ÿå¯ä»¥åœ¨åç¨‹ä¸­åªåˆ›å»ºChannelã€‚æ¨èç”¨produce channelï¼Œä¸è¦ç”¨actor(obsolete)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// ç›¸å…³ä»£ç </span><br><span class="line">val channel = produce &#123;</span><br><span class="line">    //...</span><br><span class="line">    send(it)</span><br><span class="line">&#125;</span><br><span class="line">val channel = actor&lt;Int&gt; &#123;</span><br><span class="line">    //...</span><br><span class="line">    val element = receiver()</span><br><span class="line">&#125;</span><br><span class="line">channel.send()</span><br><span class="line">channel.receive()</span><br></pre></td></tr></table></figure><p>Channelçš„å†…éƒ¨å®ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public fun &lt;E&gt; Channel(capacity: Int = RENDEZVOUS): Channel&lt;E&gt; =</span><br><span class="line">  when (capcity) &#123;</span><br><span class="line">    // å®¹é‡ä¸º1ï¼Œsendåï¼Œä¸è°ƒç”¨receiverå°±ä¸€ç›´æŒ‚èµ·</span><br><span class="line">    RENDEZVOUS -&gt; RendezvousChannel()</span><br><span class="line">    // å®¹é‡æ— é™</span><br><span class="line">    UNLIMITED -&gt; LinkedListChannel()</span><br><span class="line">    // åªä¿ç•™æœ€åä¸€ä¸ª</span><br><span class="line">    CONFLATED -&gt; ConflatedChannel()</span><br><span class="line">    // æŒ‡å®šå¤§å°</span><br><span class="line">    else -&gt; ArrayChannel(capacity)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>Channelæ˜¯éœ€è¦å…³é—­çš„ï¼Œproduceæ–¹æ³•ä¼šåœ¨åç¨‹ç»“æŸåè‡ªå»å…³é—­å¯¹åº”çš„_channelï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¸€æ—¦è°ƒç”¨closeï¼Œå®ƒçš„isClosoedForSendæ–¹æ³•ä¼šç«‹å³è¿”å›trueï¼Œä½†æ˜¯å› ä¸ºé‡Œé¢è¿˜æœ‰å…ƒç´ ï¼ŒisClosedForReceiverè¦ç­‰å…¨å¤„ç†å®Œæ‰è¿”å›true</strong></p><p><strong>BroadcastChannel</strong> é¡¾åæ€ä¹‰ï¼Œå¹¿æ’­æ‰€ä»¥receiveréƒ½ä¼šæ”¶åˆ°ã€‚éœ€è¦æ³¨æ„ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªè®¢é˜…è€…ï¼Œä¸ç„¶æ•°æ®ä¼šè¢«ä¸¢å¼ƒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val broadcastChannel = BroadcastChannel&lt;Int&gt;(5)</span><br><span class="line">val receiverChannel = broadcastChannel.openSubscription()</span><br><span class="line">receiverChannle.receiver()</span><br><span class="line">receiverChannle.cancel()</span><br></pre></td></tr></table></figure><p>æ™®é€šChannelä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨<code>broadcast()</code>å‡½æ•°æ¥è½¬æ¢æˆbroadcast</p><h2 id="Flow-ï¼ˆå†·æµï¼‰"><a href="#Flow-ï¼ˆå†·æµï¼‰" class="headerlink" title="Flow ï¼ˆå†·æµï¼‰"></a>Flow ï¼ˆå†·æµï¼‰</h2><p>flow <strong>ä¸æ¶ˆè´¹ä¸ç”Ÿäº§</strong>ï¼Œä¸ä¼šç«‹å³æ‰§è¡Œflowçš„å†…å®¹ï¼Œä¼šåœ¨collectçš„æ—¶å€™ï¼Œæ‰å»æ‰§è¡Œã€‚æ¶ˆè´¹è€…åç¨‹cancel()åï¼Œflowä¼šè·Ÿç€ç»“æŸ(æ²¡æœ‰ç¼“å†²é˜Ÿåˆ—ï¼ŒåŒºåˆ«channel)</p><p>flowçš„æœ«ç«¯å‡½æ•°éƒ½æ˜¯suspendå‡½æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">val flow = flow &#123;</span><br><span class="line">    val data = &quot;DATA&quot;</span><br><span class="line">    emit(data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">launch &#123;</span><br><span class="line">    flow.collect &#123; data -&gt;</span><br><span class="line">        //...</span><br><span class="line">        cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸åŒçš„æ¶ˆè´¹è€…åç¨‹ä¸å…±äº«flowï¼Œå¦‚ä¸‹åˆ—ä»£ç ï¼Œflowä¸­çš„ä»£ç ä¼šè¢«å¤šæ¬¡æ‰§è¡Œã€‚(æ¯ä¸ªæ¶ˆè´¹è€…æ‹¥æœ‰ç‹¬ç«‹çš„ç”Ÿäº§è€…)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">repeat(2) &#123;ci -&gt;</span><br><span class="line">    launch &#123;</span><br><span class="line">        flow.collect &#123; data -&gt;</span><br><span class="line">            //...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>å¦‚æœåœ¨ä¸åŒçº¿ç¨‹æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨flow.flowOn(Dispatchers.Main)è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li>å¦‚æœè¦åœ¨Flowå®Œæˆæ—¶æ‰§è¡Œé€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨onCompletionï¼Œç›¸å½“äºtry catchçš„finally</li></ul><p>** èƒŒå‹é—®é¢˜ ** ç”Ÿäº§è€…ç”Ÿäº§å¤ªå¿«ï¼Œæ¶ˆè´¹è€…è·Ÿä¸ä¸Šã€‚è§£å†³ï¼š</p><ol><li>è°ƒç”¨flow.buffer() åŠ å…¥ç¼“å­˜</li><li>è°ƒç”¨flow.conflate() æ–°æ•°æ®æ›¿æ¢æ—§æ•°æ®</li><li>è°ƒç”¨ä½¿ç”¨flow.conllectLatest() å’Œ conllectçš„åŒºåˆ«æ˜¯ï¼Œå®ƒä¸ä¼šç›´æ¥ä½¿ç”¨æ–°æ•°æ®è¦†ç›–è€æ•°æ®ï¼Œä¼šä¾åºå¤„ç†ï¼Œä½†å¦‚æœå‰ä¸€ä¸ªæ²¡å¤„ç†å®Œçš„è¯ä¼šè¢«å–æ¶ˆã€‚</li></ol><h2 id="channelFlow"><a href="#channelFlow" class="headerlink" title="channelFlow"></a>channelFlow</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">channelFlowï¼Œä½¿flowå…·ä½“channelçš„ç‰¹æ€§</span><br><span class="line">val flow = channelFlow &#123;</span><br><span class="line">    withContext(Dispatcher.IO) &#123;</span><br><span class="line">        send(&quot;DATA&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="callbackFlow"><a href="#callbackFlow" class="headerlink" title="callbackFlow"></a>callbackFlow</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">val result = trySend(&quot;DATA&quot;)</span><br><span class="line">result.onSuccess &#123;</span><br><span class="line"></span><br><span class="line">&#125;.onFailure &#123;</span><br><span class="line"></span><br><span class="line">&#125;.onClosed &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">åç¨‹cancelåï¼Œä¼šè°ƒç”¨awaitClose</span><br><span class="line">awaitClose &#123;</span><br><span class="line">    //...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">launch &#123;</span><br><span class="line">    flow.collect &#123;</span><br><span class="line">        //...</span><br><span class="line">        cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†·æµ-çƒ­æµ"><a href="#å†·æµ-çƒ­æµ" class="headerlink" title="å†·æµ&amp;çƒ­æµ"></a>å†·æµ&amp;çƒ­æµ</h2><table><thead><tr><th>é¡¹ç›®</th><th>å†·æµ</th><th>çƒ­æµ</th></tr></thead><tbody><tr><td>ç”Ÿäº§æ—¶é—´æœº</td><td>ä¸€æ—¦åˆ›å»ºç«‹å³ç”Ÿäº§</td><td>éœ€è¦æ—¶ç”Ÿäº§</td></tr><tr><td>å¤šä¸ªæ¶ˆè´¹è€…</td><td>æ¶ˆè´¹è€…æŒ‰é¡ºåºè·å–</td><td>æ¯ä¸ªæ¶ˆè´¹è€…æœ‰ç‹¬ç«‹çš„ç”Ÿäº§çº¿è·¯</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ— å…³ç³»</td><td>ç”Ÿäº§è€…æ¶ˆè´¹è€…ç”Ÿå‘½å‘¨æœŸä¸€è‡´</td></tr></tbody></table><h2 id="SharedFlow-StateFlow-çƒ­æµ"><a href="#SharedFlow-StateFlow-çƒ­æµ" class="headerlink" title="SharedFlow &amp; StateFlow çƒ­æµ"></a>SharedFlow &amp; StateFlow çƒ­æµ</h2><p>flow.ShareIn()æ–¹æ³•ï¼Œä¼ é€’3ä¸ªå‚æ•°ï¼šscopeåç¨‹åŸŸ<br>flow.StateIn()</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flow &#123;...&#125;.stateIn(scope)</span><br><span class="line">//ç±»ä¼¼</span><br><span class="line">flow &#123;...&#125;.shareIn(scope,</span><br><span class="line">    stared = SharingStarted.Eagerly,</span><br><span class="line">    replay = 1</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>stateFlowè¦å’ŒrepeatOnLifecycleä¸€èµ·ä½¿ç”¨é˜²æ­¢çƒ­æµåœ¨viewçš„æ— æ•ˆç”Ÿå‘½å‘¨æœŸæ›´æ–°</p><h1 id="åç¨‹å¹¶å‘é—®é¢˜"><a href="#åç¨‹å¹¶å‘é—®é¢˜" class="headerlink" title="åç¨‹å¹¶å‘é—®é¢˜"></a>åç¨‹å¹¶å‘é—®é¢˜</h1><h2 id="Mutex"><a href="#Mutex" class="headerlink" title="Mutex"></a>Mutex</h2><p>å’Œçº¿ç¨‹é”ç±»ä¼¼ï¼Œä¸è¿‡ä¸ä¼šé˜»å¡çº¿ç¨‹ï¼Œåªæ˜¯æŒ‚èµ·ç­‰å¾…é”çš„é‡Šæ”¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var count = 0</span><br><span class="line">val mutex = mutex()</span><br><span class="line">List(1000) &#123;</span><br><span class="line">    GlobalScope.launch &#123;</span><br><span class="line">        mutext.withLock &#123;</span><br><span class="line">            count ++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.joinAll()</span><br></pre></td></tr></table></figure><h2 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a>Semaphore</h2><p>ä¿¡å·é‡ï¼Œä¿¡å·é‡å¯ä»¥æœ‰å¤šä¸ªï¼Œå½“å‚æ•°ä¸º1æ—¶ï¼Œæ•ˆæœç­‰ä»·äºMutex</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">val semaphore = Semaphore(1)</span><br><span class="line">List(1000) &#123;</span><br><span class="line">    GlobalScopre.launch &#123;</span><br><span class="line">        semaphore.withPermit &#123;</span><br><span class="line">            count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.joinAll()</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>è¦æ³¨æ„é¿å…è®¿é—®å¤–éƒ¨çŠ¶æ€ï¼Œåªèƒ½åŸºäºå‚æ•°åšè¿ç®—ï¼Œå†é€šè¿‡è¿”å›å€¼æä¾›ç»“æœã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">val count = 0</span><br><span class="line">val result = count + List(1000) &#123;</span><br><span class="line">    GlobalScope.async &#123;1&#125;</span><br><span class="line">&#125;.map &#123;</span><br><span class="line">    it.await()</span><br><span class="line">&#125;.sum()</span><br></pre></td></tr></table></figure><p> GlobalScope.async åˆ›å»ºäº†ä¸€ä¸ªç”± 1000 ä¸ªåç¨‹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸ªåç¨‹éƒ½ä¼šè¿”å›æ•´æ•°å€¼ 1ã€‚ç„¶åé€šè¿‡ map å‡½æ•°ç­‰å¾…æ‰€æœ‰åç¨‹çš„æ‰§è¡Œç»“æœï¼Œå¹¶å°†ç»“æœæ±‚å’Œã€‚æœ€ç»ˆçš„ç»“æœä¼šèµ‹å€¼ç»™å˜é‡ resultã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å¯¼è¯»&quot;&gt;&lt;a href=&quot;#å¯¼è¯»&quot; class=&quot;headerlink&quot; title=&quot;å¯¼è¯»&quot;&gt;&lt;/a&gt;å¯¼è¯»&lt;/h1&gt;&lt;p&gt;å› ä¸º2021å¹´å¼€å§‹åšC++ï¼Œä¹‹å‰çš„é¡¹ç›®è¿˜æ²¡æ¥å¾—åŠæ€ä¹ˆç”¨kotlinï¼Œå°±ç›´æ¥è¢«çˆ¸çˆ¸å®£å¸ƒæ­»åˆ‘äº†ã€‚æ‰€ä»¥ç›®å‰æ‰¾å·¥ä½œç­‰äºéœ€è¦å†å­¦ä¸€æ¬¡kotlinï¼Œç‰¹åˆ«æ˜¯åç¨‹ï¼Œä¹‹å‰å‡ ä¹æ²¡æœ‰äº†è§£ã€‚ä¹°äº†æœ¬ä¹¦ï¼Œå†åŠ ä¸Šç½‘ä¸Šçš„å„ç§æ–‡ç« ï¼Œæ•´ç†ä¸€ç‚¹ç¬”è®°å‡ºæ¥ã€‚å¦‚æœæœ‰å’Œæˆ‘å·®ä¸å¤šçš„ï¼Œå¯ä»¥çœ‹ä¸€çœ‹&lt;/p&gt;
&lt;p&gt;åç¨‹ï¼Œåç¨‹å¯ä»¥ç†è§£ä¸ºæŸç§è‡ªç”±è°ƒåº¦çš„ä»»åŠ¡ï¼Œä¸»è¦æ˜¯å¯¹å‡½æ•°æŒ‚èµ·ï¼Œæ¢å¤ã€‚å¬èµ·æ¥åƒçº¿ç¨‹çš„å”¤é†’ï¼Œæœ¬è´¨ä¸Šå’Œçº¿ç¨‹æ²¡ä»€ä¹ˆå…³ç³»ã€‚ä½¿ç”¨åç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥å•çº¿ç¨‹çš„æ–¹å¼å†™å¤šçº¿ç¨‹çš„ä»£ç ï¼ŒåŒæ—¶è¿˜èƒ½èŠ‚çœçº¿ç¨‹èµ„æºï¼Œå¹¶ä¸”èƒ½æ–¹ä¾¿å¤„ç†å¼‚å¸¸ä¿¡æ¯ï¼Œè¿”å›ç»“æœç­‰ã€‚æˆ‘ä»¬ç»™å‡½æ•°å‰é¢åŠ ä¸€ä¸ª&lt;code&gt;suspend&lt;/code&gt;å…³é”®å­—ï¼Œå°±å˜æˆä¸€ä¸ªæŒ‚èµ·å‡½æ•°ï¼Œå¯ä»¥åœ¨å‡½æ•°å†…æ“ä½œåç¨‹çš„æŒ‚èµ·å’Œæ¢å¤ã€‚å…¶ä¸­éƒ¨åˆ†å†…å®¹æœ‰é‡å¤ï¼Œä¸å¿…ç†ä¼šã€‚ä¸»è¦å‚è€ƒèµ„æ–™&amp;lt;æ·±å…¥ç†è§£Kotlinåç¨‹&amp;gt;ï¼Œç®—æ˜¯ä¸€ä¸ªç®€å•çš„ç¬”è®°æ•´ç†ã€‚&lt;/p&gt;
&lt;h1 id=&quot;åç¨‹çš„API&quot;&gt;&lt;a href=&quot;#åç¨‹çš„API&quot; class=&quot;headerlink&quot; title=&quot;åç¨‹çš„API&quot;&gt;&lt;/a&gt;åç¨‹çš„API&lt;/h1&gt;&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯æŒ‚èµ·&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯æŒ‚èµ·&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯æŒ‚èµ·&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯æŒ‚èµ·&lt;/h2&gt;</summary>
    
    
    
    <category term="kotlin" scheme="https://lefo.me/categories/kotlin/"/>
    
    
    <category term="é‡å­¦android" scheme="https://lefo.me/tags/%E9%87%8D%E5%AD%A6android/"/>
    
    <category term="kotlin" scheme="https://lefo.me/tags/kotlin/"/>
    
  </entry>
  
  <entry>
    <title>C++å­¦ä¹ ç¬”è®°</title>
    <link href="https://lefo.me/2021/08/13/cpp-note/"/>
    <id>https://lefo.me/2021/08/13/cpp-note/</id>
    <published>2021-08-13T05:28:05.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬2èŠ‚"><a href="#ç¬¬2èŠ‚" class="headerlink" title="ç¬¬2èŠ‚"></a>ç¬¬2èŠ‚</h1><p>é˜²å«å¼å£°æ˜ï¼Œé˜²æ­¢é‡å¤includeå¼•èµ·çš„é—®é¢˜(guard)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//complex.h</span><br><span class="line">#ifndef _COMPLEX_</span><br><span class="line">#def _COMPLEX_</span><br><span class="line">...</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><span id="more"></span><h1 id="ç¬¬3èŠ‚"><a href="#ç¬¬3èŠ‚" class="headerlink" title="ç¬¬3èŠ‚"></a>ç¬¬3èŠ‚</h1><p>inline å†…è”å‡½æ•°</p><p>æ„é€ å‡½æ•° </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public:</span><br><span class="line">    complex(double r = 0,double i = 0)</span><br><span class="line">        :re(r),im(i)</span><br><span class="line">        //ä¸Šé¢çš„é»˜è®¤å€¼æ˜¯æ¨èç”¨æ³•</span><br><span class="line">    &#123;&#125;</span><br><span class="line">...</span><br><span class="line">complex c1(2,1)</span><br><span class="line">complex c2</span><br><span class="line">complex* c3 = new complex(4)</span><br></pre></td></tr></table></figure><h1 id="ç¬¬4èŠ‚"><a href="#ç¬¬4èŠ‚" class="headerlink" title="ç¬¬4èŠ‚"></a>ç¬¬4èŠ‚</h1><p>æ•°æ®æ˜¯private</p><p>å‚æ•°ã€è¿”å›å€¼å°½å¯èƒ½æ‹¿å¼•ç”¨ä¼ é€’ï¼šé™¤äº†è¿”å›å€¼éœ€è¦æ–°åˆ›å»ºå¯¹è±¡çš„æƒ…å†µ</p><p>èƒ½åŠ constçš„å‡½æ•°å°½é‡åŠ const</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type function () const &#123; return result&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬6èŠ‚"><a href="#ç¬¬6èŠ‚" class="headerlink" title="ç¬¬6èŠ‚"></a>ç¬¬6èŠ‚</h1><p>æ“ä½œç¬¦é‡è½½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">complex::operator += (const complex&amp; r)&#123;</span><br><span class="line">return </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//ostreamä¸åŠ const </span><br><span class="line">ostream&amp; operator &lt;&lt; (ostream&amp; os, const complex&amp; x)</span><br><span class="line">&#123;</span><br><span class="line">return os &lt;&lt; &#x27;(&#x27; &lt;&lt; real(x) &lt;&lt; &#x27;,&#x27; &lt;&lt; imag(x) &lt;&lt; &#x27;)&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬7èŠ‚"><a href="#ç¬¬7èŠ‚" class="headerlink" title="ç¬¬7èŠ‚"></a>ç¬¬7èŠ‚</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class String</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">String(const char* cstr = 0);</span><br><span class="line">String(const String&amp; str);</span><br><span class="line">String&amp; operator =(const String&amp; str);</span><br><span class="line">~String()</span><br><span class="line">char* get_c_str() const &#123;return mdata&#125;;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">char* m_data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹·è´æ„é€ (æµ…æ‹·è´ä¼šå†…å­˜æº¢å‡º)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">inline String::String(const String&amp; str)</span><br><span class="line">&#123;</span><br><span class="line">m_data = new char[ strlen(str.m_data) + 1];</span><br><span class="line">strcpy(m_data,str.m_data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹·è´èµ‹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">inline String::operator = (const string&amp; str)</span><br><span class="line">&#123;</span><br><span class="line">//ä¸ä½¿ç”¨è¿™ä¸ªè‡ªæˆ‘èµ‹å€¼åˆ¤æ–­ï¼Œä¼šåˆ¹æ‰è‡ªå·±</span><br><span class="line">if(this == &amp;str)</span><br><span class="line">retrun *this</span><br><span class="line">  delete[] m_data;</span><br><span class="line">m_data = new char[ strlen(str.m_data) + 1];</span><br><span class="line">strcpy(m_data,str.m_data)</span><br><span class="line">return *this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬8èŠ‚"><a href="#ç¬¬8èŠ‚" class="headerlink" title="ç¬¬8èŠ‚"></a>ç¬¬8èŠ‚</h1><p>new :å…ˆåˆ†é…å†…å­˜ï¼Œå†è°ƒç”¨ctor</p><p>delete:å…ˆè°ƒç”¨ææ„å‡½æ•°ï¼Œå†é‡Šæ”¾å†…å­˜</p><p>array new è¦æ­é… array deleteä½¿ç”¨</p><h1 id="ç¬¬15-16-17-18èŠ‚"><a href="#ç¬¬15-16-17-18èŠ‚" class="headerlink" title="ç¬¬15 16 17 18èŠ‚"></a>ç¬¬15 16 17 18èŠ‚</h1><p>è½¬æ¢å‡½æ•° ï¼Œæ„é€ æ–¹æ³•ä¹Ÿå¯ä»¥å½“è½¬æ¢å‡½æ•°è½¬ï¼Œæ¯”å¦‚4è½¬ä¸º4&#x2F;1</p><p>explicit :åŠ åœ¨æ„é€ æ–¹æ³•å‰é¢ï¼Œè¡¨ç¤ºå¿…é¡»å¾—æ˜¾ç¤ºè°ƒç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class Fraction</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">  Fraction(int num,int den=1)</span><br><span class="line">   : m_numberator(m), m_denominato &#123;&#125;</span><br><span class="line">  operator double() const&#123;</span><br><span class="line">    return (double)(a/b)</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">Fraction f(3,5)</span><br><span class="line">double d=4+5</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fraction operator+(const Fraction&amp; f)&#123;</span><br><span class="line">return Fraction(...);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pointer like classes æ™ºèƒ½æŒ‡é’ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">template&lt;class T&gt;</span><br><span class="line">class shared_ptr</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">T&amp; operator*() const</span><br><span class="line">&#123; return *px; &#125;</span><br><span class="line">T* operator-&gt;() const</span><br><span class="line">&#123; return px; &#125;</span><br><span class="line"></span><br><span class="line">shared_ptr(T* P) :px(p)&#123;&#125;</span><br><span class="line">private:</span><br><span class="line">T* px;</span><br><span class="line">long* pn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Function-like classes</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">template &lt;class T&gt;</span><br><span class="line">struct identity&#123;</span><br><span class="line">const T&amp;</span><br><span class="line">operator()(const T&amp; x) const &#123;return x;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬19-25èŠ‚"><a href="#ç¬¬19-25èŠ‚" class="headerlink" title="ç¬¬19 - 25èŠ‚"></a>ç¬¬19 - 25èŠ‚</h1><p>namespace  å¯ä»¥ä»£ç æ”¾ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œï¼Œç„¶åç”¨namespaceåˆ†å‰²</p><p>ç±»æ¨¡æ¿ã€å‡½æ•°æ¨¡æ¿ã€æˆå‘˜æ¨¡æ¿ï¼Œå‡½æ•°æ¨¡æ¿ä½¿ç”¨æ—¶æ— éœ€æŒ‡å®šç±»å‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">template &lt;class T1,class T2&gt;</span><br><span class="line">struct pair&#123;</span><br><span class="line">T1 first;</span><br><span class="line">T2 second;</span><br><span class="line">pair():first(T1()),second(T2);</span><br><span class="line">pair(const T1&amp; a,const T2&amp; b):</span><br><span class="line">   first(a),second(b)&#123;&#125;</span><br><span class="line"></span><br><span class="line">template &lt;class U1,class U2&gt;</span><br><span class="line">pair(const pair&lt;U1,U2&gt;&amp; p):</span><br><span class="line">   first(p.first),second(p.second)&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿ç‰¹åŒ–ï¼Œå¯ä»¥ç†è§£ä¸ºé™å®šç±»çš„æ¨¡æ¿ç‰¹æ®Šè®¾è®¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">template &lt;&gt;</span><br><span class="line">struct hash&lt;char&gt;&#123;</span><br><span class="line">size_t operator()(char x) const&#123;</span><br><span class="line">return x;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿æ¨¡æ¿å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">template&lt;typename T,</span><br><span class="line">          template &lt;typename T&gt;&gt;</span><br><span class="line">              class Container</span><br><span class="line">              &gt;</span><br><span class="line">class XCLs&#123;</span><br><span class="line">private:</span><br><span class="line">     Container&lt;T&gt;c;</span><br><span class="line">public:</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;typename T&gt;</span><br><span class="line">using Lst = list&lt;T, allocator&lt;T&gt;&gt;;</span><br><span class="line"></span><br><span class="line">//XCLs&lt;string, list&gt; mylst1; é”™çš„</span><br><span class="line">XCLs&lt;string,Lst&gt; mylst2;</span><br></pre></td></tr></table></figure><p>æ¨¡æ¿åç‰¹åŒ–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">template&lt;class T,class Alloc=...&gt;</span><br><span class="line">class vector&lt;bool,Alloc&gt;&#123;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template &lt;typename T&gt;</span><br><span class="line">//æŒ‡é’ˆ</span><br><span class="line">class C&lt;T*&gt;&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬27èŠ‚"><a href="#ç¬¬27èŠ‚" class="headerlink" title="ç¬¬27èŠ‚"></a>ç¬¬27èŠ‚</h1><p>auto å…³é”®å­— å¿…é¡»å¾—è®©ç¼–è¯‘å™¨èƒ½æ¨å‡ºä½ çš„å˜é‡æ˜¯ä»€ä¹ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">list&lt;string&gt; c;</span><br><span class="line">...</span><br><span class="line">list&lt;string&gt;::iterator ite;</span><br><span class="line">ite = find(c.begin(),c.end,target);</span><br><span class="line">auto ite = find(c.begin(),c.end,target);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for (auto eleme : vec)&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for (auto&amp; eleme : vec)&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç¬¬28èŠ‚"><a href="#ç¬¬28èŠ‚" class="headerlink" title="ç¬¬28èŠ‚"></a>ç¬¬28èŠ‚</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int x = 0;</span><br><span class="line">int* p = &amp;x;</span><br><span class="line">int&amp; r = x;//rä»£è¡¨x ç°åœ¨r, x éƒ½æ˜¯0</span><br><span class="line">int x2 = 5;</span><br><span class="line">//ç­‰äºæŠŠ5èµ‹å€¼ç»™x</span><br><span class="line">r = x2;//r ä¸èƒ½é‡æ–°ä»£è¡¨å…¶å®ƒç‰©ä½“ï¼Œç°åœ¨r xéƒ½æ˜¯5</span><br><span class="line">int&amp; r2 = r;//r2 x éƒ½æ˜¯5</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">double image(const double&amp; im)&#123;...&#125;</span><br><span class="line">double image(const double im)&#123;...&#125;</span><br><span class="line">//ä¸èƒ½å…±å­˜ Ambiguity</span><br></pre></td></tr></table></figure><p>constå±äºç­¾åçš„ä¸€éƒ¨åˆ†ï¼Œæœ‰constå’Œæ²¡æœ‰constå¯ä»¥å¹¶å­˜</p><h1 id="ç¬¬30-31èŠ‚"><a href="#ç¬¬30-31èŠ‚" class="headerlink" title="ç¬¬30-31èŠ‚"></a>ç¬¬30-31èŠ‚</h1><p>vptrå’Œvtbl</p><p>å…ˆé€šè¿‡æŒ‡é’ˆ æ‰¾åˆ°å‡½æ•°è¡¨å†æ‰¾åˆ°ç¬¬nä¸ª å†è°ƒç”¨</p><p>(*(p-&gt;vptr)[n])(p);</p><p>(* p-&gt;vptr[n] )(p);</p><p>ç¼–è¯‘å™¨ä¸‰ä¸ªæ¡ä»¶å°±ä¼šåŠ¨æ€ç»‘å®š</p><p>1.æŒ‡é’ˆè°ƒç”¨ 2.å‘ä¸Šè½¬å‹ 3.è™šå‡½æ•°</p><p>(*(this -&gt; vptr)[n])(this);</p><h1 id="ç¬¬33-38èŠ‚"><a href="#ç¬¬33-38èŠ‚" class="headerlink" title="ç¬¬33-38èŠ‚"></a>ç¬¬33-38èŠ‚</h1><p>å½“æˆå‘˜å‡½æ•°çš„constå’Œ non-constç‰ˆæœ¬åŒæ—¶å­˜åœ¨ï¼Œconst objectåªä¼šè°ƒç”¨constç‰ˆæœ¬ï¼Œnon-const objectåªä¼šè°ƒç”¨non-constç‰ˆæœ¬</p><p>new å’Œ deleteå¯ä»¥é‡è½½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">inline void* operator new(size_t size)</span><br><span class="line">&#123; return myAlloc(size);&#125;</span><br><span class="line">inline void operator delete(void* ptr)</span><br><span class="line">&#123; myfree(ptr);&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¯¹æˆå‘˜çš„new &#x2F;delete åšé‡è½½ï¼Œå†™åˆ°ç±»é‡Œ</p><p>å¦‚æœæƒ³ä½¿ç”¨globals</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Foo* pf = ::new Foo;</span><br><span class="line">::delete pf</span><br><span class="line">//å°†ä½¿ç”¨å…¨å±€çš„new å’Œdelete</span><br></pre></td></tr></table></figure><p>æ•°ç»„åœ¨å†…å­˜ä¸­çš„sizeæ˜¯countsize + unit * count </p><p>æˆ‘ä»¬å¯ä»¥é‡è½½class member operator new()ï¼Œå†™å¤šä¸ªç‰ˆæœ¬ï¼Œæ¯ä¸ªå£°æ˜å¿…é¡»æœ‰ç‹¬ç‰¹çš„å‚æ•°åˆ—ï¼Œä¸”ç¬¬ä¸€ä¸ªå¿…é¡»æ˜¯size_tï¼Œå…¶ä½™å‚æ•°æ˜¯newæŒ‡å®šçš„placement argumentsä¸ºåˆå€¼ã€‚å°æ‹¬å·å†…çš„ä¾¿æ˜¯placement arguments</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Foo* pf = new(300,&#x27;c&#x27;) Foo;</span><br></pre></td></tr></table></figure><p>å¯ä»¥é‡è½½class member operator delete()ï¼Œå†™å‡ºå¤šä¸ªç‰ˆæœ¬ï¼Œè°ƒä¸åˆ°ï¼Œå¤§å¸ˆè¯´è€ç‰ˆæœ¬çš„èƒ½è°ƒåˆ°ï¼Œåœ¨newå¼‚å¸¸çš„æ—¶å€™</p><p>operator new()åœ¨æ ‡å‡†åº“çš„ç”¨å¤„ï¼Œå¤šåˆ†é…ä¸€äº›å†…å­˜</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;ç¬¬2èŠ‚&quot;&gt;&lt;a href=&quot;#ç¬¬2èŠ‚&quot; class=&quot;headerlink&quot; title=&quot;ç¬¬2èŠ‚&quot;&gt;&lt;/a&gt;ç¬¬2èŠ‚&lt;/h1&gt;&lt;p&gt;é˜²å«å¼å£°æ˜ï¼Œé˜²æ­¢é‡å¤includeå¼•èµ·çš„é—®é¢˜(guard)&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//complex.h&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifndef _COMPLEX_&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#def _COMPLEX_&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="c++" scheme="https://lefo.me/categories/c/"/>
    
    
    <category term="c++" scheme="https://lefo.me/tags/c/"/>
    
  </entry>
  
  <entry>
    <title>è®°ä¸€æ¬¡ç¼–è¯‘å®‰å“æ¨¡æ‹Ÿå™¨é•œåƒ</title>
    <link href="https://lefo.me/2021/08/11/make-image/"/>
    <id>https://lefo.me/2021/08/11/make-image/</id>
    <published>2021-08-11T13:49:03.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>æƒ³è¦ç¼–è¯‘ä¸€ä¸ªè‡ªå·±çš„frameworkï¼Œç”¨æ¥åœ¨ç³»ç»Ÿapiä¸­æ’å…¥è‡ªå·±çš„ä»£ç ï¼Œç›‘å¬ä¸€ä¸‹åº”ç”¨çš„è¡Œä¸ºï¼Œæ¯”å¦‚è·å–imeiï¼Œè·å–ç½‘ç»œã€‚æœ€ç›´æ¥çš„æƒ³æ³•å°±æ˜¯ï¼Œä¿®æ”¹å®‰å“æºç ï¼Œç›´æ¥ç¼–è¯‘å‡ºä¸€ä¸ªç³»ç»Ÿé•œåƒï¼Œç»™æ¨¡æ‹Ÿå™¨ä½¿ç”¨ã€‚</p><p>å‡†å¤‡ï¼š</p><ol><li><p>å› ä¸ºä¹‹å‰ç¼–è¯‘è¿‡android.jarï¼Œæ‰€ä»¥æºç ç¯å¢ƒè¿˜æœ‰ï¼Œç›´æ¥å¼€å·¥ï¼Œæˆ–è€…çœ‹ä»¥å‰ç¼–è¯‘çš„æ–‡ç« æœ‰è®²ã€‚</p></li><li><p>ä¿®æ”¹ä»£ç ï¼Œæ¯”å¦‚æ‰¾åˆ°TelephonyManager.javaï¼Œåœ¨getDeviceId()ä¸­æ’å…¥è‡ªå·±çš„ä»£ç ã€‚</p></li></ol><span id="more"></span><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source ./build/envsetup.sh</span><br><span class="line">lunch sdk_phone_x86-userdebug</span><br><span class="line">make update-api</span><br><span class="line">make -j16 sdk sdk_repo</span><br></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼šä¸‹é¢çš„éƒ¨åˆ†æ˜¯å®˜æ–¹å†™çš„ï¼Œå¦‚ä½•ç¼–è¯‘ä¸€ä¸ªsdkç»™åˆ«äººä¹Ÿèƒ½ç”¨ã€‚ä½†æˆ‘æ²¡æœ‰æˆåŠŸï¼Œmake sdk_repoçš„æ—¶å€™ï¼Œå¤±è´¥äº†</em></p><p>åœ¨<code>host/linux-x86/sdk/sdk_phone_x86</code>ä¸‹æ‰¾åˆ°ä¸¤ä¸ªæ–‡ä»¶</p><ul><li><code>sdk-repo-linux-system-images-eng.[username].zip</code></li><li><code>repo-sys-img.xml</code></li></ul><p>å°†è¿™ä¸¤ä¸ªæ–‡ä»¶æ”¾åˆ°ä½ æœåŠ¡å™¨å¯è®¿é—®çš„ä½ç½®ï¼Œè®°ä¸‹urlã€‚å†å°†xmlä¸­çš„<code>&lt;sdk:url&gt;</code>æ›¿æ¢æˆzipçš„urlã€‚</p><p>åœ¨SDK Managerä¸­ï¼Œç‚¹å‡»  <strong>SDK Update Sites</strong>   æ·»åŠ ä½ çš„xmlçš„urlã€‚</p><p><em>æˆ‘çš„æ“ä½œï¼šç›´æ¥å°†zipä¸‹è½½ä¸‹æ¥è§£å‹ï¼Œæ›¿æ¢åŸæ¥sdkå¯¹åº”çš„system-imageï¼Œå¦‚<code>/sdk/system-images/android-23/default/x86</code></em></p><h2 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h2><p>å¦‚æœæ²¡æœ‰ä¿®æ”¹ä»£ç ï¼Œæ˜¯ä¸éœ€è¦make update-apiçš„ï¼Œä½†æ˜¯æœ‰ä»£ç ä¿®æ”¹åï¼Œmakeè¿‡ç¨‹ä¸­ï¼Œä¼šæç¤ºä½ ä½¿ç”¨make update-apiã€‚æˆ‘åœ¨make sdkçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æç¤ºè¦make update-support-api(ä¸å¤§è®°å¾—æ˜¯update-support-apiè¿˜æ˜¯support-update-api)ï¼Œæœ‰éœ€è¦ç³»ç»Ÿä¼šæç¤ºçš„ï¼Œæ ¹æ®ç³»ç»Ÿæç¤ºæ“ä½œã€‚</p><h1 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h1><ol><li>ç¼ºå°‘kernel-ranchuï¼Œå¤åˆ¶ä¸€ä¸ªè§£å†³</li><li>å¼€æœºé»‘å±ï¼ŒAVD Managerä¸‹ï¼Œç‚¹å‡»ç¼–è¾‘ï¼ŒEmulated Performance - Graphics:æ”¹ä¸ºSoftWareï¼ˆå°šä¸æ¸…æ¥šå…¶å®ƒè§£å†³æ–¹æ¡ˆï¼‰ã€‚å…³äºè¿™ä¸ªé»‘å±ï¼Œå°è¯•å¥½å¤šæ¬¡ï¼Œå¯åŠ¨åä¹Ÿæœ‰æ—¥å¿—æç¤º<code>EGL_emulation: tid 1232: eglCreateImageKHR(1206): error 0x300c E/GLConsumer: error creating EGLImage: 0x300c</code>ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºæ˜¯é•œåƒçš„é—®é¢˜ï¼Œè¯•äº†å‡ ä¸ªç‰ˆæœ¬ï¼Œä¸€ç›´ä¸è¡Œï¼Œæœ€åå‡ ç»æœç´¢æ‰æ‰¾åˆ°æ”¹Graphicsçš„æ–¹æ¡ˆï¼Œå¾ˆæ˜¯éƒé—·ã€‚</li></ol><h1 id="è®°å½•"><a href="#è®°å½•" class="headerlink" title="è®°å½•"></a>è®°å½•</h1><ol><li><p>error: ro.build.fingerprint cannot exceed 91 bytes:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error: ro.build.fingerprint cannot exceed 91 bytes:</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘<code>build/tools/post_process_props.py</code>ã€‚æ›´æ”¹è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PROP_NAME_MAX = 31</span><br><span class="line"># PROP_VALUE_MAX = 91</span><br><span class="line">PROP_VALUE_MAX = 128</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘<code>bionic/libc/include/sys/system_properties.h</code>ã€‚æ›´æ”¹è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#define PROP_NAME_MAX   32</span><br><span class="line">// #define PROP_VALUE_MAX  92</span><br><span class="line">#define PROP_VALUE_MAX  128</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make clobber</span><br><span class="line">make sdk sdk_repo</span><br></pre></td></tr></table></figure></li><li><p>jackæœåŠ¡é”™è¯¯ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨6.0çš„æºç ä¸Šç¼–è¯‘ï¼Œè¿˜æ˜¯ä½¿ç”¨çš„jackï¼ŒæŠ¥äº†ä¸¤æ¬¡æœåŠ¡æ²¡å¯åŠ¨åï¼Œæˆ‘å°±ç›´æ¥å…³äº†ï¼Œä¿®æ”¹ä¸ºä¸‹é¢çš„SERVER&#x3D;false</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.jack</span><br><span class="line"></span><br><span class="line"># Server settings</span><br><span class="line">SERVER=false</span><br><span class="line">SERVER_PORT_SERVICE=8072</span><br><span class="line">SERVER_PORT_ADMIN=8073</span><br><span class="line">SERVER_COUNT=1</span><br><span class="line">SERVER_NB_COMPILE=4</span><br><span class="line">SERVER_TIMEOUT=60</span><br><span class="line">SERVER_LOG=$&#123;SERVER_LOG:=$SERVER_DIR/jack-$SERVER_PORT_SERVICE.log&#125;</span><br><span class="line">JACK_VM_COMMAND=$&#123;JACK_VM_COMMAND:=java&#125;</span><br><span class="line"># Internal, do not touch</span><br><span class="line">SETTING_VERSION=2</span><br></pre></td></tr></table></figure></li><li><p>make sdk_repoé”™è¯¯ï¼Œç”Ÿæˆçš„xmlä¸­å€¼æ ¡éªŒä¸é€šè¿‡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Building SDK repository package system-images from android-sdk_eng.root_linux-x86.zip</span><br><span class="line">## Using xmlns:sdk=http://schemas.android.com/sdk/android/addon/2</span><br><span class="line">## Using root element sdk-addon</span><br><span class="line">## Add support/linux archive out/host/linux-x86/sdk/sdk_phone_x86//sdk-repo-linux-support-eng.root.zip</span><br><span class="line">## Validate XML against schema</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;sdk:sdk-addon xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:sdk=&quot;http://schemas.android.com/sdk/android/addon/2&quot;&gt;</span><br><span class="line">    &lt;sdk:extra&gt;</span><br><span class="line">        &lt;sdk:revision&gt;23.0.1&lt;/sdk:revision&gt;</span><br><span class="line">        &lt;sdk:vendor&gt;android&lt;/sdk:vendor&gt;</span><br><span class="line">        &lt;sdk:path&gt;support&lt;/sdk:path&gt;</span><br><span class="line">        &lt;sdk:archives&gt;</span><br><span class="line">            &lt;sdk:archive os=&quot;linux&quot;&gt;</span><br><span class="line">                &lt;sdk:size&gt;5504615&lt;/sdk:size&gt;</span><br><span class="line">                &lt;sdk:checksum type=&quot;sha1&quot;&gt;d7d984cfe9288f2cd32bb1601a138de32724faa2&lt;/sdk:checksum&gt;</span><br><span class="line">                &lt;sdk:url&gt;sdk-repo-linux-support-eng.root.zip&lt;/sdk:url&gt;</span><br><span class="line">            &lt;/sdk:archive&gt;</span><br><span class="line">        &lt;/sdk:archives&gt;</span><br><span class="line">    &lt;/sdk:extra&gt;</span><br><span class="line">&lt;/sdk:sdk-addon&gt;</span><br><span class="line">out/host/linux-x86/sdk/sdk_phone_x86/repo-extras.xml:6: element revision: Schemas validity error : Element &#x27;&#123;http://schemas.android.com/sdk/android/addon/2&#125;revision&#x27;: &#x27;23.0.1&#x27; is not a valid value of the atomic type &#x27;xs:positiveInteger&#x27;.</span><br><span class="line">out/host/linux-x86/sdk/sdk_phone_x86/repo-extras.xml fails to validate</span><br><span class="line">make: *** [out/host/linux-x86/sdk/sdk_phone_x86/repo-extras.xml] é”™è¯¯ 3</span><br><span class="line">make: *** æ­£åœ¨åˆ é™¤æ–‡ä»¶â€œout/host/linux-x86/sdk/sdk_phone_x86/repo-extras.xmlâ€</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯xmlä¸­revisionä¸æ˜¯æ•´æ•°çš„é—®é¢˜ã€‚è¿™ä¸ªæˆ‘å°±å¾ˆéƒé—·ï¼Œæ˜æ˜xmlæ˜¯è‡ªå·±ç”Ÿæˆçš„ï¼Œååæ ¡éªŒä¸é€šè¿‡ï¼Œmakeæ–‡ä»¶åœ¨<code>development/build/tools/mk_sdk_repo_xml.sh</code>é‡Œï¼Œxsdçš„æ–‡ä»¶åœ¨<code>prebuilts/devtools/repository</code>æ‰¾åˆ°äº†ï¼Œåç»­æˆ‘ä¹Ÿæ²¡æ”¹ï¼Œç›´æ¥æŠŠzipæ‹¿æ¥ç”¨äº†ã€‚æœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±è¯•è¯•ã€‚</p></li></ol>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h1&gt;&lt;p&gt;æƒ³è¦ç¼–è¯‘ä¸€ä¸ªè‡ªå·±çš„frameworkï¼Œç”¨æ¥åœ¨ç³»ç»Ÿapiä¸­æ’å…¥è‡ªå·±çš„ä»£ç ï¼Œç›‘å¬ä¸€ä¸‹åº”ç”¨çš„è¡Œä¸ºï¼Œæ¯”å¦‚è·å–imeiï¼Œè·å–ç½‘ç»œã€‚æœ€ç›´æ¥çš„æƒ³æ³•å°±æ˜¯ï¼Œä¿®æ”¹å®‰å“æºç ï¼Œç›´æ¥ç¼–è¯‘å‡ºä¸€ä¸ªç³»ç»Ÿé•œåƒï¼Œç»™æ¨¡æ‹Ÿå™¨ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;å‡†å¤‡ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;å› ä¸ºä¹‹å‰ç¼–è¯‘è¿‡android.jarï¼Œæ‰€ä»¥æºç ç¯å¢ƒè¿˜æœ‰ï¼Œç›´æ¥å¼€å·¥ï¼Œæˆ–è€…çœ‹ä»¥å‰ç¼–è¯‘çš„æ–‡ç« æœ‰è®²ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ä¿®æ”¹ä»£ç ï¼Œæ¯”å¦‚æ‰¾åˆ°TelephonyManager.javaï¼Œåœ¨getDeviceId()ä¸­æ’å…¥è‡ªå·±çš„ä»£ç ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨jenkinsä¸ºandroidå·¥ç¨‹æ‰“åŒ…ï¼Œæ”¯æŒå¤šåŒ…åï¼Œæ”¹èµ„æºï¼ˆä¼˜åŒ–æ–¹æ¡ˆï¼‰</title>
    <link href="https://lefo.me/2020/09/04/jenkins-android-3/"/>
    <id>https://lefo.me/2020/09/04/jenkins-android-3/</id>
    <published>2020-09-04T07:32:15.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h1><p>æ²¡æœ‰éœ€æ±‚ï¼Œè‡ªå·±çœ‹äº†ä¸€çœ¼è‡ªå·±ä¹‹å‰å†™çš„æ‰“åŒ…è„šæœ¬ï¼Œç®€ç›´æ— æ³•çœ‹ä¸‹å»ã€‚è€Œä¸”ï¼Œäº§å“ç»ç†çš„å®šåˆ¶åŒ–éœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œç”¨shellè„šæœ¬çš„å¯è¯»æ€§ä¹Ÿè¶Šæ¥è¶Šå·®ï¼Œå†åŠ ä¸Šé‡Œé¢ä¸€å †çš„sedå‘½ä»¤ï¼Œæƒ¨ä¸å¿ç¹ã€‚</p><p>æ”¹!!!</p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>gradleå…¶å®æ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼Œå…³äºè‡ªå®šä¹‰å‚æ•°çš„ä»‹ç»ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://docs.gradle.org/current/userguide/build_environment.html%EF%BC%8C%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%80%E4%B8%8B%E7%94%A8%E5%88%B0%E7%9A%84%EF%BC%9A[Gradle">https://docs.gradle.org/current/userguide/build_environment.htmlï¼Œç®€å•è¯´ä¸€ä¸‹ç”¨åˆ°çš„ï¼š[Gradle</a> properties](<a href="https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_configuration_properties)%EF%BC%9A">https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_configuration_properties)ï¼š</a></p><span id="more"></span><p>æœ‰ä¸¤ç§æ–¹å¼ä¼ ç»™gradleï¼Œä¸€ç§æ˜¯-Pã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradlew clean -Pname=zhangsan</span><br></pre></td></tr></table></figure><p>å¦ä¸€ç§æ˜¯gradle.propertiesï¼Œæˆ‘ä»¬å¯ä»¥åœ¨build.gradleæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªgradle.propertiesæ–‡ä»¶ï¼Œå†™ä¸Š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=zhangsan</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ä¸¤ç§æ–¹å¼ï¼Œåœ¨gradleè„šæœ¬ä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå˜é‡åã€‚</p><p>æ¯”å¦‚å¦‚ä¸‹çš„gradleé…ç½®ï¼Œå…¶ä¸­åŒ…å«äº†intå‹ï¼ŒStringå‹ï¼Œbooleanå‹ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³éœ€æ±‚äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">buildConfigField &quot;boolean&quot;, &quot;SHOW_INFO&quot;, &quot;$SHOW_INFO&quot;</span><br><span class="line">applicationId &quot;$PACKAGE_NAME&quot;</span><br><span class="line"></span><br><span class="line">versionCode Integer.valueOf(VERSION_CODE)</span><br><span class="line">versionName VERSION_NAME</span><br><span class="line"></span><br><span class="line">buildConfigField &quot;String&quot;, &quot;QQ_ID&quot;, &quot;\&quot;$qq_id\&quot;&quot;</span><br><span class="line">buildConfigField &quot;String&quot;, &quot;WX_RELEASE_ID&quot;, &quot;\&quot;$wx_id\&quot;&quot;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„gradle.propertiesæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">VERSION_NAME=1.2</span><br><span class="line">VERSION_CODE=1110</span><br><span class="line">PACKAGE_NAME=me.lefo.jenkins</span><br><span class="line">SHOW_INFO=true</span><br><span class="line">qq_id=1001</span><br><span class="line">wx_id=1002</span><br></pre></td></tr></table></figure><h1 id="ç»“åˆjenkinsçš„å‚æ•°åŒ–æ„å»º"><a href="#ç»“åˆjenkinsçš„å‚æ•°åŒ–æ„å»º" class="headerlink" title="ç»“åˆjenkinsçš„å‚æ•°åŒ–æ„å»º"></a>ç»“åˆjenkinsçš„å‚æ•°åŒ–æ„å»º</h1><p>é€šå¸¸ç”¨jenkinsåœ¨æ„å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šè‡ªå®šä¹‰ä¸€äº›å‚æ•°ï¼Œæ¯”å¦‚ä¸Šæ–‡çš„VERSION_NAMEï¼ŒVERSION_CODEã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸ªå¥‡è‘©çš„éœ€æ±‚ï¼Œæ”¹åŒ…åã€‚</p><p>jenkinsåœ¨æ­å»ºçš„æ—¶å€™ï¼Œæ„å»ºé‚£ä¸€æ­¥ä¸€å®šè¦é€‰<code>invoke gradle script</code>ï¼Œç‚¹å¼€ä¸‹é¢çš„é«˜çº§é€‰é¡¹ï¼Œå‹¾é€‰<code>Pass all job parameters as Project properties</code>ï¼Œå‹¾é€‰è¿™ä¸€é¡¹ä¼šå°†jenkinså‚æ•°åŒ–æ„å»ºæ—¶çš„å‚æ•°å†™åˆ°gradleä¸­ï¼Œè¿˜ä¼šæ›¿æ¢æ‰gradle.propertiesä¸­çš„é»˜è®¤å€¼ã€‚å…¶å®å°±æ˜¯é€šè¿‡-PæŠŠå‚æ•°ä¼ åˆ°äº†gradleï¼Œ-Pä¼ å…¥çš„ä¼˜å…ˆçº§é«˜äºpropertiesæ–‡ä»¶ã€‚</p><p><strong>ä¸€å®šè¦ä¿è¯å‚æ•°åå’Œgradle.propertiesæ–‡ä»¶ä¸­çš„åå­—ä¸€æ ·ï¼ï¼ï¼</strong></p><p><strong>ä¸€å®šè¦ä¿è¯å‚æ•°åå’Œgradle.propertiesæ–‡ä»¶ä¸­çš„åå­—ä¸€æ ·ï¼ï¼ï¼</strong></p><p><strong>ä¸€å®šè¦ä¿è¯å‚æ•°åå’Œgradle.propertiesæ–‡ä»¶ä¸­çš„åå­—ä¸€æ ·ï¼ï¼ï¼</strong></p><h1 id="å’ŒåŒ…åç»‘å®šçš„é…ç½®"><a href="#å’ŒåŒ…åç»‘å®šçš„é…ç½®" class="headerlink" title="å’ŒåŒ…åç»‘å®šçš„é…ç½®"></a>å’ŒåŒ…åç»‘å®šçš„é…ç½®</h1><p>æˆ‘ä»¬æœ‰ä¸ªæ”¹åŒ…åçš„éœ€æ±‚ï¼Œæœ‰äº›é…ç½®åŒ–çš„å€¼ï¼Œæ˜¯è¦è·Ÿç€åŒ…åå˜åŠ¨çš„ï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹å¹³å°çš„idã€‚æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œçš„åšæ³•æ˜¯ï¼Œä¸åŒåŒ…åï¼Œå»ºç«‹ä¸åŒçš„propertiesæ–‡ä»¶ï¼Œæ‰§è¡Œæ—¶ï¼Œä½¿ç”¨cp -få‘½ä»¤ï¼Œæ›¿æ¢æ‰gradle.propertiesæ–‡ä»¶ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -f $PACKAGE_NAME.properties gradle.properties</span><br></pre></td></tr></table></figure><p>åƒä¸€äº›æ„å»ºæ—¶jenkinsä¼ å…¥çš„å‚æ•°ï¼Œå¯ä»¥ä¸åœ¨<code>åŒ…å.properties</code>é‡Œå‡ºç°ï¼Œä½†æ˜¯ï¼Œé»˜è®¤çš„gradle.propertiesæ–‡ä»¶å¿…é¡»æœ‰è¿™äº›å€¼ï¼Œåœ¨as runçš„æ—¶å€™ï¼Œè¿˜æ˜¯å¾—åœ¨gradle.propertiesä¸­æœ‰ä¸ªé»˜è®¤å€¼çš„ã€‚ä½†jenkinsé€‰äº†<code>invoke gradle script</code>ï¼Œè¿™äº›å‚æ•°ä¼šé€šè¿‡-Pä¼ è¿›å»ã€‚</p><h1 id="manifestæ–‡ä»¶"><a href="#manifestæ–‡ä»¶" class="headerlink" title="manifestæ–‡ä»¶"></a>manifestæ–‡ä»¶</h1><p>manifestæ–‡ä»¶ä¸­ï¼Œä¹Ÿä¼šé…ç½®ä¸€äº›å€¼ï¼Œå¯ä»¥é€šè¿‡placeHolderä¼ è¿›å»ã€‚æ¯”å¦‚channel</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig &#123;</span><br><span class="line">manifestPlaceholders = [label:&quot;@string/app_name&quot;,</span><br><span class="line">                                channel:&quot;$CHANNEL&quot;]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>åœ¨manifestä¸­å¯ä»¥é€šè¿‡${channel}æ¥ä½¿ç”¨ï¼Œmanifestä¸­çš„authoritiesä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å¤„ç†ã€‚</p><h1 id="æ”¹åº”ç”¨å"><a href="#æ”¹åº”ç”¨å" class="headerlink" title="æ”¹åº”ç”¨å"></a>æ”¹åº”ç”¨å</h1><p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªéœ€æ±‚ï¼Œä¸€ä¸ªæ˜¯æ”¹ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºçš„åº”ç”¨åï¼Œå¦ä¸€ä¸ªæ˜¯æ”¹APPå†…éƒ¨æ˜¾ç¤ºçš„åº”ç”¨åï¼Œè¿™ä¸¤ä¸ªæœ‰å¯èƒ½ä¸ä¸€æ ·ã€‚è¿™é‡Œå½“ç„¶æ˜¯é€šè¿‡sedæ”¹çš„ï¼Œè²Œä¼¼ä¹Ÿæ²¡æœ‰åˆ«çš„åŠæ³•ï¼Œä¸Šä¸€æ®µä¸­çš„labelä¹Ÿæ˜¯ç”¨äºè¿™ä¸ªåŠŸèƒ½çš„ã€‚æˆ‘ä»¬çš„åšæ³•æ˜¯æŠŠåŒ…å«åº”ç”¨åå…³é”®å­—çš„strings.xmlå•ç‹¬æå–åˆ°ä¸€ä¸ªvalueèµ„æºæ–‡ä»¶ï¼Œç„¶åé€šè¿‡sedç»Ÿä¸€ä¿®æ”¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/é»˜è®¤åº”ç”¨å/&#x27;&quot;$APP_NAME&quot;&#x27;/g&#x27; myflavor/res/values/stringfile.xml</span><br></pre></td></tr></table></figure><h1 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h1><p>é€šè¿‡è¿™æ³¢ä¿®æ”¹ï¼Œä¹‹å‰çš„ä¸€å¨shæ–‡ä»¶ä¸­ï¼Œå°±åªå‰©ä¸‹ä¿®æ”¹åº”ç”¨åçš„è„šæœ¬äº†ï¼Œå…¶å®ƒçš„éƒ½é€šè¿‡gradleçš„ç¯å¢ƒå˜é‡æ¥æ”¯æŒäº†ã€‚åç»­å¦‚æœè¦åŠ é…ç½®é¡¹ï¼Œåªéœ€è¦åœ¨gradle.propertiesä¸­åŠ ä¸ªé»˜è®¤é¡¹ï¼Œå¦‚æœæ˜¯è·ŸåŒ…åçš„ï¼Œå°±æ”¾åœ¨åŒ…å.propertiesä¸­ï¼Œå¦‚æœæ˜¯jenkinsé…ç½®çš„ï¼Œå°±æŒ‰å¯¹åº”çš„åç§°é…åœ¨jenkinså°±OKã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;éœ€æ±‚&quot;&gt;&lt;a href=&quot;#éœ€æ±‚&quot; class=&quot;headerlink&quot; title=&quot;éœ€æ±‚&quot;&gt;&lt;/a&gt;éœ€æ±‚&lt;/h1&gt;&lt;p&gt;æ²¡æœ‰éœ€æ±‚ï¼Œè‡ªå·±çœ‹äº†ä¸€çœ¼è‡ªå·±ä¹‹å‰å†™çš„æ‰“åŒ…è„šæœ¬ï¼Œç®€ç›´æ— æ³•çœ‹ä¸‹å»ã€‚è€Œä¸”ï¼Œäº§å“ç»ç†çš„å®šåˆ¶åŒ–éœ€æ±‚è¶Šæ¥è¶Šå¤šï¼Œç”¨shellè„šæœ¬çš„å¯è¯»æ€§ä¹Ÿè¶Šæ¥è¶Šå·®ï¼Œå†åŠ ä¸Šé‡Œé¢ä¸€å †çš„sedå‘½ä»¤ï¼Œæƒ¨ä¸å¿ç¹ã€‚&lt;/p&gt;
&lt;p&gt;æ”¹!!!&lt;/p&gt;
&lt;h1 id=&quot;åˆ†æ&quot;&gt;&lt;a href=&quot;#åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;åˆ†æ&quot;&gt;&lt;/a&gt;åˆ†æ&lt;/h1&gt;&lt;p&gt;gradleå…¶å®æ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼Œå…³äºè‡ªå®šä¹‰å‚æ•°çš„ä»‹ç»ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&quot;https://docs.gradle.org/current/userguide/build_environment.html%EF%BC%8C%E7%AE%80%E5%8D%95%E8%AF%B4%E4%B8%80%E4%B8%8B%E7%94%A8%E5%88%B0%E7%9A%84%EF%BC%9A[Gradle&quot;&gt;https://docs.gradle.org/current/userguide/build_environment.htmlï¼Œç®€å•è¯´ä¸€ä¸‹ç”¨åˆ°çš„ï¼š[Gradle&lt;/a&gt; properties](&lt;a href=&quot;https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_configuration_properties)%EF%BC%9A&quot;&gt;https://docs.gradle.org/current/userguide/build_environment.html#sec:gradle_configuration_properties)ï¼š&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="androidæ‰“åŒ…" scheme="https://lefo.me/categories/android%E6%89%93%E5%8C%85/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
    <category term="jenkins" scheme="https://lefo.me/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>androidè¿›ç¨‹ä¿æ´»ï¼ˆæŒæ¡é»‘å¿ƒç§‘æŠ€ï¼‰</title>
    <link href="https://lefo.me/2020/08/24/keep-alive/"/>
    <id>https://lefo.me/2020/08/24/keep-alive/</id>
    <published>2020-08-24T13:31:23.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="è¿›ç¨‹ä¿æ´»"><a href="#è¿›ç¨‹ä¿æ´»" class="headerlink" title="è¿›ç¨‹ä¿æ´»"></a>è¿›ç¨‹ä¿æ´»</h1><p>androidè¿™ä¸ªç”Ÿæ€çœŸçš„æ˜¯ä¸å¥½ï¼Œä»ä¸€å¼€å§‹ï¼Œå¤§å®¶å°±æƒ³æ–¹è®¾æ³•åœ¨åå°å¸¸é©»ï¼Œä¸ºäº†è®©è‡ªå·±appä¸è¢«æ€ï¼Œç»å°½è„‘æ±æƒ³å„ç§å­˜æ´»åŠæ³•ã€‚ç›®å‰ï¼Œä¹‹å‰ç”¨çš„å¤§éƒ¨åˆ†ä¿æ´»æ–¹æ¡ˆï¼Œåœ¨æ‰‹æœºä¸Šå‡ ä¹éƒ½æ˜¯å¤±æ•ˆçš„ï¼Œå°¤å…¶æ˜¯ä¸€äº›å›½å†…å‚å®¶æœºå‹ï¼Œæä¾›ä¸€é”®æ¸…ç†åŠŸèƒ½ï¼ŒæŠŠä½ æ­£çš„è¿è¡Œçš„APPï¼Œæ€çš„æ¸£ä¹Ÿä¸å‰©ã€‚æ‰€ä»¥ï¼Œç›®å‰è¿˜èƒ½æ­£å¸¸ä½¿ç”¨çš„æ–¹æ³•å°±åªæœ‰ä¸€ç§ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹äº’ç›¸ç›‘å¬ã€‚</p><span id="more"></span><h1 id="æŠ€æœ¯åŸç†"><a href="#æŠ€æœ¯åŸç†" class="headerlink" title="æŠ€æœ¯åŸç†"></a>æŠ€æœ¯åŸç†</h1><ul><li>Bå‘ç°Aæ­»äº†åï¼Œèµ¶ç´§æŠŠAæ‹‰æ´»ï¼Œç„¶åå†æŠŠè‡ªå·±æ€æ­»ï¼Œè¿™æ ·è¾¾åˆ°ç’å¤©è¿‡æµ·çš„æ•ˆæœã€‚</li><li>è¿›ç¨‹Aä½¿ç”¨flocké”å®šä¸€ä¸ªæ–‡ä»¶ï¼Œæ­¤æ—¶Bè¿›ç¨‹å†flockå°±ä¼šå°±ä¼šæŒ‚èµ·ï¼Œé™¤éAè¿›ç¨‹ä¸»åŠ¨é‡Šæ”¾æˆ–è€…ç»“æŸï¼ŒBè¿›ç¨‹æ‰ä¼šç»§ç»­ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ç›‘å¬</li><li>åå°„ä½¿ç”¨ActivityManagerServiceç›´æ¥æ‹‰æ´»ç»„ä»¶</li></ul><h2 id="å¯åŠ¨å­è¿›ç¨‹"><a href="#å¯åŠ¨å­è¿›ç¨‹" class="headerlink" title="å¯åŠ¨å­è¿›ç¨‹"></a>å¯åŠ¨å­è¿›ç¨‹</h2><p>æ–¹æ¡ˆä¸€ï¼šå°±æ˜¯forkã€‚forkä¼šåˆ†ç¦»å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨forkçš„åœ°æ–¹å¼€å§‹æ‰§è¡Œæ¥ä¸‹æ¥çš„å·¥ä½œï¼Œå¯ä»¥æ ¹æ®forkå‡½æ•°è¿”å›å€¼æ¥åˆ¤æ–­æ˜¯ä¸»è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹ã€‚è¿™é‡Œæåˆ°çš„å¦ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯äºŒæ¬¡forkï¼Œå…³äºäºŒæ¬¡forkå’Œè¿›ç¨‹æ‰˜å­¤ï¼Œå¯ä»¥è‡ªè¡Œä¸Šç½‘äº†è§£ä¸€ä¸‹ã€‚</p><p>æ–¹æ¡ˆäºŒï¼šä½¿ç”¨app_processå‘½ä»¤å¯åŠ¨ä¸€ä¸ªjavaè¿›ç¨‹ã€‚<a href="https://blog.csdn.net/u010651541/article/details/53163542">https://blog.csdn.net/u010651541/article/details/53163542</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app_process &lt;dir&gt; &lt;class name&gt; &lt;parameters&gt; --application --nice-name=nice_name</span><br><span class="line">app_process -Djava.class.path=Helloworld.dex  dir classname</span><br></pre></td></tr></table></figure><p>å½“ç„¶äº†ï¼Œè¦æƒ³å¯åŠ¨javaè¿›ç¨‹ï¼Œclasspathå¾—è®¾ç½®ï¼Œå¦‚æ‰§è¡Œexport CLASSPATHï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨-Dæ¥æŒ‡å®šè·¯å¾„ã€‚å¦‚æœæœ‰soè¦è°ƒç”¨ï¼Œè¿˜è¦å°†å…±äº«åº“åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚export LD_LIBRARY_PATH æˆ–è€…export _LD_LIBRARY_PATH</p><h2 id="ä¸¤ä¸ªè¿›ç¨‹å¦‚ä½•äº’ç›¸ç›‘å¬"><a href="#ä¸¤ä¸ªè¿›ç¨‹å¦‚ä½•äº’ç›¸ç›‘å¬" class="headerlink" title="ä¸¤ä¸ªè¿›ç¨‹å¦‚ä½•äº’ç›¸ç›‘å¬"></a>ä¸¤ä¸ªè¿›ç¨‹å¦‚ä½•äº’ç›¸ç›‘å¬</h2><p>è¿™é‡Œæœ‰ä¸€ä¸ªç›¸å½“å·§å¦™çš„æ–¹å¼ï¼Œä½¿ç”¨linuxæä¾›çš„å‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int flock(int fd,LOCK_EX);</span><br></pre></td></tr></table></figure><p>å…·ä½“ç”¨æ³•è¯·è‡ªè¡Œæœç´¢ï¼Œç®€å•è®²ï¼ŒAè¿›ç¨‹è°ƒç”¨è¯¥å‡½æ•°åï¼Œæ­¤æ—¶Bè¿›ç¨‹å†è°ƒç”¨ï¼Œä¼šé€ æˆBè¿›ç¨‹é˜»å¡ã€‚è€Œå½“Aè¿›ç¨‹æŒ‚äº†åï¼ŒBè¿›ç¨‹å°±ä¼šç«‹é©¬ç»§ç»­æ‰§è¡Œã€‚</p><h2 id="å¦‚ä½•æ‹‰æ´»APP"><a href="#å¦‚ä½•æ‹‰æ´»APP" class="headerlink" title="å¦‚ä½•æ‹‰æ´»APP"></a>å¦‚ä½•æ‹‰æ´»APP</h2><p>è¦è·å–amsçš„IBinderï¼Œç„¶åè°ƒç”¨transactæ¥å¯åŠ¨ç»„ä»¶ã€‚è¿™é‡Œç»™å¤§å®¶æä¾›æºä»£ç çš„è·¯å¾„ï¼Œè¿™é‡Œéœ€è¦ç”¨åå°„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mRemote = android.os.ServiceManager.getService(&quot;activity&quot;)</span><br><span class="line">mRemote.transact(code,data,null,FLAG_ONEWAY);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤éƒ¨åˆ†éœ€è¦å¤„ç†ï¼Œä¸€ä¸ªæ˜¯codeå€¼ï¼Œå¦ä¸€ä¸ªå°±æ˜¯dataã€‚å…³äºcodeå€¼ï¼Œä¸åŒçš„å®‰å“ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œå¦å¤–æœ‰çš„romä¹Ÿä¼šä¿®æ”¹ï¼Œç¿»çœ‹æºç android.app.IActivityManagerã€‚å…³äºdataï¼Œä¹Ÿä¼šæ ¹æ®ä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬æœ‰ä¸åŒçš„æ‹¼è£…æ–¹æ³•ã€‚æˆ‘è¿™é‡Œä»¥serviceä¸ºä¾‹ã€‚å…·ä½“å‚æ•°ï¼Œä¹Ÿå¯ä»¥å‚è€ƒæºç ï¼Œä¸‹é¢çš„å†™æ³•ä¹Ÿæ˜¯æ ¹æ®IActivityManagerä¸åŒç‰ˆæœ¬ä¸­çš„startServiceå†™çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mServiceData = Parcel.obtain();</span><br><span class="line">mServiceData.writeInterfaceToken(&quot;android.app.IActivityManager&quot;);</span><br><span class="line">mServiceData.writeStrongBinder(null);</span><br><span class="line">if (Build.VERSION.SDK_INT &gt;= 26) &#123;</span><br><span class="line">    mServiceData.writeInt(1);</span><br><span class="line">&#125;</span><br><span class="line">//è¿™ä¸ªæ˜¯serviceçš„intent</span><br><span class="line">serviceIntent.writeToParcel(mServiceData, 0);</span><br><span class="line">mServiceData.writeString(null);</span><br><span class="line">if (Build.VERSION.SDK_INT &gt;= 26) &#123;</span><br><span class="line">    //fg service</span><br><span class="line">    mServiceData.writeInt(1);</span><br><span class="line">&#125;</span><br><span class="line">if (Build.VERSION.SDK_INT &gt;= 23) &#123;</span><br><span class="line">    String packageName = serviceIntent.getComponent().getPackageName();</span><br><span class="line">    mServiceData.writeString(packageName);</span><br><span class="line">&#125;</span><br><span class="line">mServiceData.writeInt(0);</span><br></pre></td></tr></table></figure><p>æˆ‘å£°æ˜ä¸€ä¸‹ï¼Œserviceä¿æ´»åœ¨éƒ¨åˆ†æ‰‹æœºä¸Šå¯ç”¨ã€‚</p><h1 id="ä¸Šä»£ç "><a href="#ä¸Šä»£ç " class="headerlink" title="ä¸Šä»£ç "></a>ä¸Šä»£ç </h1><p><a href="https://github.com/xs93/free/tree/master/common/library-keepalivecore/src/main/java/com/keepalive/daemon/core">-&gt;å…·ä½“ä¿æ´»ä»£ç çœ‹è¿™é‡Œ</a></p><p>20å¹´æœ€æ—©åšçš„æ—¶å€™æ˜¯æ²¡æ‰¾åˆ°è¿™å¨ä»£ç çš„ï¼Œå½“æ—¶çº¯é€†å‘+æ‰¾èµ„æ–™æ€»ç»“çš„ã€‚å‰ä¸¤å¤©ä¸€æœï¼Œç°åœ¨ä¸çŸ¥é“è°ä¸Šä¼ äº†ï¼Œå°±ç»™çœ‹åˆ°çš„æœ‰ç¼˜äººå‘å‡ºæ¥ï¼Œè¿™å¥—ä¿æ´»ç›®å‰åº”è¯¥è¿˜èƒ½ç¨å¾®æ’‘ä¸€æ’‘å§ï¼Œå°±æŒºæ¶å¿ƒçš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;è¿›ç¨‹ä¿æ´»&quot;&gt;&lt;a href=&quot;#è¿›ç¨‹ä¿æ´»&quot; class=&quot;headerlink&quot; title=&quot;è¿›ç¨‹ä¿æ´»&quot;&gt;&lt;/a&gt;è¿›ç¨‹ä¿æ´»&lt;/h1&gt;&lt;p&gt;androidè¿™ä¸ªç”Ÿæ€çœŸçš„æ˜¯ä¸å¥½ï¼Œä»ä¸€å¼€å§‹ï¼Œå¤§å®¶å°±æƒ³æ–¹è®¾æ³•åœ¨åå°å¸¸é©»ï¼Œä¸ºäº†è®©è‡ªå·±appä¸è¢«æ€ï¼Œç»å°½è„‘æ±æƒ³å„ç§å­˜æ´»åŠæ³•ã€‚ç›®å‰ï¼Œä¹‹å‰ç”¨çš„å¤§éƒ¨åˆ†ä¿æ´»æ–¹æ¡ˆï¼Œåœ¨æ‰‹æœºä¸Šå‡ ä¹éƒ½æ˜¯å¤±æ•ˆçš„ï¼Œå°¤å…¶æ˜¯ä¸€äº›å›½å†…å‚å®¶æœºå‹ï¼Œæä¾›ä¸€é”®æ¸…ç†åŠŸèƒ½ï¼ŒæŠŠä½ æ­£çš„è¿è¡Œçš„APPï¼Œæ€çš„æ¸£ä¹Ÿä¸å‰©ã€‚æ‰€ä»¥ï¼Œç›®å‰è¿˜èƒ½æ­£å¸¸ä½¿ç”¨çš„æ–¹æ³•å°±åªæœ‰ä¸€ç§ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹äº’ç›¸ç›‘å¬ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>python+seleniumä¸ºä½ è‡ªåŠ¨æŒ‚æµ·æ·€é©¾æ ¡æ³•é™ªè¯¾</title>
    <link href="https://lefo.me/2020/05/18/python-selenium/"/>
    <id>https://lefo.me/2020/05/18/python-selenium/</id>
    <published>2020-05-18T12:25:12.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨åŒ—äº¬æ‘‡å·æ‘‡äº†18æ¬¡äº†ï¼Œä¸‹æ¬¡å¼€å§‹å°±æ˜¯å››å€æ¦‚ç‡ã€‚ç„¶åï¼Œä¸­ç­¾è¿˜æ˜¯é¥é¥æ— æœŸï¼Œéš”å£åçš„åŒäº‹æ‘‡äº†ä¸¤å¹´å°±æ‘‡åˆ°äº†ï¼Œä¸‡åˆ†ç¾¡æ…•ã€‚æœ‰æ—¶å€™æ™šä¸Šæƒ³å»æºœè¾¾ä¸€ä¸‹ï¼Œè¦å»æ‰¾gofunå…±äº«æ±½è½¦è¿˜è¦èµ°1å…¬é‡Œå¤šï¼Œè¿˜è½¦è¿˜è¦èµ°1å…¬é‡Œã€‚äºæ˜¯å°±æœ‰äº†æƒ³ä¹°ä¸€è¾†æ‘©æ‰˜è½¦çš„æƒ³æ³•ã€‚</p><p>è¦ä¹°è½¦ï¼Œè‚¯å®šå¾—æœ‰é©¾ç…§ï¼ŒæŒ‘é€‰å®Œä»¥åï¼ŒæŠ¥äº†æµ·æ·€é©¾æ ¡ï¼Œå°åŒºé—¨å£å°±æœ‰é©¾æ ¡çš„ç­è½¦ï¼Œå…³é”®æ˜¯ä¾¿å®œï¼Œåªè¦1000å—ã€‚åœ¨æˆ‘å®¶é‚£18çº¿åŸå¸‚çš„å°åœ°æ–¹ä¹Ÿå¾—800å¤šã€‚äºæ˜¯æŠ¥åï¼Œå¼€å§‹ä¸Šæ³•é™ªè¯¾ã€‚ä½†æ³•é™ªè¯¾æ¯ä¸€ç« èŠ‚å¿…é¡»è‡ªå·²æ‰‹åŠ¨ç‚¹å¼€å§‹ï¼Œå¾ˆæ˜¯éº»çƒ¦ï¼Œäºæ˜¯å°±æƒ³å†™ä¸ªç¨‹åºä»£æ›¿è‡ªå·±æ‰‹ç‚¹ã€‚</p><span id="more"></span><h2 id="æ‰‹æœºç«¯"><a href="#æ‰‹æœºç«¯" class="headerlink" title="æ‰‹æœºç«¯"></a>æ‰‹æœºç«¯</h2><p>æ³•é™ªè¯¾å¯ä»¥åœ¨ç½‘é¡µä¸Šä¸Šï¼Œä¹Ÿå¯ä»¥åœ¨APPä¸Šä¸Šï¼Œæ²¡è‡ªåŠ¨æ’­æ”¾ï¼Œä¼°è®¡ä¹Ÿæ˜¯æƒ³è®©ä½ å¥½å¥½å­¦ä¹ ï¼Œæ€•ä½ å·æ‡’å§ã€‚</p><p>å› ä¸ºæˆ‘æ˜¯åšå®‰å“çš„ï¼Œèµ·å…ˆæ‰“ç®—æ‹¿åœ¨æ‰‹æœºä¸Šæï¼Œå‘ç°æ‰‹æœºä¸Šæ˜¯ä¸ªè‡ªå®šä¹‰æ§ä»¶ï¼ŒåŸºæœ¬ä¸èƒ½ç”¨è¾…åŠ©åŠŸèƒ½ï¼ˆç±»ä¼¼å¾®ä¿¡æŠ¢çº¢åŒ…æ’ä»¶çš„æŠ€æœ¯ï¼‰ä¸‹æ‰‹ã€‚å”¯ä¸€å¯ç”¨çš„å°±æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb -s device_name shell input tap x y</span><br></pre></td></tr></table></figure><p>ç„¶åå¤šä¹…å‘ä¸€æ¬¡å‘½ä»¤åˆæ˜¯ä¸ªé—®é¢˜ï¼Œäºæ˜¯å°±æ‰“ç®—ä»ç½‘é¡µä¸Šä¸‹æ‰‹ã€‚</p><h2 id="ç½‘é¡µç«¯"><a href="#ç½‘é¡µç«¯" class="headerlink" title="ç½‘é¡µç«¯"></a>ç½‘é¡µç«¯</h2><p>ç½‘é¡µä¸Šçœ‹ï¼Œæ’­æ”¾è§†é¢‘æ˜¯ä¸€ä¸ªflashï¼Œæƒ³ç”¨javascriptä¹Ÿå°±æ²¡åŠæ³•æäº†ï¼Œåªå¾—ç”¨seleniumã€‚</p><p>å‡†å¤‡å·¥ä½œï¼š</p><ul><li>Pythonï¼šä¸è§£é‡Š</li><li>selenium: pip3 install seleniumå®‰è£…</li><li>Firefoxï¼šæµè§ˆå™¨ï¼Œæœ¬æ¥æˆ‘ä½¿ç”¨çš„æ˜¯chromeï¼Œå‘ç°chromeå¯¹flashåšäº†ä¸ªä¼˜åŒ–ï¼Œåˆ‡åå°åï¼Œflashä¸è‡ªåŠ¨åŠ è½½ï¼Œæ¢ç«ç‹å°±æ²¡é—®é¢˜äº†ã€‚</li><li>geckodriver:ç«ç‹æµè§ˆå™¨çš„é©±åŠ¨ï¼Œä¾›seleniumè°ƒç”¨</li></ul><h1 id="æ”¾ä»£ç "><a href="#æ”¾ä»£ç " class="headerlink" title="æ”¾ä»£ç "></a>æ”¾ä»£ç </h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.action_chains import ActionChains</span><br><span class="line">from selenium.webdriver import FirefoxOptions</span><br><span class="line">from selenium.webdriver.support.wait import WebDriverWait</span><br><span class="line">import re</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def findTime(dr):</span><br><span class="line">    timeText = driver.find_element_by_class_name(&#x27;playing&#x27;).text</span><br><span class="line">    p1 = re.compile(r&#x27;[(](.*?)[)]&#x27;, re.S)</span><br><span class="line">    timeList = re.findall(p1, timeText)</span><br><span class="line">    if len(timeList) == 0:</span><br><span class="line">        return 0</span><br><span class="line">    else:</span><br><span class="line">        timearr = timeList[0].split(&#x27;:&#x27;)</span><br><span class="line">        return int(timearr[1]) * 60 + int(timearr[2])</span><br><span class="line"></span><br><span class="line">#flashçš„äº‹ä»¶ä¸èƒ½é€šè¿‡elementè§¦å‘ </span><br><span class="line">def click_locxy(dr, x, y, left_click=True):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    dr:æµè§ˆå™¨</span><br><span class="line">    x:é¡µé¢xåæ ‡</span><br><span class="line">    y:é¡µé¢yåæ ‡</span><br><span class="line">    left_click:Trueä¸ºé¼ æ ‡å·¦é”®ç‚¹å‡»ï¼Œå¦åˆ™ä¸ºå³é”®ç‚¹å‡»</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    if left_click:</span><br><span class="line">        ActionChains(dr).move_by_offset(x, y).click().perform()</span><br><span class="line">    else:</span><br><span class="line">        ActionChains(dr).move_by_offset(x, y).context_click().perform()</span><br><span class="line">    ActionChains(dr).move_by_offset(-x, -y).perform()  # å°†é¼ æ ‡ä½ç½®æ¢å¤åˆ°ç§»åŠ¨å‰</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">opts = FirefoxOptions()</span><br><span class="line">#opts.add_argument(&quot;--headless&quot;)</span><br><span class="line">option_profile = webdriver.FirefoxProfile()</span><br><span class="line">option_profile.set_preference(&quot;plugin.state.flash&quot;,2)</span><br><span class="line"></span><br><span class="line">path = &quot;/Users/lefo/Documents/dev/chrome/geckodriver&quot;# æ³¨æ„è¿™ä¸ªè·¯å¾„éœ€è¦æ—¶å¯æ‰§è¡Œè·¯å¾„ï¼ˆchmod 777 dir or 755 dirï¼‰</span><br><span class="line">driver = webdriver.Firefox(executable_path=path,options=opts)</span><br><span class="line">driver.get(&#x27;http://www.xuechebu.com/sign.html&#x27;)</span><br><span class="line">def playing():</span><br><span class="line">    playing = WebDriverWait(driver,60,1).until(lambda x:x.find_element_by_class_name(&#x27;playing&#x27;)) #ç­‰ä¸€åˆ†é’Ÿï¼Œç›´åˆ°è·å–åˆ°æ­£åœ¨æ’­æ”¾çš„æ§ä»¶</span><br><span class="line">    text = playing.text</span><br><span class="line">    print(text)</span><br><span class="line">    time.sleep(3) #ç­‰ä¸‰ç§’ï¼Œæœ‰æ—¶å€™æ–‡å­—å¯èƒ½åŠ è½½æ…¢</span><br><span class="line">    nextTime = findTime(dr=driver) #æ–‡å­—ä¸­æå–æ‹¬å·å†…çš„æ—¶é—´</span><br><span class="line">    playing.click() #è¿™é‡Œè²Œä¼¼æ— æ‰€è°“ï¼Œä¸ç‚¹å‡»ä¹Ÿå¯ä»¥</span><br><span class="line">    print(str(nextTime))  #ä¸‹ä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´</span><br><span class="line">    time.sleep(10) #è¿™ä¸ª10sä¸»è¦æ˜¯ä¸ºäº†flashå…è®¸æœ‰æ—¶é—´ç‚¹</span><br><span class="line">    click_locxy(driver,750,540,left_click=True) #æ ¹æ®åæ ‡ç‚¹ä¸Šå»</span><br><span class="line">    time.sleep(nextTime + 5)  #è¿™ä¸ª5så’Œä¸Šé¢10såŒæ ·çš„é“ç†</span><br><span class="line">count = 0</span><br><span class="line">while(count &lt;= 99):  #99è¿™ä¸ªæ•°å€¼å…·ä½“è‡ªå·±è®¾</span><br><span class="line">    playing()</span><br><span class="line">    count = count +1</span><br><span class="line"></span><br><span class="line">driver.quit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h1><p>é¦–å…ˆï¼Œè·å–æ­£åœ¨æ’­æ”¾çš„è¶…é“¾æ¥ï¼Œä¸Šé¢æ–‡å­—çš„æ ¼å¼ï¼šç¬¬xç« èŠ‚(00:02:30)è¡¨ç¤º2åˆ†30ç§’é•¿ï¼Œè®¡ç®—æˆç§’ï¼Œç„¶åé—´éš”è¿™ä¸ªæ—¶é—´å€¼å†å»ä¸‹ä¸€ä¸ªå¾ªç¯ã€‚å› ä¸ºæ’­æ”¾å®Œæˆåä¼šè‡ªåŠ¨è·³åˆ°ä¸‹ä¸€ä¸ªç« èŠ‚ï¼Œåªæ˜¯ä¸ä¼šå¼€å§‹æ’­æ”¾è€Œå·²ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯ï¼Œé—´éš”ä¸€æ®µæ—¶é—´ï¼Œç‚¹ä¸€ä¸‹æ’­æ”¾ã€‚</p><p>è¯•è¿‡ä¼ å…¥å¯åŠ¨flashæ’ä»¶çš„å‚æ•°ï¼Œæœ€åä¹Ÿå¤±è´¥äº†ï¼Œæ‰€ä»¥å¯åŠ¨åéœ€è¦åœ¨ä¸€åˆ†é’Ÿå†…ç™»å½•ï¼Œç„¶åå» é™„åŠ ç»„ä»¶ - æ’ä»¶ å°†flashæ’ä»¶å¯ç”¨ã€‚å†å°†é¡µé¢ä¸Šçš„flashç‚¹ä¸ªå…è®¸ã€‚ç‚¹å®Œå…è®¸åï¼Œ10så†…ä¼šè§¦å‘ä¸€æ¬¡æ’­æ”¾ç‚¹å‡»ã€‚å¦‚æœä½ è§‰å¾—1åˆ†é’Ÿçš„ç™»å½•æ—¶é—´ä¸å¤Ÿï¼Œé‚£å°±æ”¹ä¸€ä¸‹ä¸Šé¢çš„æ—¶é—´ï¼Œæˆ–è€…ï¼ŒåŠ ä¸Šç™»å½•çš„é€»è¾‘ï¼ˆå…¶å®æˆ‘æ˜¯æœ‰ç™»å½•çš„ï¼Œå‘æ–‡ç« çš„æ—¶å€™ï¼Œåˆ æ‰äº†ï¼‰</p><p>å¦‚æœä½ æ˜¯å…¶å®ƒæŒ‚è¯¾çš„ç½‘é¡µï¼Œé“ç†ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå¦‚æœç”¨JSå¯ä»¥å®ç°è¿˜æ˜¯ç”¨jså§ã€‚å› ä¸ºè¿™ä¸ªç½‘é¡µæœ‰flashçš„ç‰¹æ®Šæ€§ï¼Œæ‰ç”¨çš„seleniumï¼Œæˆ‘å¯¹pythonå’Œseleniuméƒ½ä¸ç†Ÿï¼Œé‡Œé¢çš„å‡½æ•°å‡ ä¹ä¸€ä¸ªéƒ½ä¸çŸ¥é“ï¼Œåªèƒ½è¾¹å­¦è¾¹æœè¾¹å†™ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;åœ¨åŒ—äº¬æ‘‡å·æ‘‡äº†18æ¬¡äº†ï¼Œä¸‹æ¬¡å¼€å§‹å°±æ˜¯å››å€æ¦‚ç‡ã€‚ç„¶åï¼Œä¸­ç­¾è¿˜æ˜¯é¥é¥æ— æœŸï¼Œéš”å£åçš„åŒäº‹æ‘‡äº†ä¸¤å¹´å°±æ‘‡åˆ°äº†ï¼Œä¸‡åˆ†ç¾¡æ…•ã€‚æœ‰æ—¶å€™æ™šä¸Šæƒ³å»æºœè¾¾ä¸€ä¸‹ï¼Œè¦å»æ‰¾gofunå…±äº«æ±½è½¦è¿˜è¦èµ°1å…¬é‡Œå¤šï¼Œè¿˜è½¦è¿˜è¦èµ°1å…¬é‡Œã€‚äºæ˜¯å°±æœ‰äº†æƒ³ä¹°ä¸€è¾†æ‘©æ‰˜è½¦çš„æƒ³æ³•ã€‚&lt;/p&gt;
&lt;p&gt;è¦ä¹°è½¦ï¼Œè‚¯å®šå¾—æœ‰é©¾ç…§ï¼ŒæŒ‘é€‰å®Œä»¥åï¼ŒæŠ¥äº†æµ·æ·€é©¾æ ¡ï¼Œå°åŒºé—¨å£å°±æœ‰é©¾æ ¡çš„ç­è½¦ï¼Œå…³é”®æ˜¯ä¾¿å®œï¼Œåªè¦1000å—ã€‚åœ¨æˆ‘å®¶é‚£18çº¿åŸå¸‚çš„å°åœ°æ–¹ä¹Ÿå¾—800å¤šã€‚äºæ˜¯æŠ¥åï¼Œå¼€å§‹ä¸Šæ³•é™ªè¯¾ã€‚ä½†æ³•é™ªè¯¾æ¯ä¸€ç« èŠ‚å¿…é¡»è‡ªå·²æ‰‹åŠ¨ç‚¹å¼€å§‹ï¼Œå¾ˆæ˜¯éº»çƒ¦ï¼Œäºæ˜¯å°±æƒ³å†™ä¸ªç¨‹åºä»£æ›¿è‡ªå·±æ‰‹ç‚¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="python" scheme="https://lefo.me/categories/python/"/>
    
    
    <category term="python" scheme="https://lefo.me/tags/python/"/>
    
    <category term="selenium" scheme="https://lefo.me/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>OpenCVåœ¨Android NDKæŒ‰éœ€è¦çš„æ¨¡å—ç¼–è¯‘</title>
    <link href="https://lefo.me/2020/05/02/opencv-android/"/>
    <id>https://lefo.me/2020/05/02/opencv-android/</id>
    <published>2020-05-02T09:04:20.000Z</published>
    <updated>2026-01-27T02:36:14.657Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å…¬å¸è¦åšä¸€ä¸ªå’Œå›¾ç‰‡æœ‰å…³çš„åŠŸèƒ½ï¼Œä¸€è¯´å›¾ç‰‡å¤„ç†ï¼Œå¤§å®¶é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯å¼ºå¤§çš„OpenCVã€‚OpenCVå¾ˆå¼ºå¤§ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†androidä¸“ç”¨çš„sdkï¼Œç›´æ¥å°†soå’Œjaræ”¾å…¥é¡¹ç›®ä¸­å°±èƒ½ä½¿ç”¨ã€‚å°½ç®¡å®˜æ–¹æ¨èçš„ä¹Ÿæ˜¯è¿™ç§æ–¹å¼ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒOpenCVçš„åº“å¾ˆå¤§ï¼Œæœ‰10MBï¼Œå¾ˆå¤šå…¬å¸æ•´ä¸ªAPKéƒ½æ²¡æœ‰10MBï¼Œå¦‚æœè¦æŠŠçœŸä¸ªåº“éƒ½æ”¾åˆ°é¡¹ç›®ä¸­ï¼Œé‚£è¿˜æ˜¯æŒºå¤§çš„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–è¯‘ã€‚ä¸­é—´æŠ˜è…¾äº†å¥½ä¹…ï¼Œå†™ä¸ªæ–‡ç« è®°å½•ä¸€ä¸‹ã€‚</p><h1 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h1><h2 id="ä¸‹è½½OpenCV"><a href="#ä¸‹è½½OpenCV" class="headerlink" title="ä¸‹è½½OpenCV"></a>ä¸‹è½½OpenCV</h2><p>åœ°å€ <a href="https://opencv.org/releases/">https://opencv.org/releases/</a><br>é€‰æ‹©Androidå¹³å°çš„åŒ…</p><p>è¿™é‡Œæ³¨æ„äº†ï¼Œ4.0çš„ç‰ˆæœ¬ï¼Œè¦æ±‚api levelæ˜¯21ä»¥ä¸Šï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ çš„APPæ˜¯è¦åœ¨21ä»¥ä¸‹ä½¿ç”¨ï¼Œä¸è¦ä¸‹è½½è¿™ä¸ªã€‚</p><p>3.xçš„ç‰ˆæœ¬ä¸æ¸…æ¥šï¼Œä½†æˆ‘è¯•äº†OpenCV 2.xçš„ç‰ˆæœ¬æ˜¯api level 8ä»¥ä¸Šã€‚2.xçš„ç‰ˆæœ¬ï¼Œéœ€è¦è‡ªè¡Œgoogleï¼Œå®˜æ–¹åº”è¯¥å·²ç»ä¸æä¾›äº†ã€‚</p><span id="more"></span><h2 id="é…ç½®gradle"><a href="#é…ç½®gradle" class="headerlink" title="é…ç½®gradle"></a>é…ç½®gradle</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">defaultConfig</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">ndkVersion &quot;16.1.4479499&quot;</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        ndk &#123;</span><br><span class="line">            moduleName &quot;opencv-test&quot;</span><br><span class="line">            abiFilters &#x27;armeabi-v7a&#x27;,&#x27;x86&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">            path &quot;src/main/jni/CMakeLists.txt&quot;</span><br><span class="line">            version &quot;3.10.2&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä¸Šé¢çš„ndkVersionå¯ä»¥ä¸å¡«ï¼Œæˆ‘è¿™é‡Œæ˜¯ä¸ºäº†ä½¿ç”¨OpenCV 2.Xç‰ˆæœ¬ï¼Œåº”è¯¥æ˜¯éœ€è¦r16çš„ç‰ˆæœ¬ç¼–è¯‘ï¼Œå› ä¸ºä½¿ç”¨å½“å‰æœ€æ–°çš„ç‰ˆæœ¬ç¼–è¯‘æ—¶ï¼Œæœ‰ä¸ªåº“æ‰¾ä¸åˆ°ã€‚</p><p>abiéœ€è¦å“ªäº›è¯·æ ¹æ®ä½ è‡ªå·±çš„éœ€è¦æ¥å¡«ï¼Œæœ‰å¾ˆå¤šæ–°å…¥é—¨çš„æœ‹å‹æŠ„çš„æ—¶å€™éƒ½ä¸çœ‹å†…å®¹ï¼Œå¦åˆ™å¦‚æœä½ å…¶å®ƒsoåº“åœ¨æŸå¹³å°ç¼ºå¤±ï¼Œå¯èƒ½ä¼šé—ªé€€ã€‚</p><p>CMakeLists.txtæ³¨æ„å¯¹åº”çš„ç›®å½•æ˜¯ä½ JNIä»£ç çš„ç›®å½•</p><h2 id="CMakeLists-txt"><a href="#CMakeLists-txt" class="headerlink" title="CMakeLists.txt"></a>CMakeLists.txt</h2><p>åœ¨ç½‘ä¸Šæ‰¾çš„ä¸€ä¸ªå†…å®¹æŠ˜è…¾äº†å¥½ä¹…ï¼Œç»ˆäºç®—æ˜¯å¼„æ˜ç™½äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#ä½ çš„opencvè§£å‹ç›®å½•</span><br><span class="line">set(OpenCV_DIR /OpenCV-android-sdk/sdk/native/jni)</span><br><span class="line">#è¿™é‡Œä¹Ÿå¯ä»¥åœ¨åé¢è·Ÿå…·ä½“æ¨¡å—OpenCV REQUIRED core imgproc æ³¨æ„ï¼Œå†™ä¸Šå¹¶ä¸ä»£è¡¨ä¼šç¼–è¯‘åˆ°åŒ…å†…</span><br><span class="line">FIND_PACKAGE(OpenCV REQUIRED)</span><br><span class="line">if(OpenCV_FOUND)</span><br><span class="line">    include_directories($&#123;OpenCV_INCLUDE_DIRS&#125;)</span><br><span class="line">    message(STATUS &quot;OpenCV library status:&quot;)</span><br><span class="line">    message(STATUS &quot;    version: $&#123;OpenCV_VERSION&#125;&quot;)</span><br><span class="line">    message(STATUS &quot;    libraries: $&#123;OpenCV_LIBS&#125;&quot;)</span><br><span class="line">    message(STATUS &quot;    include path: $&#123;OpenCV_INCLUDE_DIRS&#125;&quot;)</span><br><span class="line">else(OpenCV_FOUND)</span><br><span class="line">    message(FATAL_ERROR &quot;OpenCV library not found&quot;)</span><br><span class="line">endif(OpenCV_FOUND)</span><br><span class="line">#ä½ çš„åº“</span><br><span class="line">add_library( native_test</span><br><span class="line">        SHARED</span><br><span class="line">        native.cpp)</span><br><span class="line"></span><br><span class="line">#includeä¸ºå¤´æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•hpp</span><br><span class="line">include_directories(/OpenCV-android-sdk/sdk/native/jni/include)</span><br><span class="line"></span><br><span class="line">#è¦é“¾æ¥çš„åº“</span><br><span class="line">target_link_libraries( native_test</span><br><span class="line">        $&#123;OpenCV_LIBS&#125;</span><br><span class="line">        log</span><br><span class="line">        jnigraphics)</span><br></pre></td></tr></table></figure><p>ç®€å•è¯´ä¸€ä¸‹ä¸Šé¢çš„ä»£ç </p><ol><li>é¦–å…ˆè®¾ç½®OpenCV_DIRç¯å¢ƒå˜é‡ï¼ŒæŒ‡å®šæ‰€åœ¨ç›®å½•</li><li>æ‰¾å‡ºé…ç½®çš„æ‰€åŒ…å«çš„åº“ï¼Œä¹Ÿå°±æ˜¯OpenCVçš„æ¨¡å—</li><li>ç¯å¢ƒçš„æ‰“å°ï¼Œä¸ç”¨åœ¨æ„</li><li>add_libraryæ˜¯ä½ çš„åº“çš„é…ç½®ï¼Œå¯ä»¥å‚è€ƒndkçš„å®˜æ–¹æ–‡æ¡£</li><li>include_directoriesæ˜¯OpenCVçš„å¤´æ–‡ä»¶ç›®å½•</li><li>target_link_librariesè¿™é‡Œè¦ç”¨åˆ°jnigraphicsï¼Œè¿˜æœ‰æ—¥å¿—æ‰“å°çš„logï¼ˆå¸¸ç”¨ï¼‰ï¼Œæ³¨æ„çœ‹OpenCV_LIBSå°±æ˜¯FIND_PACKAGEçš„å†…å®¹ï¼Œåœ¨3ä¸­ä¼šæ‰“å°å‡ºæ¥ã€‚</li></ol><p>æ­å»ºå®Œåä½ å°±å¯ä»¥åœ¨ä»£ç ä¸­ç¼–å†™ä½ çš„jniä»£ç äº†ï¼Œè¿™æ ·å†™å‡ºæ¥çš„åº“ï¼Œåªä¼šåŒ…å«ä½ ç”¨åˆ°çš„æ¨¡å—ï¼Œæ¯”å¦‚ä½ åªç”¨åˆ°äº†coreå’Œimgprocï¼Œé‚£ä½ çš„åº“æ‰“å‡ºæ¥å°±åªæœ‰1.8mbï¼Œè¿™æ¯”OpenCVå®˜æ–¹çš„è¦å°äº†å¥½å¤šã€‚</p><h1 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h1><p>å†™ä»£ç çš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨OpenCVçš„imreadï¼Œè¿™ä¼šå¯¼è‡´æœ‰éœ€è¦å¤šå¯¼å…¥æ¨¡å—ï¼Œå¢åŠ äº†åŒ…çš„ä½“ç§¯ã€‚ndkä¸­ï¼Œæœ‰android&#x2F;bitmap.hï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Bitmapå¯¹è±¡æ¥è½¬Mat.</p>]]></content>
    
    
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;å…¬å¸è¦åšä¸€ä¸ªå’Œå›¾ç‰‡æœ‰å…³çš„åŠŸèƒ½ï¼Œä¸€è¯´å›¾ç‰‡å¤„ç†ï¼Œå¤§å®¶é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯å¼ºå¤§çš„OpenCVã€‚OpenCVå¾ˆå¼ºå¤§ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†androidä¸“ç”¨çš„sdkï¼Œç›´æ¥å°†soå’Œjaræ”¾å…¥é¡¹ç›®ä¸­å°±èƒ½ä½¿ç”¨ã€‚å°½ç®¡å®˜æ–¹æ¨èçš„ä¹Ÿæ˜¯è¿™ç§æ–¹å¼ï¼Œä½†æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒOpenCVçš„åº“å¾ˆå¤§ï¼Œæœ‰10MBï¼Œå¾ˆå¤šå…¬å¸æ•´ä¸ªAPKéƒ½æ²¡æœ‰10MBï¼Œå¦‚æœè¦æŠŠçœŸä¸ªåº“éƒ½æ”¾åˆ°é¡¹ç›®ä¸­ï¼Œé‚£è¿˜æ˜¯æŒºå¤§çš„ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±ç¼–è¯‘ã€‚ä¸­é—´æŠ˜è…¾äº†å¥½ä¹…ï¼Œå†™ä¸ªæ–‡ç« è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å‡†å¤‡&quot;&gt;&lt;a href=&quot;#å‡†å¤‡&quot; class=&quot;headerlink&quot; title=&quot;å‡†å¤‡&quot;&gt;&lt;/a&gt;å‡†å¤‡&lt;/h1&gt;&lt;h2 id=&quot;ä¸‹è½½OpenCV&quot;&gt;&lt;a href=&quot;#ä¸‹è½½OpenCV&quot; class=&quot;headerlink&quot; title=&quot;ä¸‹è½½OpenCV&quot;&gt;&lt;/a&gt;ä¸‹è½½OpenCV&lt;/h2&gt;&lt;p&gt;åœ°å€ &lt;a href=&quot;https://opencv.org/releases/&quot;&gt;https://opencv.org/releases/&lt;/a&gt;&lt;br&gt;é€‰æ‹©Androidå¹³å°çš„åŒ…&lt;/p&gt;
&lt;p&gt;è¿™é‡Œæ³¨æ„äº†ï¼Œ4.0çš„ç‰ˆæœ¬ï¼Œè¦æ±‚api levelæ˜¯21ä»¥ä¸Šï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ çš„APPæ˜¯è¦åœ¨21ä»¥ä¸‹ä½¿ç”¨ï¼Œä¸è¦ä¸‹è½½è¿™ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;3.xçš„ç‰ˆæœ¬ä¸æ¸…æ¥šï¼Œä½†æˆ‘è¯•äº†OpenCV 2.xçš„ç‰ˆæœ¬æ˜¯api level 8ä»¥ä¸Šã€‚2.xçš„ç‰ˆæœ¬ï¼Œéœ€è¦è‡ªè¡Œgoogleï¼Œå®˜æ–¹åº”è¯¥å·²ç»ä¸æä¾›äº†ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="android" scheme="https://lefo.me/categories/android/"/>
    
    
    <category term="android" scheme="https://lefo.me/tags/android/"/>
    
    <category term="opencv" scheme="https://lefo.me/tags/opencv/"/>
    
  </entry>
  
</feed>
